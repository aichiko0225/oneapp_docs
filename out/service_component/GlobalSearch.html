<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>GlobalSearch - &#x5168;&#x5c40;&#x641c;&#x7d22;&#x6a21;&#x5757;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="globalsearch---全局搜索模块">GlobalSearch - 全局搜索模块</h1>
<h2 id="模块概述">模块概述</h2>
<p><code>GlobalSearch</code> 是 OneApp 的全局搜索模块，提供了跨模块的统一搜索功能。该模块支持多种内容类型的搜索，包括智能搜索建议、搜索历史管理、搜索结果优化等功能，为用户提供高效、精准的搜索体验。</p>
<h2 id="核心功能">核心功能</h2>
<h3 id="1-跨模块内容搜索">1. 跨模块内容搜索</h3>
<ul>
<li><strong>统一搜索入口</strong>：提供全局统一的搜索接口</li>
<li><strong>多模块索引</strong>：聚合各模块的可搜索内容</li>
<li><strong>内容分类</strong>：按类型分类搜索结果</li>
<li><strong>权限控制</strong>：基于用户权限过滤搜索结果</li>
</ul>
<h3 id="2-智能搜索建议">2. 智能搜索建议</h3>
<ul>
<li><strong>实时建议</strong>：输入时实时提供搜索建议</li>
<li><strong>热门搜索</strong>：展示热门搜索关键词</li>
<li><strong>个性化推荐</strong>：基于用户行为的个性化建议</li>
<li><strong>拼写纠错</strong>：智能纠正搜索词拼写错误</li>
</ul>
<h3 id="3-搜索历史管理">3. 搜索历史管理</h3>
<ul>
<li><strong>历史记录</strong>：保存用户搜索历史</li>
<li><strong>快速访问</strong>：快速访问历史搜索结果</li>
<li><strong>清理管理</strong>：支持清理搜索历史</li>
<li><strong>隐私保护</strong>：敏感搜索历史加密存储</li>
</ul>
<h3 id="4-搜索结果优化">4. 搜索结果优化</h3>
<ul>
<li><strong>相关性排序</strong>：按相关性智能排序</li>
<li><strong>结果聚合</strong>：相似结果智能聚合</li>
<li><strong>高亮显示</strong>：关键词高亮显示</li>
<li><strong>分页加载</strong>：大量结果分页展示</li>
</ul>
<h2 id="技术架构">技术架构</h2>
<h3 id="架构设计">架构设计</h3>
<pre><code>┌─────────────────────────────────────┐
│            搜索界面层                │
│       (Search UI Components)        │
├─────────────────────────────────────┤
│         GlobalSearch 模块           │
│  ┌──────────┬──────────┬──────────┐ │
│  │ 搜索引擎 │ 索引管理 │ 结果处理 │ │
│  ├──────────┼──────────┼──────────┤ │
│  │ 建议系统 │ 历史管理 │ 缓存层   │ │
│  └──────────┴──────────┴──────────┘ │
├─────────────────────────────────────┤
│           模块搜索接口              │
│  ┌──────────┬──────────┬──────────┐ │
│  │ 车辆模块 │ 订单模块 │ 设置模块 │ │
│  └──────────┴──────────┴──────────┘ │
├─────────────────────────────────────┤
│           数据存储层                │
│    (Local DB + Remote Index)        │
└─────────────────────────────────────┘
</code></pre>
<h3 id="核心组件">核心组件</h3>
<h4 id="1-搜索引擎-searchengine">1. 搜索引擎 (SearchEngine)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlobalSearchEngine</span> </span>{
  <span class="hljs-comment">// 执行搜索</span>
  Future&lt;SearchResult&gt; search(SearchQuery query);
  
  <span class="hljs-comment">// 获取搜索建议</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;SearchSuggestion&gt;&gt; getSuggestions(<span class="hljs-built_in">String</span> input);
  
  <span class="hljs-comment">// 注册搜索提供者</span>
  <span class="hljs-keyword">void</span> registerSearchProvider(SearchProvider provider);
  
  <span class="hljs-comment">// 构建搜索索引</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; buildSearchIndex();
}
</code></pre>
<h4 id="2-索引管理器-indexmanager">2. 索引管理器 (IndexManager)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchIndexManager</span> </span>{
  <span class="hljs-comment">// 更新索引</span>
  Future&lt;<span class="hljs-built_in">bool</span>&gt; updateIndex(<span class="hljs-built_in">String</span> moduleId, <span class="hljs-built_in">List</span>&lt;SearchableItem&gt; items);
  
  <span class="hljs-comment">// 删除索引</span>
  Future&lt;<span class="hljs-built_in">bool</span>&gt; removeIndex(<span class="hljs-built_in">String</span> moduleId, <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; itemIds);
  
  <span class="hljs-comment">// 重建索引</span>
  Future&lt;<span class="hljs-built_in">bool</span>&gt; rebuildIndex(<span class="hljs-built_in">String</span> moduleId);
  
  <span class="hljs-comment">// 搜索索引</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;IndexedItem&gt;&gt; searchIndex(<span class="hljs-built_in">String</span> query, SearchOptions options);
}
</code></pre>
<h4 id="3-搜索历史管理器-searchhistorymanager">3. 搜索历史管理器 (SearchHistoryManager)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchHistoryManager</span> </span>{
  <span class="hljs-comment">// 添加搜索记录</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; addSearchRecord(SearchRecord record);
  
  <span class="hljs-comment">// 获取搜索历史</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;SearchRecord&gt;&gt; getSearchHistory({<span class="hljs-built_in">int</span> limit = <span class="hljs-number">50</span>});
  
  <span class="hljs-comment">// 删除搜索记录</span>
  Future&lt;<span class="hljs-built_in">bool</span>&gt; deleteSearchRecord(<span class="hljs-built_in">String</span> recordId);
  
  <span class="hljs-comment">// 清空搜索历史</span>
  Future&lt;<span class="hljs-built_in">bool</span>&gt; clearSearchHistory();
}
</code></pre>
<h4 id="4-搜索建议系统-suggestionsystem">4. 搜索建议系统 (SuggestionSystem)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchSuggestionSystem</span> </span>{
  <span class="hljs-comment">// 生成搜索建议</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;SearchSuggestion&gt;&gt; generateSuggestions(<span class="hljs-built_in">String</span> input);
  
  <span class="hljs-comment">// 获取热门搜索</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt;&gt; getPopularSearches();
  
  <span class="hljs-comment">// 获取个性化建议</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;SearchSuggestion&gt;&gt; getPersonalizedSuggestions(<span class="hljs-built_in">String</span> userId);
  
  <span class="hljs-comment">// 更新建议数据</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; updateSuggestionData();
}
</code></pre>
<h2 id="数据模型">数据模型</h2>
<h3 id="搜索查询模型">搜索查询模型</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchQuery</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> keyword;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; categories;
  <span class="hljs-keyword">final</span> SearchScope scope;
  <span class="hljs-keyword">final</span> SortOption sortBy;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> page;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> pageSize;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; filters;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> includeHistory;
}

<span class="hljs-keyword">enum</span> SearchScope {
  all,        <span class="hljs-comment">// 全部内容</span>
  vehicle,    <span class="hljs-comment">// 车辆相关</span>
  order,      <span class="hljs-comment">// 订单相关</span>
  service,    <span class="hljs-comment">// 服务相关</span>
  settings,   <span class="hljs-comment">// 设置相关</span>
  help        <span class="hljs-comment">// 帮助文档</span>
}

<span class="hljs-keyword">enum</span> SortOption {
  relevance,  <span class="hljs-comment">// 相关性</span>
  time,       <span class="hljs-comment">// 时间</span>
  popularity, <span class="hljs-comment">// 热度</span>
  alphabetical <span class="hljs-comment">// 字母顺序</span>
}
</code></pre>
<h3 id="搜索结果模型">搜索结果模型</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchResult</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> query;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> totalCount;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;SearchResultItem&gt; items;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;SearchSuggestion&gt; suggestions;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Duration</span> searchTime;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">int</span>&gt; categoryCount;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> hasMore;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchResultItem</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> title;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> subtitle;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> description;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> category;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> moduleId;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> imageUrl;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> relevanceScore;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">DateTime?</span> timestamp;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; metadata;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;HighlightRange&gt; highlights;
}
</code></pre>
<h3 id="搜索建议模型">搜索建议模型</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchSuggestion</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> text;
  <span class="hljs-keyword">final</span> SuggestionType type;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> category;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> frequency;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> relevance;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;? metadata;
}

<span class="hljs-keyword">enum</span> SuggestionType {
  keyword,     <span class="hljs-comment">// 关键词建议</span>
  history,     <span class="hljs-comment">// 历史搜索</span>
  popular,     <span class="hljs-comment">// 热门搜索</span>
  completion,  <span class="hljs-comment">// 自动补全</span>
  correction   <span class="hljs-comment">// 拼写纠错</span>
}
</code></pre>
<h2 id="api-接口">API 接口</h2>
<h3 id="搜索接口">搜索接口</h3>
<pre><code class="language-dart"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlobalSearchService</span> </span>{
  <span class="hljs-comment">// 执行全局搜索</span>
  Future&lt;ApiResponse&lt;SearchResult&gt;&gt; search(SearchRequest request);
  
  <span class="hljs-comment">// 获取搜索建议</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">List</span>&lt;SearchSuggestion&gt;&gt;&gt; getSuggestions(SuggestionRequest request);
  
  <span class="hljs-comment">// 获取热门搜索</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt;&gt;&gt; getPopularSearches();
  
  <span class="hljs-comment">// 获取搜索历史</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">List</span>&lt;SearchRecord&gt;&gt;&gt; getSearchHistory(HistoryRequest request);
}
</code></pre>
<h3 id="索引管理接口">索引管理接口</h3>
<pre><code class="language-dart"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchIndexService</span> </span>{
  <span class="hljs-comment">// 更新搜索索引</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">bool</span>&gt;&gt; updateSearchIndex(UpdateIndexRequest request);
  
  <span class="hljs-comment">// 删除搜索索引</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">bool</span>&gt;&gt; deleteSearchIndex(DeleteIndexRequest request);
  
  <span class="hljs-comment">// 获取索引状态</span>
  Future&lt;ApiResponse&lt;IndexStatus&gt;&gt; getIndexStatus(<span class="hljs-built_in">String</span> moduleId);
}
</code></pre>
<h3 id="搜索提供者接口">搜索提供者接口</h3>
<pre><code class="language-dart"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchProvider</span> </span>{
  <span class="hljs-comment">// 搜索提供者ID</span>
  <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> providerId;
  
  <span class="hljs-comment">// 支持的搜索类别</span>
  <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; <span class="hljs-keyword">get</span> supportedCategories;
  
  <span class="hljs-comment">// 执行搜索</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;SearchResultItem&gt;&gt; search(SearchQuery query);
  
  <span class="hljs-comment">// 获取可搜索项目</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;SearchableItem&gt;&gt; getSearchableItems();
  
  <span class="hljs-comment">// 获取搜索建议</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;SearchSuggestion&gt;&gt; getSuggestions(<span class="hljs-built_in">String</span> input);
}
</code></pre>
<h2 id="配置管理">配置管理</h2>
<h3 id="搜索配置">搜索配置</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlobalSearchConfig</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> maxResults;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> suggestionLimit;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> enableHistory;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> enableSuggestions;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Duration</span> cacheExpiry;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; enabledModules;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">double</span>&gt; categoryWeights;
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> GlobalSearchConfig defaultConfig = GlobalSearchConfig(
    maxResults: <span class="hljs-number">100</span>,
    suggestionLimit: <span class="hljs-number">10</span>,
    enableHistory: <span class="hljs-keyword">true</span>,
    enableSuggestions: <span class="hljs-keyword">true</span>,
    cacheExpiry: <span class="hljs-built_in">Duration</span>(minutes: <span class="hljs-number">30</span>),
    enabledModules: [<span class="hljs-string">&#x27;vehicle&#x27;</span>, <span class="hljs-string">&#x27;order&#x27;</span>, <span class="hljs-string">&#x27;service&#x27;</span>, <span class="hljs-string">&#x27;settings&#x27;</span>],
    categoryWeights: {
      <span class="hljs-string">&#x27;vehicle&#x27;</span>: <span class="hljs-number">1.0</span>,
      <span class="hljs-string">&#x27;order&#x27;</span>: <span class="hljs-number">0.8</span>,
      <span class="hljs-string">&#x27;service&#x27;</span>: <span class="hljs-number">0.9</span>,
      <span class="hljs-string">&#x27;settings&#x27;</span>: <span class="hljs-number">0.6</span>,
    },
  );
}
</code></pre>
<h3 id="索引配置">索引配置</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchIndexConfig</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> enableRealTimeIndex;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Duration</span> indexUpdateInterval;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> maxIndexSize;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; indexedFields;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">int</span>&gt; fieldWeights;
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> SearchIndexConfig defaultIndexConfig = SearchIndexConfig(
    enableRealTimeIndex: <span class="hljs-keyword">true</span>,
    indexUpdateInterval: <span class="hljs-built_in">Duration</span>(minutes: <span class="hljs-number">5</span>),
    maxIndexSize: <span class="hljs-number">10000</span>,
    indexedFields: [<span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;description&#x27;</span>, <span class="hljs-string">&#x27;tags&#x27;</span>, <span class="hljs-string">&#x27;content&#x27;</span>],
    fieldWeights: {
      <span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-number">3</span>,
      <span class="hljs-string">&#x27;description&#x27;</span>: <span class="hljs-number">2</span>,
      <span class="hljs-string">&#x27;tags&#x27;</span>: <span class="hljs-number">2</span>,
      <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-number">1</span>,
    },
  );
}
</code></pre>
<h2 id="使用示例">使用示例</h2>
<h3 id="基本搜索功能">基本搜索功能</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 初始化全局搜索</span>
<span class="hljs-keyword">final</span> globalSearch = GlobalSearchEngine.instance;
<span class="hljs-keyword">await</span> globalSearch.initialize(GlobalSearchConfig.defaultConfig);

<span class="hljs-comment">// 执行搜索</span>
<span class="hljs-keyword">final</span> searchQuery = SearchQuery(
  keyword: <span class="hljs-string">&#x27;充电&#x27;</span>,
  categories: [<span class="hljs-string">&#x27;vehicle&#x27;</span>, <span class="hljs-string">&#x27;service&#x27;</span>],
  scope: SearchScope.all,
  sortBy: SortOption.relevance,
  page: <span class="hljs-number">1</span>,
  pageSize: <span class="hljs-number">20</span>,
);

<span class="hljs-keyword">final</span> searchResult = <span class="hljs-keyword">await</span> globalSearch.search(searchQuery);

<span class="hljs-comment">// 处理搜索结果</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> item <span class="hljs-keyword">in</span> searchResult.items) {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;<span class="hljs-subst">${item.title}</span>: <span class="hljs-subst">${item.description}</span>&#x27;</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;类别: <span class="hljs-subst">${item.category}</span>, 相关性: <span class="hljs-subst">${item.relevanceScore}</span>&#x27;</span>);
}
</code></pre>
<h3 id="搜索建议功能">搜索建议功能</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 获取输入建议</span>
<span class="hljs-keyword">final</span> suggestions = <span class="hljs-keyword">await</span> globalSearch.getSuggestions(<span class="hljs-string">&#x27;充电&#x27;</span>);

<span class="hljs-comment">// 显示建议列表</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> suggestion <span class="hljs-keyword">in</span> suggestions) {
  <span class="hljs-keyword">switch</span> (suggestion.type) {
    <span class="hljs-keyword">case</span> SuggestionType.completion:
      <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;补全: <span class="hljs-subst">${suggestion.text}</span>&#x27;</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SuggestionType.history:
      <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;历史: <span class="hljs-subst">${suggestion.text}</span>&#x27;</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SuggestionType.popular:
      <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;热门: <span class="hljs-subst">${suggestion.text}</span>&#x27;</span>);
      <span class="hljs-keyword">break</span>;
  }
}

<span class="hljs-comment">// 获取热门搜索</span>
<span class="hljs-keyword">final</span> popularSearches = <span class="hljs-keyword">await</span> globalSearch.getPopularSearches();
<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;热门搜索: <span class="hljs-subst">${popularSearches.join(<span class="hljs-string">&#x27;, &#x27;</span>)}</span>&#x27;</span>);
</code></pre>
<h3 id="搜索历史管理">搜索历史管理</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 添加搜索记录</span>
<span class="hljs-keyword">final</span> searchRecord = SearchRecord(
  query: <span class="hljs-string">&#x27;充电站&#x27;</span>,
  timestamp: <span class="hljs-built_in">DateTime</span>.now(),
  resultCount: <span class="hljs-number">25</span>,
  category: <span class="hljs-string">&#x27;vehicle&#x27;</span>,
);

<span class="hljs-keyword">await</span> SearchHistoryManager.instance.addSearchRecord(searchRecord);

<span class="hljs-comment">// 获取搜索历史</span>
<span class="hljs-keyword">final</span> history = <span class="hljs-keyword">await</span> SearchHistoryManager.instance.getSearchHistory(limit: <span class="hljs-number">10</span>);

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> record <span class="hljs-keyword">in</span> history) {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;<span class="hljs-subst">${record.query}</span> - <span class="hljs-subst">${record.timestamp}</span>&#x27;</span>);
}

<span class="hljs-comment">// 清空搜索历史</span>
<span class="hljs-keyword">await</span> SearchHistoryManager.instance.clearSearchHistory();
</code></pre>
<h3 id="注册搜索提供者">注册搜索提供者</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 实现搜索提供者</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleSearchProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SearchProvider</span> </span>{
  <span class="hljs-meta">@override</span>
  <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> providerId =&gt; <span class="hljs-string">&#x27;vehicle_search&#x27;</span>;
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; <span class="hljs-keyword">get</span> supportedCategories =&gt; [<span class="hljs-string">&#x27;vehicle&#x27;</span>, <span class="hljs-string">&#x27;charging&#x27;</span>, <span class="hljs-string">&#x27;maintenance&#x27;</span>];
  
  <span class="hljs-meta">@override</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;SearchResultItem&gt;&gt; search(SearchQuery query) <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 实现车辆相关内容搜索</span>
    <span class="hljs-keyword">final</span> vehicles = <span class="hljs-keyword">await</span> vehicleService.searchVehicles(query.keyword);
    
    <span class="hljs-keyword">return</span> vehicles.map((vehicle) =&gt; SearchResultItem(
      id: vehicle.id,
      title: vehicle.name,
      description: vehicle.description,
      category: <span class="hljs-string">&#x27;vehicle&#x27;</span>,
      moduleId: <span class="hljs-string">&#x27;app_car&#x27;</span>,
      relevanceScore: calculateRelevance(query.keyword, vehicle),
    )).toList();
  }
  
  <span class="hljs-meta">@override</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;SearchSuggestion&gt;&gt; getSuggestions(<span class="hljs-built_in">String</span> input) <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 返回车辆相关搜索建议</span>
    <span class="hljs-keyword">return</span> vehicleService.getSearchSuggestions(input);
  }
}

<span class="hljs-comment">// 注册搜索提供者</span>
globalSearch.registerSearchProvider(VehicleSearchProvider());
</code></pre>
<h2 id="测试策略">测试策略</h2>
<h3 id="单元测试">单元测试</h3>
<pre><code class="language-dart">group(<span class="hljs-string">&#x27;GlobalSearch Tests&#x27;</span>, () {
  test(<span class="hljs-string">&#x27;should return search results&#x27;</span>, () <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// Given</span>
    <span class="hljs-keyword">final</span> searchEngine = GlobalSearchEngine();
    <span class="hljs-keyword">final</span> query = SearchQuery(keyword: <span class="hljs-string">&#x27;test&#x27;</span>, scope: SearchScope.all);
    
    <span class="hljs-comment">// When</span>
    <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> searchEngine.search(query);
    
    <span class="hljs-comment">// Then</span>
    expect(result.items, isNotEmpty);
    expect(result.query, <span class="hljs-string">&#x27;test&#x27;</span>);
  });
  
  test(<span class="hljs-string">&#x27;should provide search suggestions&#x27;</span>, () <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// Given</span>
    <span class="hljs-keyword">final</span> suggestionSystem = SearchSuggestionSystem();
    
    <span class="hljs-comment">// When</span>
    <span class="hljs-keyword">final</span> suggestions = <span class="hljs-keyword">await</span> suggestionSystem.generateSuggestions(<span class="hljs-string">&#x27;cha&#x27;</span>);
    
    <span class="hljs-comment">// Then</span>
    expect(suggestions, isNotEmpty);
    expect(suggestions.first.text, contains(<span class="hljs-string">&#x27;cha&#x27;</span>));
  });
});
</code></pre>
<h3 id="集成测试">集成测试</h3>
<pre><code class="language-dart">group(<span class="hljs-string">&#x27;Search Integration Tests&#x27;</span>, () {
  testWidgets(<span class="hljs-string">&#x27;complete search flow&#x27;</span>, (tester) <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 1. 输入搜索关键词</span>
    <span class="hljs-keyword">await</span> tester.enterText(find.byKey(Key(<span class="hljs-string">&#x27;search_input&#x27;</span>)), <span class="hljs-string">&#x27;充电&#x27;</span>);
    
    <span class="hljs-comment">// 2. 验证搜索建议显示</span>
    expect(find.text(<span class="hljs-string">&#x27;充电站&#x27;</span>), findsOneWidget);
    expect(find.text(<span class="hljs-string">&#x27;充电桩&#x27;</span>), findsOneWidget);
    
    <span class="hljs-comment">// 3. 执行搜索</span>
    <span class="hljs-keyword">await</span> tester.tap(find.byKey(Key(<span class="hljs-string">&#x27;search_button&#x27;</span>)));
    <span class="hljs-keyword">await</span> tester.pumpAndSettle();
    
    <span class="hljs-comment">// 4. 验证搜索结果</span>
    expect(find.byType(SearchResultItem), findsWidgets);
  });
});
</code></pre>
<h2 id="性能优化">性能优化</h2>
<h3 id="搜索性能优化">搜索性能优化</h3>
<ul>
<li><strong>索引优化</strong>：使用倒排索引提高搜索速度</li>
<li><strong>缓存策略</strong>：热门搜索结果缓存</li>
<li><strong>分页加载</strong>：大结果集分页加载</li>
<li><strong>异步处理</strong>：搜索操作异步处理</li>
</ul>
<h3 id="内存优化">内存优化</h3>
<ul>
<li><strong>结果限制</strong>：限制搜索结果数量</li>
<li><strong>懒加载</strong>：搜索结果懒加载</li>
<li><strong>对象池</strong>：复用搜索对象</li>
<li><strong>内存回收</strong>：及时回收不用的搜索数据</li>
</ul>
<h2 id="算法和策略">算法和策略</h2>
<h3 id="相关性算法">相关性算法</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RelevanceCalculator</span> </span>{
  <span class="hljs-comment">// 计算文本相关性</span>
  <span class="hljs-built_in">double</span> calculateTextRelevance(<span class="hljs-built_in">String</span> query, <span class="hljs-built_in">String</span> text);
  
  <span class="hljs-comment">// 计算标题权重</span>
  <span class="hljs-built_in">double</span> calculateTitleWeight(<span class="hljs-built_in">String</span> query, <span class="hljs-built_in">String</span> title);
  
  <span class="hljs-comment">// 计算类别权重</span>
  <span class="hljs-built_in">double</span> calculateCategoryWeight(<span class="hljs-built_in">String</span> category);
  
  <span class="hljs-comment">// 计算综合得分</span>
  <span class="hljs-built_in">double</span> calculateFinalScore(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">double</span>&gt; scores);
}
</code></pre>
<h3 id="搜索优化策略">搜索优化策略</h3>
<ul>
<li><strong>查询扩展</strong>：同义词和相关词扩展</li>
<li><strong>模糊匹配</strong>：支持模糊匹配搜索</li>
<li><strong>权重调整</strong>：动态调整搜索权重</li>
<li><strong>个性化排序</strong>：基于用户行为的个性化排序</li>
</ul>
<h2 id="版本历史">版本历史</h2>
<h3 id="v0325-当前版本">v0.3.2+5 (当前版本)</h3>
<ul>
<li>新增语义搜索功能</li>
<li>优化搜索性能和准确性</li>
<li>支持多语言搜索</li>
<li>修复搜索结果排序问题</li>
</ul>
<h3 id="v031">v0.3.1</h3>
<ul>
<li>支持实时搜索建议</li>
<li>新增搜索历史管理</li>
<li>优化搜索索引结构</li>
<li>改进搜索结果展示</li>
</ul>
<h2 id="依赖关系">依赖关系</h2>
<h3 id="内部依赖">内部依赖</h3>
<ul>
<li><code>basic_storage</code>: 本地数据存储</li>
<li><code>basic_network</code>: 网络请求服务</li>
<li><code>basic_utils</code>: 工具类库</li>
<li><code>basic_logger</code>: 日志记录</li>
</ul>
<h3 id="外部依赖">外部依赖</h3>
<ul>
<li><code>sqflite</code>: 本地数据库</li>
<li><code>fuzzywuzzy</code>: 模糊匹配算法</li>
<li><code>rxdart</code>: 响应式编程</li>
<li><code>collection</code>: 集合工具</li>
</ul>
<h2 id="总结">总结</h2>
<p><code>GlobalSearch</code> 模块为 OneApp 提供了强大的全局搜索能力，通过统一的搜索接口、智能的搜索建议、完善的历史管理和优化的搜索结果，为用户提供了高效、精准的搜索体验。该模块的设计充分考虑了可扩展性、性能优化和用户体验，能够很好地支撑应用的搜索需求。</p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>