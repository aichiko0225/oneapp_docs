<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>ShareToFriends - &#x5206;&#x4eab;&#x529f;&#x80fd;&#x6a21;&#x5757;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="sharetofriends---分享功能模块">ShareToFriends - 分享功能模块</h1>
<h2 id="模块概述">模块概述</h2>
<p><code>ShareToFriends</code> 是 OneApp 的分享功能模块，提供了完整的社交分享解决方案。该模块支持多种社交平台分享、自定义分享内容、分享统计分析和权限控制等功能，为用户提供便捷的内容分享体验。</p>
<h2 id="核心功能">核心功能</h2>
<h3 id="1-社交平台分享">1. 社交平台分享</h3>
<ul>
<li><strong>多平台支持</strong>：支持微信、QQ、微博、抖音等主流平台</li>
<li><strong>原生集成</strong>：深度集成各平台原生分享能力</li>
<li><strong>格式适配</strong>：自动适配各平台的内容格式要求</li>
<li><strong>状态跟踪</strong>：跟踪分享状态和结果反馈</li>
</ul>
<h3 id="2-自定义分享内容">2. 自定义分享内容</h3>
<ul>
<li><strong>内容模板</strong>：提供丰富的分享内容模板</li>
<li><strong>动态生成</strong>：根据分享内容动态生成分享素材</li>
<li><strong>多媒体支持</strong>：支持文字、图片、视频、链接分享</li>
<li><strong>品牌定制</strong>：支持品牌元素的自定义添加</li>
</ul>
<h3 id="3-分享统计分析">3. 分享统计分析</h3>
<ul>
<li><strong>分享数据统计</strong>：统计分享次数、平台分布等数据</li>
<li><strong>用户行为分析</strong>：分析用户分享行为和偏好</li>
<li><strong>转化率跟踪</strong>：跟踪分享带来的转化效果</li>
<li><strong>热点内容识别</strong>：识别热门分享内容</li>
</ul>
<h3 id="4-分享权限控制">4. 分享权限控制</h3>
<ul>
<li><strong>内容权限</strong>：控制可分享的内容范围</li>
<li><strong>用户权限</strong>：基于用户角色的分享权限</li>
<li><strong>平台限制</strong>：特定平台的分享限制</li>
<li><strong>敏感内容过滤</strong>：过滤敏感或不当内容</li>
</ul>
<h2 id="技术架构">技术架构</h2>
<h3 id="架构设计">架构设计</h3>
<pre><code>┌─────────────────────────────────────┐
│            应用界面层                │
│         (Share UI Components)       │
├─────────────────────────────────────┤
│         ShareToFriends              │
│  ┌──────────┬──────────┬──────────┐ │
│  │ 分享管理 │ 内容生成 │ 平台适配 │ │
│  ├──────────┼──────────┼──────────┤ │
│  │ 统计分析 │ 权限控制 │ 缓存管理 │ │
│  └──────────┴──────────┴──────────┘ │
├─────────────────────────────────────┤
│           平台SDK层                 │
│  ┌──────────┬──────────┬──────────┐ │
│  │ 微信SDK  │ QQ SDK   │ 微博SDK  │ │
│  └──────────┴──────────┴──────────┘ │
├─────────────────────────────────────┤
│           系统分享接口              │
│       (System Share APIs)           │
└─────────────────────────────────────┘
</code></pre>
<h3 id="核心组件">核心组件</h3>
<h4 id="1-分享管理器-sharemanager">1. 分享管理器 (ShareManager)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShareManager</span> </span>{
  <span class="hljs-comment">// 执行分享</span>
  Future&lt;ShareResult&gt; share(ShareRequest request);
  
  <span class="hljs-comment">// 获取可用的分享平台</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;SharePlatform&gt;&gt; getAvailablePlatforms();
  
  <span class="hljs-comment">// 检查平台可用性</span>
  Future&lt;<span class="hljs-built_in">bool</span>&gt; isPlatformAvailable(SharePlatformType platform);
  
  <span class="hljs-comment">// 注册分享平台</span>
  <span class="hljs-keyword">void</span> registerPlatform(SharePlatform platform);
}
</code></pre>
<h4 id="2-内容生成器-contentgenerator">2. 内容生成器 (ContentGenerator)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShareContentGenerator</span> </span>{
  <span class="hljs-comment">// 生成分享内容</span>
  Future&lt;ShareContent&gt; generateContent(ContentTemplate template, <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; data);
  
  <span class="hljs-comment">// 创建分享图片</span>
  Future&lt;File&gt; createShareImage(ShareImageConfig config);
  
  <span class="hljs-comment">// 生成分享链接</span>
  Future&lt;<span class="hljs-built_in">String</span>&gt; generateShareLink(ShareLinkConfig config);
  
  <span class="hljs-comment">// 格式化分享文本</span>
  <span class="hljs-built_in">String</span> formatShareText(<span class="hljs-built_in">String</span> template, <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; variables);
}
</code></pre>
<h4 id="3-平台适配器-platformadapter">3. 平台适配器 (PlatformAdapter)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SharePlatformAdapter</span> </span>{
  <span class="hljs-comment">// 适配分享内容</span>
  ShareContent adaptContent(ShareContent content, SharePlatformType platform);
  
  <span class="hljs-comment">// 验证内容格式</span>
  ValidationResult validateContent(ShareContent content, SharePlatformType platform);
  
  <span class="hljs-comment">// 获取平台限制</span>
  PlatformLimitations getPlatformLimitations(SharePlatformType platform);
  
  <span class="hljs-comment">// 转换内容格式</span>
  ShareContent convertContentFormat(ShareContent content, ContentFormat targetFormat);
}
</code></pre>
<h4 id="4-统计分析器-shareanalytics">4. 统计分析器 (ShareAnalytics)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShareAnalytics</span> </span>{
  <span class="hljs-comment">// 记录分享事件</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; recordShareEvent(ShareEvent event);
  
  <span class="hljs-comment">// 获取分享统计</span>
  Future&lt;ShareStatistics&gt; getShareStatistics(StatisticsQuery query);
  
  <span class="hljs-comment">// 分析用户分享行为</span>
  Future&lt;UserShareBehavior&gt; analyzeUserBehavior(<span class="hljs-built_in">String</span> userId);
  
  <span class="hljs-comment">// 获取热门分享内容</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;PopularContent&gt;&gt; getPopularContent(TimeRange timeRange);
}
</code></pre>
<h2 id="数据模型">数据模型</h2>
<h3 id="分享请求模型">分享请求模型</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShareRequest</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id;
  <span class="hljs-keyword">final</span> ShareContent content;
  <span class="hljs-keyword">final</span> SharePlatformType platform;
  <span class="hljs-keyword">final</span> ShareOptions options;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> userId;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; metadata;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">DateTime</span> timestamp;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShareContent</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> title;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> description;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> text;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; images;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> video;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> url;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> thumbnailUrl;
  <span class="hljs-keyword">final</span> ContentType type;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; extras;
}

<span class="hljs-keyword">enum</span> ContentType {
  text,         <span class="hljs-comment">// 纯文本</span>
  image,        <span class="hljs-comment">// 图片</span>
  video,        <span class="hljs-comment">// 视频</span>
  link,         <span class="hljs-comment">// 链接</span>
  miniProgram,  <span class="hljs-comment">// 小程序</span>
  music,        <span class="hljs-comment">// 音乐</span>
  file          <span class="hljs-comment">// 文件</span>
}
</code></pre>
<h3 id="分享平台模型">分享平台模型</h3>
<pre><code class="language-dart"><span class="hljs-keyword">enum</span> SharePlatformType {
  wechat,           <span class="hljs-comment">// 微信好友</span>
  wechatMoments,    <span class="hljs-comment">// 微信朋友圈</span>
  qq,               <span class="hljs-comment">// QQ好友</span>
  qzone,            <span class="hljs-comment">// QQ空间</span>
  weibo,            <span class="hljs-comment">// 新浪微博</span>
  douyin,           <span class="hljs-comment">// 抖音</span>
  system,           <span class="hljs-comment">// 系统分享</span>
  copy,             <span class="hljs-comment">// 复制链接</span>
  email,            <span class="hljs-comment">// 邮件</span>
  sms               <span class="hljs-comment">// 短信</span>
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SharePlatform</span> </span>{
  <span class="hljs-keyword">final</span> SharePlatformType type;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> name;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> packageName;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> iconUrl;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> isInstalled;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> isEnabled;
  <span class="hljs-keyword">final</span> PlatformLimitations limitations;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; config;
}
</code></pre>
<h3 id="分享结果模型">分享结果模型</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShareResult</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> isSuccess;
  <span class="hljs-keyword">final</span> SharePlatformType platform;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> shareId;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> errorMessage;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int?</span> errorCode;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">DateTime</span> timestamp;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; extraData;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShareStatistics</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> totalShares;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;SharePlatformType, <span class="hljs-built_in">int</span>&gt; platformDistribution;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;ContentType, <span class="hljs-built_in">int</span>&gt; contentTypeDistribution;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;ShareTrend&gt; trends;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> averageSharesPerUser;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;TopSharedContent&gt; topContent;
}
</code></pre>
<h2 id="api-接口">API 接口</h2>
<h3 id="分享接口">分享接口</h3>
<pre><code class="language-dart"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShareService</span> </span>{
  <span class="hljs-comment">// 执行分享</span>
  Future&lt;ApiResponse&lt;ShareResult&gt;&gt; executeShare(ShareRequest request);
  
  <span class="hljs-comment">// 获取分享平台列表</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">List</span>&lt;SharePlatform&gt;&gt;&gt; getSharePlatforms();
  
  <span class="hljs-comment">// 预览分享内容</span>
  Future&lt;ApiResponse&lt;SharePreview&gt;&gt; previewShare(PreviewRequest request);
  
  <span class="hljs-comment">// 获取分享历史</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">List</span>&lt;ShareRecord&gt;&gt;&gt; getShareHistory(HistoryQuery query);
}
</code></pre>
<h3 id="内容生成接口">内容生成接口</h3>
<pre><code class="language-dart"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShareContentService</span> </span>{
  <span class="hljs-comment">// 生成分享内容</span>
  Future&lt;ApiResponse&lt;ShareContent&gt;&gt; generateShareContent(ContentGenerationRequest request);
  
  <span class="hljs-comment">// 创建分享海报</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">String</span>&gt;&gt; createSharePoster(PosterCreationRequest request);
  
  <span class="hljs-comment">// 获取内容模板</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">List</span>&lt;ContentTemplate&gt;&gt;&gt; getContentTemplates(<span class="hljs-built_in">String</span> category);
}
</code></pre>
<h3 id="统计分析接口">统计分析接口</h3>
<pre><code class="language-dart"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShareAnalyticsService</span> </span>{
  <span class="hljs-comment">// 获取分享统计数据</span>
  Future&lt;ApiResponse&lt;ShareStatistics&gt;&gt; getShareStatistics(StatisticsRequest request);
  
  <span class="hljs-comment">// 获取用户分享行为</span>
  Future&lt;ApiResponse&lt;UserShareBehavior&gt;&gt; getUserShareBehavior(<span class="hljs-built_in">String</span> userId);
  
  <span class="hljs-comment">// 获取热门分享内容</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">List</span>&lt;PopularContent&gt;&gt;&gt; getPopularContent(PopularContentRequest request);
}
</code></pre>
<h2 id="配置管理">配置管理</h2>
<h3 id="分享配置">分享配置</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShareConfig</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;SharePlatformType&gt; enabledPlatforms;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> enableAnalytics;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> enableContentGeneration;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> maxImageSize;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Duration</span> shareTimeout;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;SharePlatformType, PlatformConfig&gt; platformConfigs;
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> ShareConfig defaultConfig = ShareConfig(
    enabledPlatforms: [
      SharePlatformType.wechat,
      SharePlatformType.wechatMoments,
      SharePlatformType.qq,
      SharePlatformType.qzone,
      SharePlatformType.weibo,
      SharePlatformType.system,
    ],
    enableAnalytics: <span class="hljs-keyword">true</span>,
    enableContentGeneration: <span class="hljs-keyword">true</span>,
    maxImageSize: <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-comment">// 2MB</span>
    shareTimeout: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">30</span>),
    platformConfigs: {},
  );
}
</code></pre>
<h3 id="内容配置">内容配置</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContentConfig</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> appName;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> appDescription;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> defaultShareUrl;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> logoUrl;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; shareTemplates;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; sensitiveWords;
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> ContentConfig defaultContentConfig = ContentConfig(
    appName: <span class="hljs-string">&#x27;OneApp&#x27;</span>,
    appDescription: <span class="hljs-string">&#x27;智能车联网应用&#x27;</span>,
    defaultShareUrl: <span class="hljs-string">&#x27;https://oneapp.com&#x27;</span>,
    logoUrl: <span class="hljs-string">&#x27;https://oneapp.com/logo.png&#x27;</span>,
    shareTemplates: {
      <span class="hljs-string">&#x27;vehicle&#x27;</span>: <span class="hljs-string">&#x27;我在OneApp发现了一款不错的车辆：{vehicleName}&#x27;</span>,
      <span class="hljs-string">&#x27;charging&#x27;</span>: <span class="hljs-string">&#x27;在OneApp找到了便宜的充电站，分享给你：{stationName}&#x27;</span>,
    },
    sensitiveWords: [<span class="hljs-string">&#x27;敏感词1&#x27;</span>, <span class="hljs-string">&#x27;敏感词2&#x27;</span>],
  );
}
</code></pre>
<h2 id="使用示例">使用示例</h2>
<h3 id="基本分享功能">基本分享功能</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 分享文本内容</span>
<span class="hljs-keyword">final</span> shareRequest = ShareRequest(
  id: <span class="hljs-string">&#x27;share_text_<span class="hljs-subst">${DateTime.now().millisecondsSinceEpoch}</span>&#x27;</span>,
  content: ShareContent(
    text: <span class="hljs-string">&#x27;我在使用OneApp，感觉很不错！&#x27;</span>,
    url: <span class="hljs-string">&#x27;https://oneapp.com&#x27;</span>,
    type: ContentType.text,
  ),
  platform: SharePlatformType.wechat,
  options: ShareOptions(
    enableAnalytics: <span class="hljs-keyword">true</span>,
    autoGenerateImage: <span class="hljs-keyword">false</span>,
  ),
);

<span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> ShareManager.instance.share(shareRequest);

<span class="hljs-keyword">if</span> (result.isSuccess) {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;分享成功&#x27;</span>);
} <span class="hljs-keyword">else</span> {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;分享失败: <span class="hljs-subst">${result.errorMessage}</span>&#x27;</span>);
}
</code></pre>
<h3 id="分享图片内容">分享图片内容</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 分享车辆信息</span>
<span class="hljs-keyword">final</span> vehicleInfo = {
  <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Model Y&#x27;</span>,
  <span class="hljs-string">&#x27;brand&#x27;</span>: <span class="hljs-string">&#x27;Tesla&#x27;</span>,
  <span class="hljs-string">&#x27;price&#x27;</span>: <span class="hljs-string">&#x27;30万&#x27;</span>,
  <span class="hljs-string">&#x27;image&#x27;</span>: <span class="hljs-string">&#x27;https://example.com/vehicle.jpg&#x27;</span>,
};

<span class="hljs-comment">// 生成分享内容</span>
<span class="hljs-keyword">final</span> shareContent = <span class="hljs-keyword">await</span> ShareContentGenerator.instance.generateContent(
  ContentTemplate.vehicle,
  vehicleInfo,
);

<span class="hljs-comment">// 创建分享海报</span>
<span class="hljs-keyword">final</span> posterPath = <span class="hljs-keyword">await</span> ShareContentGenerator.instance.createShareImage(
  ShareImageConfig(
    template: <span class="hljs-string">&#x27;vehicle_poster&#x27;</span>,
    data: vehicleInfo,
    size: Size(<span class="hljs-number">750</span>, <span class="hljs-number">1334</span>),
  ),
);

<span class="hljs-comment">// 执行分享</span>
<span class="hljs-keyword">final</span> shareResult = <span class="hljs-keyword">await</span> ShareManager.instance.share(
  ShareRequest(
    id: <span class="hljs-string">&#x27;share_vehicle&#x27;</span>,
    content: ShareContent(
      title: vehicleInfo[<span class="hljs-string">&#x27;name&#x27;</span>],
      description: <span class="hljs-string">&#x27;<span class="hljs-subst">${vehicleInfo[<span class="hljs-string">&#x27;brand&#x27;</span>]}</span> <span class="hljs-subst">${vehicleInfo[<span class="hljs-string">&#x27;name&#x27;</span>]}</span> - <span class="hljs-subst">${vehicleInfo[<span class="hljs-string">&#x27;price&#x27;</span>]}</span>&#x27;</span>,
      images: [posterPath],
      url: <span class="hljs-string">&#x27;https://oneapp.com/vehicle/<span class="hljs-subst">${vehicleInfo[<span class="hljs-string">&#x27;id&#x27;</span>]}</span>&#x27;</span>,
      type: ContentType.image,
    ),
    platform: SharePlatformType.wechatMoments,
  ),
);
</code></pre>
<h3 id="多平台分享">多平台分享</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 获取可用的分享平台</span>
<span class="hljs-keyword">final</span> availablePlatforms = <span class="hljs-keyword">await</span> ShareManager.instance.getAvailablePlatforms();

<span class="hljs-comment">// 显示分享面板</span>
showSharePanel(
  context: context,
  platforms: availablePlatforms,
  content: shareContent,
  onPlatformSelected: (platform) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> ShareManager.instance.share(
      ShareRequest(
        content: shareContent,
        platform: platform.type,
      ),
    );
    
    <span class="hljs-keyword">if</span> (result.isSuccess) {
      showSuccessToast(<span class="hljs-string">&#x27;分享成功&#x27;</span>);
    } <span class="hljs-keyword">else</span> {
      showErrorToast(<span class="hljs-string">&#x27;分享失败: <span class="hljs-subst">${result.errorMessage}</span>&#x27;</span>);
    }
  },
);
</code></pre>
<h3 id="分享统计分析">分享统计分析</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 获取分享统计数据</span>
<span class="hljs-keyword">final</span> statistics = <span class="hljs-keyword">await</span> ShareAnalytics.instance.getShareStatistics(
  StatisticsQuery(
    timeRange: TimeRange.lastMonth,
    groupBy: GroupBy.platform,
  ),
);

<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;总分享次数: <span class="hljs-subst">${statistics.totalShares}</span>&#x27;</span>);
<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;平台分布:&#x27;</span>);
statistics.platformDistribution.forEach((platform, count) {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;  <span class="hljs-subst">${platform.name}</span>: <span class="hljs-subst">$count</span>次&#x27;</span>);
});

<span class="hljs-comment">// 获取热门分享内容</span>
<span class="hljs-keyword">final</span> popularContent = <span class="hljs-keyword">await</span> ShareAnalytics.instance.getPopularContent(
  TimeRange.lastWeek,
);

<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;热门分享内容:&#x27;</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> content <span class="hljs-keyword">in</span> popularContent) {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;  <span class="hljs-subst">${content.title}</span>: <span class="hljs-subst">${content.shareCount}</span>次分享&#x27;</span>);
}
</code></pre>
<h3 id="自定义分享内容">自定义分享内容</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 注册自定义内容模板</span>
ShareContentGenerator.instance.registerTemplate(
  <span class="hljs-string">&#x27;custom_vehicle&#x27;</span>,
  ContentTemplate(
    id: <span class="hljs-string">&#x27;custom_vehicle&#x27;</span>,
    name: <span class="hljs-string">&#x27;自定义车辆分享&#x27;</span>,
    textTemplate: <span class="hljs-string">&#x27;我在OneApp发现了{brand} {model}，{feature}，推荐给你！&#x27;</span>,
    imageTemplate: <span class="hljs-string">&#x27;custom_vehicle_poster.png&#x27;</span>,
    variables: [<span class="hljs-string">&#x27;brand&#x27;</span>, <span class="hljs-string">&#x27;model&#x27;</span>, <span class="hljs-string">&#x27;feature&#x27;</span>, <span class="hljs-string">&#x27;price&#x27;</span>],
  ),
);

<span class="hljs-comment">// 使用自定义模板生成内容</span>
<span class="hljs-keyword">final</span> customContent = <span class="hljs-keyword">await</span> ShareContentGenerator.instance.generateContent(
  <span class="hljs-string">&#x27;custom_vehicle&#x27;</span>,
  {
    <span class="hljs-string">&#x27;brand&#x27;</span>: <span class="hljs-string">&#x27;BMW&#x27;</span>,
    <span class="hljs-string">&#x27;model&#x27;</span>: <span class="hljs-string">&#x27;iX3&#x27;</span>,
    <span class="hljs-string">&#x27;feature&#x27;</span>: <span class="hljs-string">&#x27;续航500公里&#x27;</span>,
    <span class="hljs-string">&#x27;price&#x27;</span>: <span class="hljs-string">&#x27;40万&#x27;</span>,
  },
);
</code></pre>
<h2 id="测试策略">测试策略</h2>
<h3 id="单元测试">单元测试</h3>
<pre><code class="language-dart">group(<span class="hljs-string">&#x27;ShareManager Tests&#x27;</span>, () {
  test(<span class="hljs-string">&#x27;should share content successfully&#x27;</span>, () <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// Given</span>
    <span class="hljs-keyword">final</span> shareManager = ShareManager();
    <span class="hljs-keyword">final</span> shareRequest = ShareRequest(
      content: ShareContent(text: <span class="hljs-string">&#x27;Test share&#x27;</span>),
      platform: SharePlatformType.system,
    );
    
    <span class="hljs-comment">// When</span>
    <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> shareManager.share(shareRequest);
    
    <span class="hljs-comment">// Then</span>
    expect(result.isSuccess, <span class="hljs-keyword">true</span>);
    expect(result.platform, SharePlatformType.system);
  });
  
  test(<span class="hljs-string">&#x27;should generate share content from template&#x27;</span>, () <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// Given</span>
    <span class="hljs-keyword">final</span> generator = ShareContentGenerator();
    <span class="hljs-keyword">final</span> template = ContentTemplate.vehicle;
    <span class="hljs-keyword">final</span> data = {<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Model 3&#x27;</span>, <span class="hljs-string">&#x27;brand&#x27;</span>: <span class="hljs-string">&#x27;Tesla&#x27;</span>};
    
    <span class="hljs-comment">// When</span>
    <span class="hljs-keyword">final</span> content = <span class="hljs-keyword">await</span> generator.generateContent(template, data);
    
    <span class="hljs-comment">// Then</span>
    expect(content.title, contains(<span class="hljs-string">&#x27;Model 3&#x27;</span>));
    expect(content.description, contains(<span class="hljs-string">&#x27;Tesla&#x27;</span>));
  });
});
</code></pre>
<h3 id="集成测试">集成测试</h3>
<pre><code class="language-dart">group(<span class="hljs-string">&#x27;Share Integration Tests&#x27;</span>, () {
  testWidgets(<span class="hljs-string">&#x27;share flow&#x27;</span>, (tester) <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 1. 点击分享按钮</span>
    <span class="hljs-keyword">await</span> tester.tap(find.byKey(Key(<span class="hljs-string">&#x27;share_button&#x27;</span>)));
    <span class="hljs-keyword">await</span> tester.pumpAndSettle();
    
    <span class="hljs-comment">// 2. 验证分享面板显示</span>
    expect(find.byType(SharePanel), findsOneWidget);
    
    <span class="hljs-comment">// 3. 选择分享平台</span>
    <span class="hljs-keyword">await</span> tester.tap(find.byKey(Key(<span class="hljs-string">&#x27;platform_wechat&#x27;</span>)));
    <span class="hljs-keyword">await</span> tester.pumpAndSettle();
    
    <span class="hljs-comment">// 4. 验证分享执行</span>
    verify(mockShareManager.share(any)).called(<span class="hljs-number">1</span>);
  });
});
</code></pre>
<h2 id="性能优化">性能优化</h2>
<h3 id="内容生成优化">内容生成优化</h3>
<ul>
<li><strong>模板缓存</strong>：缓存常用的内容模板</li>
<li><strong>图片压缩</strong>：自动压缩分享图片</li>
<li><strong>异步处理</strong>：异步生成分享内容</li>
<li><strong>批量处理</strong>：批量处理多个分享请求</li>
</ul>
<h3 id="平台集成优化">平台集成优化</h3>
<ul>
<li><strong>懒加载SDK</strong>：按需加载平台SDK</li>
<li><strong>连接池</strong>：复用网络连接</li>
<li><strong>缓存检查</strong>：缓存平台可用性检查结果</li>
<li><strong>超时控制</strong>：合理的超时时间设置</li>
</ul>
<h2 id="版本历史">版本历史</h2>
<h3 id="v0253-当前版本">v0.2.5+3 (当前版本)</h3>
<ul>
<li>新增抖音分享支持</li>
<li>优化分享内容生成性能</li>
<li>支持自定义分享模板</li>
<li>修复微信分享回调问题</li>
</ul>
<h3 id="v024">v0.2.4</h3>
<ul>
<li>支持视频内容分享</li>
<li>新增分享统计分析</li>
<li>优化分享面板UI</li>
<li>改进错误处理机制</li>
</ul>
<h2 id="依赖关系">依赖关系</h2>
<h3 id="内部依赖">内部依赖</h3>
<ul>
<li><code>basic_utils</code>: 工具类库</li>
<li><code>basic_storage</code>: 本地存储</li>
<li><code>basic_network</code>: 网络请求</li>
<li><code>basic_logger</code>: 日志记录</li>
</ul>
<h3 id="外部依赖">外部依赖</h3>
<ul>
<li><code>fluwx</code>: 微信分享SDK</li>
<li><code>share_plus</code>: 系统分享</li>
<li><code>image</code>: 图片处理</li>
<li><code>path_provider</code>: 文件路径</li>
</ul>
<h2 id="总结">总结</h2>
<p><code>ShareToFriends</code> 模块为 OneApp 提供了完整的社交分享解决方案。通过多平台支持、自定义内容生成、统计分析和权限控制等功能，该模块让用户能够便捷地分享应用内容到各大社交平台，同时为运营团队提供了有价值的分享数据分析，有助于提升用户参与度和应用传播效果。</p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>