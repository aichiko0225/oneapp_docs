<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>OneApp Popup - &#x5f39;&#x7a97;&#x7ba1;&#x7406;&#x6a21;&#x5757;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="oneapp-popup---弹窗管理模块">OneApp Popup - 弹窗管理模块</h1>
<h2 id="模块概述">模块概述</h2>
<p><code>oneapp_popup</code> 是 OneApp 的统一弹窗管理模块，提供了全局弹窗管理、优先级控制、样式定制和生命周期管理等功能。该模块确保应用中所有弹窗的一致性体验，避免弹窗冲突，并提供灵活的弹窗展示策略。</p>
<h2 id="核心功能">核心功能</h2>
<h3 id="1-统一弹窗管理">1. 统一弹窗管理</h3>
<ul>
<li><strong>全局队列</strong>：统一管理所有弹窗显示队列</li>
<li><strong>弹窗注册</strong>：注册和管理不同类型的弹窗</li>
<li><strong>显示控制</strong>：控制弹窗的显示和隐藏</li>
<li><strong>状态管理</strong>：跟踪弹窗的显示状态</li>
</ul>
<h3 id="2-弹窗优先级控制">2. 弹窗优先级控制</h3>
<ul>
<li><strong>优先级排序</strong>：按优先级排序弹窗显示顺序</li>
<li><strong>抢占机制</strong>：高优先级弹窗抢占显示</li>
<li><strong>队列管理</strong>：智能管理弹窗等待队列</li>
<li><strong>冲突解决</strong>：解决弹窗显示冲突</li>
</ul>
<h3 id="3-弹窗样式定制">3. 弹窗样式定制</h3>
<ul>
<li><strong>主题适配</strong>：自动适配应用主题</li>
<li><strong>样式继承</strong>：支持样式继承和覆盖</li>
<li><strong>动画效果</strong>：丰富的弹窗动画效果</li>
<li><strong>响应式设计</strong>：适配不同屏幕尺寸</li>
</ul>
<h3 id="4-弹窗生命周期">4. 弹窗生命周期</h3>
<ul>
<li><strong>生命周期钩子</strong>：完整的生命周期回调</li>
<li><strong>自动销毁</strong>：弹窗自动销毁机制</li>
<li><strong>内存管理</strong>：防止内存泄漏</li>
<li><strong>状态恢复</strong>：应用重启后状态恢复</li>
</ul>
<h2 id="技术架构">技术架构</h2>
<h3 id="架构设计">架构设计</h3>
<pre><code>┌─────────────────────────────────────┐
│            应用界面层                │
│         (Application UI)            │
├─────────────────────────────────────┤
│         OneApp Popup                │
│  ┌──────────┬──────────┬──────────┐ │
│  │ 弹窗管理 │ 队列控制 │ 样式系统 │ │
│  ├──────────┼──────────┼──────────┤ │
│  │ 生命周期 │ 事件系统 │ 动画引擎 │ │
│  └──────────┴──────────┴──────────┘ │
├─────────────────────────────────────┤
│           UI 渲染层                 │
│  ┌──────────┬──────────┬──────────┐ │
│  │ Overlay  │ Dialog   │ BottomSheet │
│  └──────────┴──────────┴──────────┘ │
├─────────────────────────────────────┤
│          Flutter Framework          │
│         (Widget System)             │
└─────────────────────────────────────┘
</code></pre>
<h3 id="核心组件">核心组件</h3>
<h4 id="1-弹窗管理器-popupmanager">1. 弹窗管理器 (PopupManager)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PopupManager</span> </span>{
  <span class="hljs-comment">// 显示弹窗</span>
  Future&lt;T?&gt; <span class="hljs-keyword">show</span>&lt;T&gt;(Popup popup);
  
  <span class="hljs-comment">// 隐藏弹窗</span>
  Future&lt;<span class="hljs-built_in">bool</span>&gt; <span class="hljs-keyword">hide</span>(<span class="hljs-built_in">String</span> popupId);
  
  <span class="hljs-comment">// 隐藏所有弹窗</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; hideAll();
  
  <span class="hljs-comment">// 获取当前弹窗</span>
  Popup? getCurrentPopup();
  
  <span class="hljs-comment">// 获取弹窗队列</span>
  <span class="hljs-built_in">List</span>&lt;Popup&gt; getPopupQueue();
}
</code></pre>
<h4 id="2-弹窗队列控制器-popupqueuecontroller">2. 弹窗队列控制器 (PopupQueueController)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PopupQueueController</span> </span>{
  <span class="hljs-comment">// 添加弹窗到队列</span>
  <span class="hljs-keyword">void</span> enqueue(Popup popup);
  
  <span class="hljs-comment">// 从队列移除弹窗</span>
  <span class="hljs-built_in">bool</span> dequeue(<span class="hljs-built_in">String</span> popupId);
  
  <span class="hljs-comment">// 按优先级排序队列</span>
  <span class="hljs-keyword">void</span> sortByPriority();
  
  <span class="hljs-comment">// 处理下一个弹窗</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; processNext();
}
</code></pre>
<h4 id="3-弹窗样式管理器-popupstylemanager">3. 弹窗样式管理器 (PopupStyleManager)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PopupStyleManager</span> </span>{
  <span class="hljs-comment">// 应用弹窗主题</span>
  PopupTheme applyTheme(PopupStyle style, AppTheme theme);
  
  <span class="hljs-comment">// 创建弹窗样式</span>
  PopupStyle createStyle(PopupType type);
  
  <span class="hljs-comment">// 自定义样式</span>
  PopupStyle customizeStyle(PopupStyle base, StyleOverrides overrides);
  
  <span class="hljs-comment">// 获取默认样式</span>
  PopupStyle getDefaultStyle(PopupType type);
}
</code></pre>
<h4 id="4-弹窗生命周期管理器-popuplifecyclemanager">4. 弹窗生命周期管理器 (PopupLifecycleManager)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PopupLifecycleManager</span> </span>{
  <span class="hljs-comment">// 注册生命周期监听器</span>
  <span class="hljs-keyword">void</span> registerLifecycleListener(<span class="hljs-built_in">String</span> popupId, PopupLifecycleListener listener);
  
  <span class="hljs-comment">// 触发生命周期事件</span>
  <span class="hljs-keyword">void</span> triggerLifecycleEvent(<span class="hljs-built_in">String</span> popupId, PopupLifecycleEvent event);
  
  <span class="hljs-comment">// 清理弹窗资源</span>
  <span class="hljs-keyword">void</span> cleanupPopup(<span class="hljs-built_in">String</span> popupId);
  
  <span class="hljs-comment">// 恢复弹窗状态</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; restorePopupState();
}
</code></pre>
<h2 id="数据模型">数据模型</h2>
<h3 id="弹窗模型">弹窗模型</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Popup</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id;
  <span class="hljs-keyword">final</span> PopupType type;
  <span class="hljs-keyword">final</span> Widget content;
  <span class="hljs-keyword">final</span> PopupPriority priority;
  <span class="hljs-keyword">final</span> PopupStyle? style;
  <span class="hljs-keyword">final</span> PopupOptions options;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; data;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">DateTime</span> createdAt;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Duration?</span> autoHideDelay;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;PopupAction&gt; actions;
}

<span class="hljs-keyword">enum</span> PopupType {
  dialog,        <span class="hljs-comment">// 对话框</span>
  bottomSheet,   <span class="hljs-comment">// 底部弹窗</span>
  toast,         <span class="hljs-comment">// 吐司消息</span>
  overlay,       <span class="hljs-comment">// 覆盖层</span>
  modal,         <span class="hljs-comment">// 模态框</span>
  banner,        <span class="hljs-comment">// 横幅</span>
  snackbar      <span class="hljs-comment">// 快捷消息</span>
}

<span class="hljs-keyword">enum</span> PopupPriority {
  low,          <span class="hljs-comment">// 低优先级</span>
  normal,       <span class="hljs-comment">// 普通优先级</span>
  high,         <span class="hljs-comment">// 高优先级</span>
  critical,     <span class="hljs-comment">// 关键优先级</span>
  emergency     <span class="hljs-comment">// 紧急优先级</span>
}
</code></pre>
<h3 id="弹窗样式模型">弹窗样式模型</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PopupStyle</span> </span>{
  <span class="hljs-keyword">final</span> Color? backgroundColor;
  <span class="hljs-keyword">final</span> BorderRadius? borderRadius;
  <span class="hljs-keyword">final</span> EdgeInsets? padding;
  <span class="hljs-keyword">final</span> EdgeInsets? margin;
  <span class="hljs-keyword">final</span> BoxShadow? shadow;
  <span class="hljs-keyword">final</span> TextStyle? textStyle;
  <span class="hljs-keyword">final</span> PopupAnimation? animation;
  <span class="hljs-keyword">final</span> Alignment? alignment;
  <span class="hljs-keyword">final</span> Size? size;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool?</span> barrierDismissible;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PopupAnimation</span> </span>{
  <span class="hljs-keyword">final</span> AnimationType type;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Duration</span> duration;
  <span class="hljs-keyword">final</span> Curve curve;
  <span class="hljs-keyword">final</span> Offset? slideDirection;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double?</span> scaleStart;
}

<span class="hljs-keyword">enum</span> AnimationType {
  fade,         <span class="hljs-comment">// 淡入淡出</span>
  slide,        <span class="hljs-comment">// 滑动</span>
  scale,        <span class="hljs-comment">// 缩放</span>
  rotate,       <span class="hljs-comment">// 旋转</span>
  bounce,       <span class="hljs-comment">// 弹跳</span>
  none          <span class="hljs-comment">// 无动画</span>
}
</code></pre>
<h3 id="弹窗选项模型">弹窗选项模型</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PopupOptions</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> barrierDismissible;
  <span class="hljs-keyword">final</span> Color? barrierColor;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> barrierLabel;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> useRootNavigator;
  <span class="hljs-keyword">final</span> RouteSettings? routeSettings;
  <span class="hljs-keyword">final</span> Offset? anchorPoint;
  <span class="hljs-keyword">final</span> PopupGravity gravity;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Duration?</span> showDuration;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Duration?</span> hideDuration;
}

<span class="hljs-keyword">enum</span> PopupGravity {
  center,       <span class="hljs-comment">// 居中</span>
  top,          <span class="hljs-comment">// 顶部</span>
  bottom,       <span class="hljs-comment">// 底部</span>
  left,         <span class="hljs-comment">// 左侧</span>
  right,        <span class="hljs-comment">// 右侧</span>
  topLeft,      <span class="hljs-comment">// 左上</span>
  topRight,     <span class="hljs-comment">// 右上</span>
  bottomLeft,   <span class="hljs-comment">// 左下</span>
  bottomRight   <span class="hljs-comment">// 右下</span>
}
</code></pre>
<h2 id="api-接口">API 接口</h2>
<h3 id="弹窗管理接口">弹窗管理接口</h3>
<pre><code class="language-dart"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PopupService</span> </span>{
  <span class="hljs-comment">// 显示弹窗</span>
  Future&lt;ApiResponse&lt;T?&gt;&gt; showPopup&lt;T&gt;(ShowPopupRequest request);
  
  <span class="hljs-comment">// 隐藏弹窗</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">bool</span>&gt;&gt; hidePopup(HidePopupRequest request);
  
  <span class="hljs-comment">// 获取弹窗状态</span>
  Future&lt;ApiResponse&lt;PopupStatus&gt;&gt; getPopupStatus(<span class="hljs-built_in">String</span> popupId);
  
  <span class="hljs-comment">// 清理弹窗</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">bool</span>&gt;&gt; clearPopups(ClearPopupsRequest request);
}
</code></pre>
<h3 id="弹窗样式接口">弹窗样式接口</h3>
<pre><code class="language-dart"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PopupStyleService</span> </span>{
  <span class="hljs-comment">// 获取弹窗主题</span>
  Future&lt;ApiResponse&lt;PopupTheme&gt;&gt; getPopupTheme(<span class="hljs-built_in">String</span> themeId);
  
  <span class="hljs-comment">// 更新弹窗样式</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">bool</span>&gt;&gt; updatePopupStyle(UpdateStyleRequest request);
  
  <span class="hljs-comment">// 获取样式模板</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">List</span>&lt;PopupStyleTemplate&gt;&gt;&gt; getStyleTemplates();
}
</code></pre>
<h2 id="配置管理">配置管理</h2>
<h3 id="弹窗配置">弹窗配置</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PopupConfig</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> maxConcurrentPopups;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Duration</span> defaultAnimationDuration;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> enableGlobalQueue;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> autoHideOnAppBackground;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;PopupType, PopupTypeConfig&gt; typeConfigs;
  <span class="hljs-keyword">final</span> PopupTheme defaultTheme;
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> PopupConfig defaultConfig = PopupConfig(
    maxConcurrentPopups: <span class="hljs-number">3</span>,
    defaultAnimationDuration: <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">300</span>),
    enableGlobalQueue: <span class="hljs-keyword">true</span>,
    autoHideOnAppBackground: <span class="hljs-keyword">true</span>,
    typeConfigs: {
      PopupType.dialog: PopupTypeConfig(
        maxInstances: <span class="hljs-number">1</span>,
        defaultPriority: PopupPriority.high,
      ),
      PopupType.toast: PopupTypeConfig(
        maxInstances: <span class="hljs-number">5</span>,
        defaultPriority: PopupPriority.low,
      ),
    },
    defaultTheme: PopupTheme.defaultTheme,
  );
}
</code></pre>
<h3 id="主题配置">主题配置</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PopupTheme</span> </span>{
  <span class="hljs-keyword">final</span> PopupStyle dialogStyle;
  <span class="hljs-keyword">final</span> PopupStyle toastStyle;
  <span class="hljs-keyword">final</span> PopupStyle bottomSheetStyle;
  <span class="hljs-keyword">final</span> PopupStyle overlayStyle;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, PopupStyle&gt; customStyles;
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> PopupTheme defaultTheme = PopupTheme(
    dialogStyle: PopupStyle(
      backgroundColor: Colors.white,
      borderRadius: BorderRadius.circular(<span class="hljs-number">8.0</span>),
      padding: EdgeInsets.all(<span class="hljs-number">16.0</span>),
      animation: PopupAnimation(
        type: AnimationType.scale,
        duration: <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">300</span>),
      ),
    ),
    toastStyle: PopupStyle(
      backgroundColor: Colors.black87,
      borderRadius: BorderRadius.circular(<span class="hljs-number">24.0</span>),
      padding: EdgeInsets.symmetric(horizontal: <span class="hljs-number">16.0</span>, vertical: <span class="hljs-number">8.0</span>),
      animation: PopupAnimation(
        type: AnimationType.slide,
        duration: <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">200</span>),
      ),
    ),
  );
}
</code></pre>
<h2 id="使用示例">使用示例</h2>
<h3 id="基本弹窗显示">基本弹窗显示</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 显示对话框</span>
<span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> PopupManager.instance.<span class="hljs-keyword">show</span>&lt;<span class="hljs-built_in">bool</span>&gt;(
  Popup(
    id: <span class="hljs-string">&#x27;confirm_dialog&#x27;</span>,
    type: PopupType.dialog,
    priority: PopupPriority.high,
    content: AlertDialog(
      title: Text(<span class="hljs-string">&#x27;确认操作&#x27;</span>),
      content: Text(<span class="hljs-string">&#x27;是否确认执行此操作？&#x27;</span>),
      actions: [
        TextButton(
          onPressed: () =&gt; Navigator.of(context).pop(<span class="hljs-keyword">false</span>),
          child: Text(<span class="hljs-string">&#x27;取消&#x27;</span>),
        ),
        TextButton(
          onPressed: () =&gt; Navigator.of(context).pop(<span class="hljs-keyword">true</span>),
          child: Text(<span class="hljs-string">&#x27;确认&#x27;</span>),
        ),
      ],
    ),
  ),
);

<span class="hljs-keyword">if</span> (result == <span class="hljs-keyword">true</span>) {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;用户确认操作&#x27;</span>);
}
</code></pre>
<h3 id="吐司消息">吐司消息</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 显示成功消息</span>
PopupManager.instance.<span class="hljs-keyword">show</span>(
  Popup(
    id: <span class="hljs-string">&#x27;success_toast&#x27;</span>,
    type: PopupType.toast,
    priority: PopupPriority.normal,
    content: Container(
      padding: EdgeInsets.all(<span class="hljs-number">16.0</span>),
      decoration: BoxDecoration(
        color: Colors.green,
        borderRadius: BorderRadius.circular(<span class="hljs-number">8.0</span>),
      ),
      child: Row(
        mainAxisSize: MainAxisSize.min,
        children: [
          Icon(Icons.check, color: Colors.white),
          SizedBox(width: <span class="hljs-number">8.0</span>),
          Text(<span class="hljs-string">&#x27;操作成功&#x27;</span>, style: TextStyle(color: Colors.white)),
        ],
      ),
    ),
    options: PopupOptions(
      gravity: PopupGravity.top,
      barrierDismissible: <span class="hljs-keyword">false</span>,
    ),
    autoHideDelay: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">3</span>),
  ),
);
</code></pre>
<h3 id="底部弹窗">底部弹窗</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 显示底部选择弹窗</span>
<span class="hljs-keyword">final</span> selectedOption = <span class="hljs-keyword">await</span> PopupManager.instance.<span class="hljs-keyword">show</span>&lt;<span class="hljs-built_in">String</span>&gt;(
  Popup(
    id: <span class="hljs-string">&#x27;bottom_sheet_options&#x27;</span>,
    type: PopupType.bottomSheet,
    priority: PopupPriority.normal,
    content: Column(
      mainAxisSize: MainAxisSize.min,
      children: [
        ListTile(
          leading: Icon(Icons.camera),
          title: Text(<span class="hljs-string">&#x27;拍照&#x27;</span>),
          onTap: () =&gt; Navigator.of(context).pop(<span class="hljs-string">&#x27;camera&#x27;</span>),
        ),
        ListTile(
          leading: Icon(Icons.photo_library),
          title: Text(<span class="hljs-string">&#x27;从相册选择&#x27;</span>),
          onTap: () =&gt; Navigator.of(context).pop(<span class="hljs-string">&#x27;gallery&#x27;</span>),
        ),
        ListTile(
          leading: Icon(Icons.cancel),
          title: Text(<span class="hljs-string">&#x27;取消&#x27;</span>),
          onTap: () =&gt; Navigator.of(context).pop(<span class="hljs-keyword">null</span>),
        ),
      ],
    ),
    style: PopupStyle(
      backgroundColor: Colors.white,
      borderRadius: BorderRadius.vertical(top: Radius.circular(<span class="hljs-number">16.0</span>)),
    ),
  ),
);

<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;用户选择: <span class="hljs-subst">$selectedOption</span>&#x27;</span>);
</code></pre>
<h3 id="自定义弹窗样式">自定义弹窗样式</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 创建自定义样式弹窗</span>
<span class="hljs-keyword">final</span> customStyle = PopupStyle(
  backgroundColor: Colors.blue.shade50,
  borderRadius: BorderRadius.circular(<span class="hljs-number">12.0</span>),
  padding: EdgeInsets.all(<span class="hljs-number">20.0</span>),
  shadow: BoxShadow(
    color: Colors.black26,
    blurRadius: <span class="hljs-number">10.0</span>,
    offset: Offset(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>),
  ),
  animation: PopupAnimation(
    type: AnimationType.bounce,
    duration: <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">500</span>),
    curve: Curves.elasticOut,
  ),
);

PopupManager.instance.<span class="hljs-keyword">show</span>(
  Popup(
    id: <span class="hljs-string">&#x27;custom_popup&#x27;</span>,
    type: PopupType.modal,
    priority: PopupPriority.high,
    style: customStyle,
    content: Container(
      width: <span class="hljs-number">300</span>,
      child: Column(
        mainAxisSize: MainAxisSize.min,
        children: [
          Icon(Icons.info, size: <span class="hljs-number">48</span>, color: Colors.blue),
          SizedBox(height: <span class="hljs-number">16</span>),
          Text(<span class="hljs-string">&#x27;自定义弹窗&#x27;</span>, style: TextStyle(fontSize: <span class="hljs-number">18</span>, fontWeight: FontWeight.bold)),
          SizedBox(height: <span class="hljs-number">8</span>),
          Text(<span class="hljs-string">&#x27;这是一个自定义样式的弹窗示例&#x27;</span>),
          SizedBox(height: <span class="hljs-number">16</span>),
          ElevatedButton(
            onPressed: () =&gt; PopupManager.instance.<span class="hljs-keyword">hide</span>(<span class="hljs-string">&#x27;custom_popup&#x27;</span>),
            child: Text(<span class="hljs-string">&#x27;关闭&#x27;</span>),
          ),
        ],
      ),
    ),
  ),
);
</code></pre>
<h3 id="弹窗队列管理">弹窗队列管理</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 批量添加弹窗到队列</span>
<span class="hljs-keyword">final</span> popups = [
  Popup(
    id: <span class="hljs-string">&#x27;popup_1&#x27;</span>,
    type: PopupType.toast,
    priority: PopupPriority.low,
    content: Text(<span class="hljs-string">&#x27;消息1&#x27;</span>),
  ),
  Popup(
    id: <span class="hljs-string">&#x27;popup_2&#x27;</span>,
    type: PopupType.dialog,
    priority: PopupPriority.high,
    content: Text(<span class="hljs-string">&#x27;重要消息&#x27;</span>),
  ),
  Popup(
    id: <span class="hljs-string">&#x27;popup_3&#x27;</span>,
    type: PopupType.toast,
    priority: PopupPriority.normal,
    content: Text(<span class="hljs-string">&#x27;消息3&#x27;</span>),
  ),
];

<span class="hljs-comment">// 按优先级添加到队列</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> popup <span class="hljs-keyword">in</span> popups) {
  PopupManager.instance.enqueue(popup);
}

<span class="hljs-comment">// 监听弹窗队列变化</span>
PopupManager.instance.onQueueChanged.listen((queue) {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;当前队列长度: <span class="hljs-subst">${queue.length}</span>&#x27;</span>);
});
</code></pre>
<h2 id="测试策略">测试策略</h2>
<h3 id="单元测试">单元测试</h3>
<pre><code class="language-dart">group(<span class="hljs-string">&#x27;PopupManager Tests&#x27;</span>, () {
  test(<span class="hljs-string">&#x27;should show popup successfully&#x27;</span>, () <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// Given</span>
    <span class="hljs-keyword">final</span> popupManager = PopupManager();
    <span class="hljs-keyword">final</span> popup = Popup(
      id: <span class="hljs-string">&#x27;test_popup&#x27;</span>,
      type: PopupType.dialog,
      content: Text(<span class="hljs-string">&#x27;Test&#x27;</span>),
    );
    
    <span class="hljs-comment">// When</span>
    <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> popupManager.<span class="hljs-keyword">show</span>(popup);
    
    <span class="hljs-comment">// Then</span>
    expect(popupManager.getCurrentPopup()?.id, <span class="hljs-string">&#x27;test_popup&#x27;</span>);
  });
  
  test(<span class="hljs-string">&#x27;should manage popup queue by priority&#x27;</span>, () {
    <span class="hljs-comment">// Given</span>
    <span class="hljs-keyword">final</span> queueController = PopupQueueController();
    <span class="hljs-keyword">final</span> lowPriorityPopup = Popup(id: <span class="hljs-string">&#x27;low&#x27;</span>, priority: PopupPriority.low);
    <span class="hljs-keyword">final</span> highPriorityPopup = Popup(id: <span class="hljs-string">&#x27;high&#x27;</span>, priority: PopupPriority.high);
    
    <span class="hljs-comment">// When</span>
    queueController.enqueue(lowPriorityPopup);
    queueController.enqueue(highPriorityPopup);
    queueController.sortByPriority();
    
    <span class="hljs-comment">// Then</span>
    <span class="hljs-keyword">final</span> queue = queueController.getQueue();
    expect(queue.first.id, <span class="hljs-string">&#x27;high&#x27;</span>);
    expect(queue.last.id, <span class="hljs-string">&#x27;low&#x27;</span>);
  });
});
</code></pre>
<h3 id="集成测试">集成测试</h3>
<pre><code class="language-dart">group(<span class="hljs-string">&#x27;Popup Integration Tests&#x27;</span>, () {
  testWidgets(<span class="hljs-string">&#x27;popup display flow&#x27;</span>, (tester) <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 1. 显示弹窗</span>
    <span class="hljs-keyword">await</span> PopupManager.instance.<span class="hljs-keyword">show</span>(testPopup);
    <span class="hljs-keyword">await</span> tester.pumpAndSettle();
    
    <span class="hljs-comment">// 2. 验证弹窗显示</span>
    expect(find.byKey(Key(<span class="hljs-string">&#x27;test_popup&#x27;</span>)), findsOneWidget);
    
    <span class="hljs-comment">// 3. 点击关闭按钮</span>
    <span class="hljs-keyword">await</span> tester.tap(find.byKey(Key(<span class="hljs-string">&#x27;close_button&#x27;</span>)));
    <span class="hljs-keyword">await</span> tester.pumpAndSettle();
    
    <span class="hljs-comment">// 4. 验证弹窗关闭</span>
    expect(find.byKey(Key(<span class="hljs-string">&#x27;test_popup&#x27;</span>)), findsNothing);
  });
});
</code></pre>
<h2 id="性能优化">性能优化</h2>
<h3 id="渲染优化">渲染优化</h3>
<ul>
<li><strong>懒加载</strong>：弹窗内容懒加载</li>
<li><strong>复用机制</strong>：弹窗组件复用</li>
<li><strong>动画优化</strong>：高效的动画实现</li>
<li><strong>内存管理</strong>：及时释放弹窗资源</li>
</ul>
<h3 id="队列优化">队列优化</h3>
<ul>
<li><strong>智能调度</strong>：智能弹窗调度算法</li>
<li><strong>优先级合并</strong>：相同优先级弹窗合并</li>
<li><strong>批量处理</strong>：批量处理弹窗队列</li>
<li><strong>负载控制</strong>：控制同时显示的弹窗数量</li>
</ul>
<h2 id="版本历史">版本历史</h2>
<h3 id="v0312-当前版本">v0.3.1+2 (当前版本)</h3>
<ul>
<li>新增弹窗主题系统</li>
<li>优化动画性能</li>
<li>支持自定义弹窗样式</li>
<li>修复内存泄漏问题</li>
</ul>
<h3 id="v030">v0.3.0</h3>
<ul>
<li>重构弹窗管理架构</li>
<li>新增优先级队列系统</li>
<li>支持多种弹窗类型</li>
<li>改进生命周期管理</li>
</ul>
<h2 id="依赖关系">依赖关系</h2>
<h3 id="内部依赖">内部依赖</h3>
<ul>
<li><code>basic_theme</code>: 主题管理系统</li>
<li><code>basic_utils</code>: 工具类库</li>
<li><code>basic_logger</code>: 日志记录</li>
</ul>
<h3 id="外部依赖">外部依赖</h3>
<ul>
<li><code>flutter/material</code>: Material 设计组件</li>
<li><code>flutter/cupertino</code>: iOS 风格组件</li>
<li><code>rxdart</code>: 响应式编程支持</li>
</ul>
<h2 id="总结">总结</h2>
<p><code>oneapp_popup</code> 模块为 OneApp 提供了完整的弹窗管理解决方案。通过统一的弹窗管理、智能的优先级控制、灵活的样式定制和完善的生命周期管理，该模块确保了应用中所有弹窗的一致性体验，提高了用户界面的专业性和用户体验的流畅性。</p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>