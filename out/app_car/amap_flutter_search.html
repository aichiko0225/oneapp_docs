<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>AMap Flutter Search - &#x9ad8;&#x5fb7;&#x5730;&#x56fe;&#x641c;&#x7d22;&#x63d2;&#x4ef6;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="amap-flutter-search---高德地图搜索插件">AMap Flutter Search - 高德地图搜索插件</h1>
<h2 id="模块概述">模块概述</h2>
<p><code>amap_flutter_search</code> 是 OneApp 中基于高德地图 SDK 的搜索服务插件，提供了全面的地理信息搜索功能，包括 POI 搜索、路线规划、地址解析等服务。该插件为车辆导航、位置查找、路径规划等功能提供了强大的搜索能力支持。</p>
<h2 id="核心功能">核心功能</h2>
<h3 id="1-poi-搜索">1. POI 搜索</h3>
<ul>
<li><strong>关键词搜索</strong>：基于关键词的兴趣点搜索</li>
<li><strong>周边搜索</strong>：指定位置周边的 POI 搜索</li>
<li><strong>分类搜索</strong>：按类别筛选的 POI 搜索</li>
<li><strong>详情查询</strong>：获取 POI 的详细信息</li>
</ul>
<h3 id="2-路线规划">2. 路线规划</h3>
<ul>
<li><strong>驾车路线</strong>：多种驾车路径规划策略</li>
<li><strong>步行路线</strong>：行人路径规划</li>
<li><strong>骑行路线</strong>：骑行路径规划</li>
<li><strong>公交路线</strong>：公共交通路径规划</li>
<li><strong>货车路线</strong>：货车专用路径规划</li>
</ul>
<h3 id="3-地址解析">3. 地址解析</h3>
<ul>
<li><strong>地理编码</strong>：地址转换为坐标</li>
<li><strong>逆地理编码</strong>：坐标转换为地址</li>
<li><strong>输入提示</strong>：地址输入智能提示</li>
<li><strong>行政区查询</strong>：行政区域信息查询</li>
</ul>
<h3 id="4-距离计算">4. 距离计算</h3>
<ul>
<li><strong>直线距离</strong>：两点间直线距离计算</li>
<li><strong>驾车距离</strong>：实际驾车距离和时间</li>
<li><strong>步行距离</strong>：步行距离和时间</li>
<li><strong>批量计算</strong>：批量距离矩阵计算</li>
</ul>
<h2 id="技术架构">技术架构</h2>
<h3 id="架构设计">架构设计</h3>
<pre><code>┌─────────────────────────────────────┐
│            应用层                    │
│   (app_navigation, app_car)         │
├─────────────────────────────────────┤
│      AMap Flutter Search           │
│  ┌──────────┬──────────┬──────────┐ │
│  │ POI搜索  │ 路线规划 │ 地址解析 │ │
│  ├──────────┼──────────┼──────────┤ │
│  │ 距离计算 │ 缓存管理 │ 数据处理 │ │
│  └──────────┴──────────┴──────────┘ │
├─────────────────────────────────────┤
│         高德地图 Search SDK         │
│  ┌──────────┬──────────┬──────────┐ │
│  │ Android  │   iOS    │ 搜索引擎 │ │
│  └──────────┴──────────┴──────────┘ │
├─────────────────────────────────────┤
│            网络服务层                │
│      (REST API, WebService)         │
└─────────────────────────────────────┘
</code></pre>
<h3 id="核心组件">核心组件</h3>
<h4 id="1-poi-搜索管理器-poisearchmanager">1. POI 搜索管理器 (PoiSearchManager)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AMapPoiSearchManager</span> </span>{
  <span class="hljs-comment">// 关键词搜索</span>
  Future&lt;PoiResult&gt; searchByKeyword(PoiKeywordSearchOption option);
  
  <span class="hljs-comment">// 周边搜索</span>
  Future&lt;PoiResult&gt; searchNearby(PoiNearbySearchOption option);
  
  <span class="hljs-comment">// ID 搜索</span>
  Future&lt;PoiItem&gt; searchById(<span class="hljs-built_in">String</span> poiId);
  
  <span class="hljs-comment">// 分类搜索</span>
  Future&lt;PoiResult&gt; searchByCategory(PoiCategorySearchOption option);
}
</code></pre>
<h4 id="2-路线规划管理器-routesearchmanager">2. 路线规划管理器 (RouteSearchManager)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AMapRouteSearchManager</span> </span>{
  <span class="hljs-comment">// 驾车路线规划</span>
  Future&lt;DriveRouteResult&gt; calculateDriveRoute(DriveRouteQuery query);
  
  <span class="hljs-comment">// 步行路线规划</span>
  Future&lt;WalkRouteResult&gt; calculateWalkRoute(WalkRouteQuery query);
  
  <span class="hljs-comment">// 骑行路线规划</span>
  Future&lt;RideRouteResult&gt; calculateRideRoute(RideRouteQuery query);
  
  <span class="hljs-comment">// 公交路线规划</span>
  Future&lt;BusRouteResult&gt; calculateBusRoute(BusRouteQuery query);
  
  <span class="hljs-comment">// 货车路线规划</span>
  Future&lt;TruckRouteResult&gt; calculateTruckRoute(TruckRouteQuery query);
}
</code></pre>
<h4 id="3-地理编码管理器-geocodemanager">3. 地理编码管理器 (GeocodeManager)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AMapGeocodeManager</span> </span>{
  <span class="hljs-comment">// 地理编码</span>
  Future&lt;GeocodeResult&gt; geocode(GeocodeQuery query);
  
  <span class="hljs-comment">// 逆地理编码</span>
  Future&lt;RegeocodeResult&gt; reverseGeocode(RegeocodeQuery query);
  
  <span class="hljs-comment">// 输入提示</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;TipItem&gt;&gt; inputTips(InputTipsQuery query);
  
  <span class="hljs-comment">// 行政区查询</span>
  Future&lt;DistrictResult&gt; searchDistrict(DistrictQuery query);
}
</code></pre>
<h4 id="4-距离计算器-distancecalculator">4. 距离计算器 (DistanceCalculator)</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AMapDistanceCalculator</span> </span>{
  <span class="hljs-comment">// 计算两点距离</span>
  Future&lt;DistanceResult&gt; calculateDistance(DistanceQuery query);
  
  <span class="hljs-comment">// 批量距离计算</span>
  Future&lt;<span class="hljs-built_in">List</span>&lt;DistanceResult&gt;&gt; calculateDistances(<span class="hljs-built_in">List</span>&lt;DistanceQuery&gt; queries);
  
  <span class="hljs-comment">// 路径距离计算</span>
  Future&lt;RouteDistanceResult&gt; calculateRouteDistance(RouteDistanceQuery query);
}
</code></pre>
<h2 id="数据模型">数据模型</h2>
<h3 id="poi-模型">POI 模型</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PoiItem</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> poiId;           <span class="hljs-comment">// POI ID</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> title;           <span class="hljs-comment">// POI 名称</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> snippet;         <span class="hljs-comment">// POI 描述</span>
  <span class="hljs-keyword">final</span> LatLng latLng;         <span class="hljs-comment">// POI 坐标</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> distance;        <span class="hljs-comment">// 距离</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> tel;            <span class="hljs-comment">// 电话</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> postcode;       <span class="hljs-comment">// 邮编</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> website;        <span class="hljs-comment">// 网站</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> email;          <span class="hljs-comment">// 邮箱</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> province;       <span class="hljs-comment">// 省份</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> city;           <span class="hljs-comment">// 城市</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> district;       <span class="hljs-comment">// 区县</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> address;        <span class="hljs-comment">// 地址</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> direction;      <span class="hljs-comment">// 方向</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> businessArea;   <span class="hljs-comment">// 商圈</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> typeCode;       <span class="hljs-comment">// 类型编码</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> typeDes;        <span class="hljs-comment">// 类型描述</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Photo&gt; photos;    <span class="hljs-comment">// 照片列表</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; shopID;   <span class="hljs-comment">// 商铺ID</span>
  <span class="hljs-keyword">final</span> IndoorData indoorData; <span class="hljs-comment">// 室内数据</span>
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PoiResult</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;PoiItem&gt; pois;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> pageCount;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> totalCount;
  <span class="hljs-keyword">final</span> SearchBound searchBound;
  <span class="hljs-keyword">final</span> PoiQuery query;
}
</code></pre>
<h3 id="路线模型">路线模型</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DriveRouteResult</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;DrivePath&gt; paths;
  <span class="hljs-keyword">final</span> RouteQuery startPos;
  <span class="hljs-keyword">final</span> RouteQuery targetPos;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;RouteQuery&gt; viaPoints;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> taxiCost;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DrivePath</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> strategy;        <span class="hljs-comment">// 策略</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> distance;          <span class="hljs-comment">// 距离（米）</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> duration;          <span class="hljs-comment">// 时长（秒）</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> tolls;          <span class="hljs-comment">// 过路费</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> tollDistance;   <span class="hljs-comment">// 收费距离</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> totalTrafficLights; <span class="hljs-comment">// 红绿灯数</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;DriveStep&gt; steps; <span class="hljs-comment">// 路径段</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;TMC&gt; tmcs;       <span class="hljs-comment">// 路况信息</span>
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DriveStep</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> instruction;    <span class="hljs-comment">// 行驶指示</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> orientation;    <span class="hljs-comment">// 方向</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> road;          <span class="hljs-comment">// 道路名称</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> distance;         <span class="hljs-comment">// 距离</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> duration;         <span class="hljs-comment">// 时长</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;LatLng&gt; polyline; <span class="hljs-comment">// 路径坐标</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> action;        <span class="hljs-comment">// 导航动作</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> assistantAction; <span class="hljs-comment">// 辅助动作</span>
}
</code></pre>
<h3 id="地址模型">地址模型</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RegeocodeResult</span> </span>{
  <span class="hljs-keyword">final</span> RegeocodeAddress regeocodeAddress;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;PoiItem&gt; pois;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Road&gt; roads;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;RoadInter&gt; roadInters;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;AoiItem&gt; aois;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RegeocodeAddress</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> formattedAddress; <span class="hljs-comment">// 格式化地址</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> country;         <span class="hljs-comment">// 国家</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> province;        <span class="hljs-comment">// 省份</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> city;           <span class="hljs-comment">// 城市</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> district;       <span class="hljs-comment">// 区县</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> township;       <span class="hljs-comment">// 乡镇</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> neighborhood;   <span class="hljs-comment">// 社区</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> building;       <span class="hljs-comment">// 建筑</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> adcode;         <span class="hljs-comment">// 区域编码</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> citycode;       <span class="hljs-comment">// 城市编码</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;StreetNumber&gt; streetNumbers; <span class="hljs-comment">// 门牌信息</span>
}
</code></pre>
<h2 id="api-接口">API 接口</h2>
<h3 id="poi-搜索接口">POI 搜索接口</h3>
<pre><code class="language-dart"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PoiSearchService</span> </span>{
  <span class="hljs-comment">// 关键词搜索</span>
  Future&lt;ApiResponse&lt;PoiResult&gt;&gt; searchByKeyword(PoiKeywordSearchRequest request);
  
  <span class="hljs-comment">// 周边搜索</span>
  Future&lt;ApiResponse&lt;PoiResult&gt;&gt; searchNearby(PoiNearbySearchRequest request);
  
  <span class="hljs-comment">// 多边形搜索</span>
  Future&lt;ApiResponse&lt;PoiResult&gt;&gt; searchInPolygon(PoiPolygonSearchRequest request);
  
  <span class="hljs-comment">// POI 详情</span>
  Future&lt;ApiResponse&lt;PoiItem&gt;&gt; getPoiDetail(<span class="hljs-built_in">String</span> poiId);
}
</code></pre>
<h3 id="路线规划接口">路线规划接口</h3>
<pre><code class="language-dart"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RouteSearchService</span> </span>{
  <span class="hljs-comment">// 驾车路线规划</span>
  Future&lt;ApiResponse&lt;DriveRouteResult&gt;&gt; planDriveRoute(DriveRouteRequest request);
  
  <span class="hljs-comment">// 步行路线规划</span>
  Future&lt;ApiResponse&lt;WalkRouteResult&gt;&gt; planWalkRoute(WalkRouteRequest request);
  
  <span class="hljs-comment">// 骑行路线规划</span>
  Future&lt;ApiResponse&lt;RideRouteResult&gt;&gt; planRideRoute(RideRouteRequest request);
  
  <span class="hljs-comment">// 公交路线规划</span>
  Future&lt;ApiResponse&lt;BusRouteResult&gt;&gt; planBusRoute(BusRouteRequest request);
}
</code></pre>
<h3 id="地理编码接口">地理编码接口</h3>
<pre><code class="language-dart"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GeocodeService</span> </span>{
  <span class="hljs-comment">// 地理编码</span>
  Future&lt;ApiResponse&lt;GeocodeResult&gt;&gt; geocode(GeocodeRequest request);
  
  <span class="hljs-comment">// 逆地理编码</span>
  Future&lt;ApiResponse&lt;RegeocodeResult&gt;&gt; reverseGeocode(RegeocodeRequest request);
  
  <span class="hljs-comment">// 输入提示</span>
  Future&lt;ApiResponse&lt;<span class="hljs-built_in">List</span>&lt;TipItem&gt;&gt;&gt; getInputTips(InputTipsRequest request);
  
  <span class="hljs-comment">// 行政区搜索</span>
  Future&lt;ApiResponse&lt;DistrictResult&gt;&gt; searchDistrict(DistrictRequest request);
}
</code></pre>
<h2 id="配置管理">配置管理</h2>
<h3 id="搜索配置">搜索配置</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchConfig</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> apiKey;           <span class="hljs-comment">// API 密钥</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> timeoutMs;          <span class="hljs-comment">// 超时时间</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> maxRetries;         <span class="hljs-comment">// 最大重试次数</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> enableCache;       <span class="hljs-comment">// 是否启用缓存</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> cacheExpireTime;    <span class="hljs-comment">// 缓存过期时间</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> language;        <span class="hljs-comment">// 语言设置</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> region;          <span class="hljs-comment">// 区域设置</span>
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> SearchConfig defaultConfig = SearchConfig(
    apiKey: <span class="hljs-string">&#x27;&#x27;</span>,
    timeoutMs: <span class="hljs-number">30000</span>,
    maxRetries: <span class="hljs-number">3</span>,
    enableCache: <span class="hljs-keyword">true</span>,
    cacheExpireTime: <span class="hljs-number">3600</span>,
    language: <span class="hljs-string">&#x27;zh-CN&#x27;</span>,
    region: <span class="hljs-string">&#x27;CN&#x27;</span>,
  );
}
</code></pre>
<h3 id="poi-搜索配置">POI 搜索配置</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PoiSearchConfig</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> pageSize;           <span class="hljs-comment">// 每页结果数</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> maxPage;           <span class="hljs-comment">// 最大页数</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> city;           <span class="hljs-comment">// 搜索城市</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> types;          <span class="hljs-comment">// 搜索类型</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> extensions;       <span class="hljs-comment">// 是否返回扩展信息</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> sortrule;       <span class="hljs-comment">// 排序规则</span>
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> PoiSearchConfig defaultConfig = PoiSearchConfig(
    pageSize: <span class="hljs-number">20</span>,
    maxPage: <span class="hljs-number">100</span>,
    city: <span class="hljs-string">&#x27;&#x27;</span>,
    types: <span class="hljs-string">&#x27;&#x27;</span>,
    extensions: <span class="hljs-keyword">false</span>,
    sortrule: <span class="hljs-string">&#x27;distance&#x27;</span>,
  );
}
</code></pre>
<h2 id="使用示例">使用示例</h2>
<h3 id="poi-搜索示例">POI 搜索示例</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 关键词搜索</span>
<span class="hljs-keyword">final</span> searchOption = PoiKeywordSearchOption(
  keyword: <span class="hljs-string">&#x27;加油站&#x27;</span>,
  city: <span class="hljs-string">&#x27;北京&#x27;</span>,
  pageSize: <span class="hljs-number">20</span>,
  pageNum: <span class="hljs-number">1</span>,
  extensions: <span class="hljs-keyword">true</span>,
);

<span class="hljs-keyword">final</span> poiResult = <span class="hljs-keyword">await</span> AMapPoiSearchManager.instance.searchByKeyword(searchOption);

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> poi <span class="hljs-keyword">in</span> poiResult.pois) {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;POI 名称: <span class="hljs-subst">${poi.title}</span>&#x27;</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;POI 地址: <span class="hljs-subst">${poi.address}</span>&#x27;</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;POI 距离: <span class="hljs-subst">${poi.distance}</span>&#x27;</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;POI 坐标: <span class="hljs-subst">${poi.latLng.latitude}</span>, <span class="hljs-subst">${poi.latLng.longitude}</span>&#x27;</span>);
}
</code></pre>
<h3 id="周边搜索示例">周边搜索示例</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 周边搜索</span>
<span class="hljs-keyword">final</span> nearbyOption = PoiNearbySearchOption(
  keyword: <span class="hljs-string">&#x27;餐厅&#x27;</span>,
  center: LatLng(<span class="hljs-number">39.9042</span>, <span class="hljs-number">116.4074</span>), <span class="hljs-comment">// 搜索中心点</span>
  radius: <span class="hljs-number">1000</span>, <span class="hljs-comment">// 搜索半径 1000 米</span>
  pageSize: <span class="hljs-number">10</span>,
  pageNum: <span class="hljs-number">1</span>,
);

<span class="hljs-keyword">final</span> nearbyResult = <span class="hljs-keyword">await</span> AMapPoiSearchManager.instance.searchNearby(nearbyOption);

<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;附近餐厅数量: <span class="hljs-subst">${nearbyResult.pois.length}</span>&#x27;</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> restaurant <span class="hljs-keyword">in</span> nearbyResult.pois) {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;餐厅: <span class="hljs-subst">${restaurant.title}</span> - <span class="hljs-subst">${restaurant.distance}</span>&#x27;</span>);
}
</code></pre>
<h3 id="路线规划示例">路线规划示例</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 驾车路线规划</span>
<span class="hljs-keyword">final</span> driveQuery = DriveRouteQuery(
  fromPoint: RouteQuery(<span class="hljs-number">39.9042</span>, <span class="hljs-number">116.4074</span>), <span class="hljs-comment">// 起点</span>
  toPoint: RouteQuery(<span class="hljs-number">39.9015</span>, <span class="hljs-number">116.3974</span>),   <span class="hljs-comment">// 终点</span>
  mode: DriveMode.fastest, <span class="hljs-comment">// 最快路线</span>
  avoidhighspeed: <span class="hljs-keyword">false</span>,   <span class="hljs-comment">// 不避开高速</span>
  avoidtolls: <span class="hljs-keyword">false</span>,       <span class="hljs-comment">// 不避开收费</span>
  avoidtrafficjam: <span class="hljs-keyword">true</span>,   <span class="hljs-comment">// 避开拥堵</span>
);

<span class="hljs-keyword">final</span> driveResult = <span class="hljs-keyword">await</span> AMapRouteSearchManager.instance.calculateDriveRoute(driveQuery);

<span class="hljs-keyword">if</span> (driveResult.paths.isNotEmpty) {
  <span class="hljs-keyword">final</span> path = driveResult.paths.first;
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;驾车距离: <span class="hljs-subst">${path.distance}</span> 米&#x27;</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;预计时间: <span class="hljs-subst">${path.duration}</span> 秒&#x27;</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;过路费: <span class="hljs-subst">${path.tolls}</span> 元&#x27;</span>);
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> step <span class="hljs-keyword">in</span> path.steps) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;导航指示: <span class="hljs-subst">${step.instruction}</span>&#x27;</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;道路: <span class="hljs-subst">${step.road}</span>&#x27;</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;距离: <span class="hljs-subst">${step.distance}</span> 米&#x27;</span>);
  }
}
</code></pre>
<h3 id="地理编码示例">地理编码示例</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 地址转坐标</span>
<span class="hljs-keyword">final</span> geocodeQuery = GeocodeQuery(
  locationName: <span class="hljs-string">&#x27;北京市朝阳区望京SOHO&#x27;</span>,
  city: <span class="hljs-string">&#x27;北京&#x27;</span>,
);

<span class="hljs-keyword">final</span> geocodeResult = <span class="hljs-keyword">await</span> AMapGeocodeManager.instance.geocode(geocodeQuery);

<span class="hljs-keyword">if</span> (geocodeResult.geocodeAddressList.isNotEmpty) {
  <span class="hljs-keyword">final</span> address = geocodeResult.geocodeAddressList.first;
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;地址坐标: <span class="hljs-subst">${address.latLonPoint.latitude}</span>, <span class="hljs-subst">${address.latLonPoint.longitude}</span>&#x27;</span>);
}

<span class="hljs-comment">// 坐标转地址</span>
<span class="hljs-keyword">final</span> regeocodeQuery = RegeocodeQuery(
  latLonPoint: LatLng(<span class="hljs-number">39.9915</span>, <span class="hljs-number">116.4684</span>),
  radius: <span class="hljs-number">200.0</span>,
  extensions: <span class="hljs-string">&#x27;all&#x27;</span>,
);

<span class="hljs-keyword">final</span> regeocodeResult = <span class="hljs-keyword">await</span> AMapGeocodeManager.instance.reverseGeocode(regeocodeQuery);
<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;格式化地址: <span class="hljs-subst">${regeocodeResult.regeocodeAddress.formattedAddress}</span>&#x27;</span>);
</code></pre>
<h3 id="输入提示示例">输入提示示例</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 地址输入提示</span>
<span class="hljs-keyword">final</span> tipsQuery = InputTipsQuery(
  keyword: <span class="hljs-string">&#x27;王府井&#x27;</span>,
  city: <span class="hljs-string">&#x27;北京&#x27;</span>,
  datatype: <span class="hljs-string">&#x27;all&#x27;</span>,
);

<span class="hljs-keyword">final</span> tipsList = <span class="hljs-keyword">await</span> AMapGeocodeManager.instance.inputTips(tipsQuery);

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> tip <span class="hljs-keyword">in</span> tipsList) {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;提示: <span class="hljs-subst">${tip.name}</span>&#x27;</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;地址: <span class="hljs-subst">${tip.address}</span>&#x27;</span>);
  <span class="hljs-keyword">if</span> (tip.point != <span class="hljs-keyword">null</span>) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;坐标: <span class="hljs-subst">${tip.point!.latitude}</span>, <span class="hljs-subst">${tip.point!.longitude}</span>&#x27;</span>);
  }
}
</code></pre>
<h2 id="测试策略">测试策略</h2>
<h3 id="单元测试">单元测试</h3>
<pre><code class="language-dart">group(<span class="hljs-string">&#x27;AMapSearch Tests&#x27;</span>, () {
  test(<span class="hljs-string">&#x27;should search POI by keyword&#x27;</span>, () <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// Given</span>
    <span class="hljs-keyword">final</span> searchOption = PoiKeywordSearchOption(
      keyword: <span class="hljs-string">&#x27;测试POI&#x27;</span>,
      city: <span class="hljs-string">&#x27;北京&#x27;</span>,
    );
    
    <span class="hljs-comment">// When</span>
    <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> AMapPoiSearchManager.instance.searchByKeyword(searchOption);
    
    <span class="hljs-comment">// Then</span>
    expect(result.pois, isNotEmpty);
    expect(result.pois.first.title, contains(<span class="hljs-string">&#x27;测试POI&#x27;</span>));
  });
  
  test(<span class="hljs-string">&#x27;should calculate drive route&#x27;</span>, () <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// Given</span>
    <span class="hljs-keyword">final</span> query = DriveRouteQuery(
      fromPoint: RouteQuery(<span class="hljs-number">39.9042</span>, <span class="hljs-number">116.4074</span>),
      toPoint: RouteQuery(<span class="hljs-number">39.9015</span>, <span class="hljs-number">116.3974</span>),
    );
    
    <span class="hljs-comment">// When</span>
    <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> AMapRouteSearchManager.instance.calculateDriveRoute(query);
    
    <span class="hljs-comment">// Then</span>
    expect(result.paths, isNotEmpty);
    expect(result.paths.first.distance, greaterThan(<span class="hljs-number">0</span>));
  });
});
</code></pre>
<h3 id="集成测试">集成测试</h3>
<pre><code class="language-dart">group(<span class="hljs-string">&#x27;Search Integration Tests&#x27;</span>, () {
  testWidgets(<span class="hljs-string">&#x27;complete search flow&#x27;</span>, (tester) <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 1. 搜索 POI</span>
    <span class="hljs-keyword">final</span> pois = <span class="hljs-keyword">await</span> searchNearbyPois(<span class="hljs-string">&#x27;加油站&#x27;</span>, currentLocation);
    
    <span class="hljs-comment">// 2. 选择目标 POI</span>
    <span class="hljs-keyword">final</span> targetPoi = pois.first;
    
    <span class="hljs-comment">// 3. 规划路线</span>
    <span class="hljs-keyword">final</span> route = <span class="hljs-keyword">await</span> planRouteToDestination(currentLocation, targetPoi.latLng);
    
    <span class="hljs-comment">// 4. 验证结果</span>
    expect(route.paths, isNotEmpty);
    expect(route.paths.first.steps, isNotEmpty);
  });
});
</code></pre>
<h2 id="性能优化">性能优化</h2>
<h3 id="搜索优化">搜索优化</h3>
<ul>
<li><strong>搜索缓存</strong>：缓存常用搜索结果</li>
<li><strong>预测搜索</strong>：基于历史预测用户搜索</li>
<li><strong>分页加载</strong>：大结果集分页加载</li>
<li><strong>搜索建议</strong>：智能搜索建议减少请求</li>
</ul>
<h3 id="路线优化">路线优化</h3>
<ul>
<li><strong>路线缓存</strong>：缓存常用路线规划结果</li>
<li><strong>增量更新</strong>：只更新路线变化部分</li>
<li><strong>压缩传输</strong>：压缩路线数据减少传输量</li>
<li><strong>多线程处理</strong>：并行处理多个路线请求</li>
</ul>
<h2 id="错误处理">错误处理</h2>
<h3 id="搜索错误类型">搜索错误类型</h3>
<pre><code class="language-dart"><span class="hljs-keyword">enum</span> SearchErrorType {
  networkError,         <span class="hljs-comment">// 网络错误</span>
  apiKeyInvalid,       <span class="hljs-comment">// API Key 无效</span>
  quotaExceeded,       <span class="hljs-comment">// 配额超限</span>
  invalidParameter,    <span class="hljs-comment">// 参数无效</span>
  noResult,           <span class="hljs-comment">// 无搜索结果</span>
  serverError,        <span class="hljs-comment">// 服务器错误</span>
  timeout             <span class="hljs-comment">// 请求超时</span>
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchException</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Exception</span> </span>{
  <span class="hljs-keyword">final</span> SearchErrorType type;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> message;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int?</span> errorCode;
  
  <span class="hljs-keyword">const</span> SearchException(<span class="hljs-keyword">this</span>.type, <span class="hljs-keyword">this</span>.message, [<span class="hljs-keyword">this</span>.errorCode]);
}
</code></pre>
<h3 id="错误处理示例">错误处理示例</h3>
<pre><code class="language-dart"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> AMapPoiSearchManager.instance.searchByKeyword(searchOption);
  <span class="hljs-comment">// 处理搜索结果</span>
} <span class="hljs-keyword">on</span> SearchException <span class="hljs-keyword">catch</span> (e) {
  <span class="hljs-keyword">switch</span> (e.type) {
    <span class="hljs-keyword">case</span> SearchErrorType.networkError:
      showErrorDialog(<span class="hljs-string">&#x27;网络连接失败，请检查网络设置&#x27;</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SearchErrorType.noResult:
      showInfoDialog(<span class="hljs-string">&#x27;未找到相关结果，请尝试其他关键词&#x27;</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SearchErrorType.quotaExceeded:
      showErrorDialog(<span class="hljs-string">&#x27;搜索次数已达上限，请稍后再试&#x27;</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
      showErrorDialog(<span class="hljs-string">&#x27;搜索失败: <span class="hljs-subst">${e.message}</span>&#x27;</span>);
  }
} <span class="hljs-keyword">catch</span> (e) {
  showErrorDialog(<span class="hljs-string">&#x27;未知错误: <span class="hljs-subst">$e</span>&#x27;</span>);
}
</code></pre>
<h2 id="缓存策略">缓存策略</h2>
<h3 id="搜索结果缓存">搜索结果缓存</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchCache</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> maxCacheSize = <span class="hljs-number">1000</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span> cacheExpiration = <span class="hljs-built_in">Duration</span>(hours: <span class="hljs-number">1</span>);
  
  <span class="hljs-comment">// 缓存 POI 搜索结果</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; cachePoiResult(<span class="hljs-built_in">String</span> key, PoiResult result);
  
  <span class="hljs-comment">// 获取缓存的 POI 结果</span>
  <span class="hljs-keyword">static</span> Future&lt;PoiResult?&gt; getCachedPoiResult(<span class="hljs-built_in">String</span> key);
  
  <span class="hljs-comment">// 缓存路线规划结果</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; cacheRouteResult(<span class="hljs-built_in">String</span> key, DriveRouteResult result);
  
  <span class="hljs-comment">// 获取缓存的路线结果</span>
  <span class="hljs-keyword">static</span> Future&lt;DriveRouteResult?&gt; getCachedRouteResult(<span class="hljs-built_in">String</span> key);
  
  <span class="hljs-comment">// 清理过期缓存</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; cleanExpiredCache();
}
</code></pre>
<h2 id="配额管理">配额管理</h2>
<h3 id="api-配额监控">API 配额监控</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuotaManager</span> </span>{
  <span class="hljs-comment">// 获取当前配额使用情况</span>
  <span class="hljs-keyword">static</span> Future&lt;QuotaInfo&gt; getCurrentQuota();
  
  <span class="hljs-comment">// 检查是否可以发起请求</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-built_in">bool</span>&gt; canMakeRequest(RequestType type);
  
  <span class="hljs-comment">// 记录请求使用</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; recordRequest(RequestType type);
  
  <span class="hljs-comment">// 获取配额重置时间</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-built_in">DateTime</span>&gt; getQuotaResetTime();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuotaInfo</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> dailyLimit;      <span class="hljs-comment">// 日限额</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> dailyUsed;       <span class="hljs-comment">// 日使用量</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> monthlyLimit;    <span class="hljs-comment">// 月限额</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> monthlyUsed;     <span class="hljs-comment">// 月使用量</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">DateTime</span> resetTime;  <span class="hljs-comment">// 重置时间</span>
}
</code></pre>
<h2 id="版本历史">版本历史</h2>
<h3 id="v31221-当前版本">v3.1.22+1 (当前版本)</h3>
<ul>
<li>支持最新的高德地图 API</li>
<li>新增货车路线规划功能</li>
<li>优化搜索性能和准确性</li>
<li>修复路线规划稳定性问题</li>
</ul>
<h3 id="v3121">v3.1.21</h3>
<ul>
<li>支持室内 POI 搜索</li>
<li>新增批量距离计算</li>
<li>优化内存使用</li>
<li>改进错误处理机制</li>
</ul>
<h2 id="依赖关系">依赖关系</h2>
<h3 id="内部依赖">内部依赖</h3>
<ul>
<li><code>amap_flutter_base</code>: 高德地图基础库</li>
<li><code>basic_network</code>: 网络请求服务</li>
<li><code>basic_storage</code>: 本地存储服务</li>
</ul>
<h3 id="外部依赖">外部依赖</h3>
<ul>
<li><code>dio</code>: HTTP 客户端</li>
<li><code>cached_network_image</code>: 图片缓存</li>
<li><code>sqflite</code>: 本地数据库</li>
</ul>
<h2 id="总结">总结</h2>
<p><code>amap_flutter_search</code> 作为高德地图搜索服务的 Flutter 插件，为 OneApp 提供了全面的地理信息搜索能力。通过集成 POI 搜索、路线规划、地理编码、距离计算等功能，该插件能够满足车辆导航、位置服务、路径规划等多种业务需求。</p>
<p>插件在设计上充分考虑了性能优化、缓存管理、错误处理、配额控制等关键因素，确保在提供高质量搜索服务的同时，保持良好的用户体验和系统稳定性。这为 OneApp 的车联网和导航服务提供了强大的技术支撑。</p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>