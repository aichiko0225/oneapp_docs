<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>App Car - &#x8f66;&#x8f86;&#x63a7;&#x5236;&#x4e3b;&#x6a21;&#x5757;&#x6587;&#x6863;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="app-car---车辆控制主模块文档">App Car - 车辆控制主模块文档</h1>
<h2 id="模块概述">模块概述</h2>
<p><code>app_car</code> 是 OneApp 车辆功能的核心模块，提供完整的车辆控制、状态监控、远程操作等功能。该模块集成了车联网通信、车辆状态管理、空调控制、车门锁控制、充电管理等核心车辆服务。</p>
<h3 id="基本信息">基本信息</h3>
<ul>
<li><strong>模块名称</strong>: app_car</li>
<li><strong>版本</strong>: 0.6.48+4</li>
<li><strong>仓库</strong>: <a href="https://gitlab-rd0.maezia.com/dssomobile/oneapp/dssomobile-oneapp-car-app">https://gitlab-rd0.maezia.com/dssomobile/oneapp/dssomobile-oneapp-car-app</a></li>
<li><strong>Flutter 版本</strong>: &gt;=3.0.0</li>
<li><strong>Dart 版本</strong>: &gt;=3.0.0 &lt;4.0.0</li>
</ul>
<h2 id="目录结构">目录结构</h2>
<pre><code>app_car/
├── lib/
│   ├── app_car.dart              # 主导出文件
│   ├── app_car_temp.dart         # 临时配置文件
│   ├── generated/                # 代码生成文件
│   ├── l10n/                     # 国际化文件
│   └── src/                      # 源代码目录
│       ├── ai_chat/              # AI 聊天集成
│       ├── app_ingeek_mdk/       # 车钥匙 MDK 集成
│       ├── bloc/                 # 状态管理（BLoC）
│       ├── car_animation/        # 车辆动画效果
│       ├── car_charging_center/  # 充电中心功能
│       ├── car_charging_profiles/# 充电配置文件
│       ├── car_climatisation/    # 空调控制
│       ├── car_climatisation_50/ # 空调控制（5.0版本）
│       ├── car_common_widget/    # 车辆通用组件
│       ├── car_digital_key_renewal/# 数字钥匙更新
│       ├── car_enum/             # 车辆相关枚举
│       ├── car_finder_card/      # 车辆查找卡片
│       ├── car_health_status/    # 车辆健康状态
│       ├── car_lock_unlock/      # 车门锁控制
│       ├── car_vehicle_status/   # 车辆状态管理
│       ├── constants/            # 常量定义
│       ├── dbr_card/             # DBR 卡片组件
│       ├── models/               # 数据模型
│       ├── pages/                # 页面组件
│       ├── res/                  # 资源文件
│       ├── utils/                # 工具类
│       ├── common_import.dart    # 通用导入
│       ├── route_dp.dart         # 路由配置
│       └── route_export.dart     # 路由导出
├── assets/                       # 静态资源
├── pubspec.yaml                  # 依赖配置
└── README.md                     # 项目说明
</code></pre>
<h2 id="核心功能模块">核心功能模块</h2>
<h3 id="1-车辆控制核心-vehicle-control-core">1. 车辆控制核心 (Vehicle Control Core)</h3>
<h4 id="车门锁控制-car_lock_unlock">车门锁控制 (<code>car_lock_unlock/</code>)</h4>
<pre><code class="language-dart"><span class="hljs-comment">// 车门锁控制服务</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CarLockUnlockService</span> </span>{
  <span class="hljs-comment">// 车门上锁</span>
  Future&lt;Result&lt;<span class="hljs-keyword">void</span>&gt;&gt; lockVehicle() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _vehicleConnector.sendCommand(
      VehicleCommand.lock(),
    );
  }
  
  <span class="hljs-comment">// 车门解锁</span>
  Future&lt;Result&lt;<span class="hljs-keyword">void</span>&gt;&gt; unlockVehicle() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _vehicleConnector.sendCommand(
      VehicleCommand.unlock(),
    );
  }
  
  <span class="hljs-comment">// 获取车门锁状态</span>
  Future&lt;Result&lt;LockStatus&gt;&gt; getLockStatus() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _vehicleConnector.getVehicleStatus()
        .map((status) =&gt; status.lockStatus);
  }
}
</code></pre>
<h4 id="空调控制-car_climatisation-car_climatisation_50">空调控制 (<code>car_climatisation/</code>, <code>car_climatisation_50/</code>)</h4>
<pre><code class="language-dart"><span class="hljs-comment">// 空调控制服务</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CarClimatisationService</span> </span>{
  <span class="hljs-comment">// 开启空调</span>
  Future&lt;Result&lt;<span class="hljs-keyword">void</span>&gt;&gt; startClimatisation({
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">double</span> targetTemperature,
    AirConditioningMode mode = AirConditioningMode.auto,
  }) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _vehicleConnector.sendCommand(
      ClimatisationCommand.start(
        temperature: targetTemperature,
        mode: mode,
      ),
    );
  }
  
  <span class="hljs-comment">// 关闭空调</span>
  Future&lt;Result&lt;<span class="hljs-keyword">void</span>&gt;&gt; stopClimatisation() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _vehicleConnector.sendCommand(
      ClimatisationCommand.stop(),
    );
  }
  
  <span class="hljs-comment">// 预设温度控制</span>
  Future&lt;Result&lt;<span class="hljs-keyword">void</span>&gt;&gt; setPresetTemperature(
    TemperaturePreset preset,
  ) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _vehicleConnector.sendCommand(
      ClimatisationCommand.setPreset(preset),
    );
  }
}
</code></pre>
<h3 id="2-车辆状态管理-car_vehicle_status">2. 车辆状态管理 (<code>car_vehicle_status/</code>)</h3>
<h4 id="实时状态监控">实时状态监控</h4>
<pre><code class="language-dart"><span class="hljs-comment">// 车辆状态管理器</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleStatusManager</span> </span>{
  Stream&lt;VehicleStatus&gt; <span class="hljs-keyword">get</span> statusStream =&gt; _statusController.stream;
  
  <span class="hljs-keyword">final</span> StreamController&lt;VehicleStatus&gt; _statusController = 
      StreamController.broadcast();
  
  <span class="hljs-comment">// 启动状态监控</span>
  <span class="hljs-keyword">void</span> startStatusMonitoring() {
    _statusTimer = Timer.periodic(
      <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">30</span>),
      (_) =&gt; _fetchVehicleStatus(),
    );
  }
  
  Future&lt;<span class="hljs-keyword">void</span>&gt; _fetchVehicleStatus() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">final</span> status = <span class="hljs-keyword">await</span> _vehicleConnector.getVehicleStatus();
      status.fold(
        (failure) =&gt; _handleStatusError(failure),
        (vehicleStatus) =&gt; _statusController.add(vehicleStatus),
      );
    } <span class="hljs-keyword">catch</span> (e) {
      _handleStatusError(VehicleFailure.networkError(e.toString()));
    }
  }
}
</code></pre>
<h4 id="车辆健康状态-car_health_status">车辆健康状态 (<code>car_health_status/</code>)</h4>
<pre><code class="language-dart"><span class="hljs-comment">// 车辆健康状态模型</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleHealthStatus</span> </span>{
  <span class="hljs-keyword">final</span> BatteryHealth batteryHealth;
  <span class="hljs-keyword">final</span> EngineHealth engineHealth;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;MaintenanceAlert&gt; maintenanceAlerts;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;DiagnosticCode&gt; diagnosticCodes;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">DateTime</span> lastCheckTime;
  
  <span class="hljs-keyword">const</span> VehicleHealthStatus({
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.batteryHealth,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.engineHealth,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.maintenanceAlerts,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.diagnosticCodes,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.lastCheckTime,
  });
  
  <span class="hljs-comment">// 获取整体健康评分</span>
  HealthScore <span class="hljs-keyword">get</span> overallScore {
    <span class="hljs-keyword">final</span> scores = [
      batteryHealth.score,
      engineHealth.score,
    ];
    <span class="hljs-keyword">final</span> average = scores.reduce((a, b) =&gt; a + b) / scores.length;
    <span class="hljs-keyword">return</span> HealthScore.fromValue(average);
  }
}
</code></pre>
<h3 id="3-充电管理-car_charging_center-car_charging_profiles">3. 充电管理 (<code>car_charging_center/</code>, <code>car_charging_profiles/</code>)</h3>
<h4 id="充电中心控制">充电中心控制</h4>
<pre><code class="language-dart"><span class="hljs-comment">// 充电管理服务</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChargingCenterService</span> </span>{
  <span class="hljs-comment">// 开始充电</span>
  Future&lt;Result&lt;<span class="hljs-keyword">void</span>&gt;&gt; startCharging({
    ChargingProfile? profile,
    <span class="hljs-built_in">DateTime?</span> scheduledTime,
  }) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _vehicleConnector.sendCommand(
      ChargingCommand.start(
        profile: profile ?? ChargingProfile.standard(),
        scheduledTime: scheduledTime,
      ),
    );
  }
  
  <span class="hljs-comment">// 停止充电</span>
  Future&lt;Result&lt;<span class="hljs-keyword">void</span>&gt;&gt; stopCharging() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _vehicleConnector.sendCommand(
      ChargingCommand.stop(),
    );
  }
  
  <span class="hljs-comment">// 设置充电目标</span>
  Future&lt;Result&lt;<span class="hljs-keyword">void</span>&gt;&gt; setChargingTarget(<span class="hljs-built_in">int</span> targetPercentage) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _vehicleConnector.sendCommand(
      ChargingCommand.setTarget(targetPercentage),
    );
  }
}
</code></pre>
<h4 id="充电配置文件管理">充电配置文件管理</h4>
<pre><code class="language-dart"><span class="hljs-comment">// 充电配置文件</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChargingProfile</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> name;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> targetPercentage;
  <span class="hljs-keyword">final</span> ChargingSpeed speed;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> isEcoMode;
  <span class="hljs-keyword">final</span> TimeWindow? timeWindow;
  
  <span class="hljs-keyword">const</span> ChargingProfile({
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.id,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.name,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.targetPercentage,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.speed,
    <span class="hljs-keyword">this</span>.isEcoMode = <span class="hljs-keyword">false</span>,
    <span class="hljs-keyword">this</span>.timeWindow,
  });
  
  <span class="hljs-comment">// 标准充电配置</span>
  <span class="hljs-keyword">factory</span> ChargingProfile.standard() {
    <span class="hljs-keyword">return</span> ChargingProfile(
      id: <span class="hljs-string">&#x27;standard&#x27;</span>,
      name: <span class="hljs-string">&#x27;标准充电&#x27;</span>,
      targetPercentage: <span class="hljs-number">80</span>,
      speed: ChargingSpeed.normal,
    );
  }
  
  <span class="hljs-comment">// 快速充电配置</span>
  <span class="hljs-keyword">factory</span> ChargingProfile.fast() {
    <span class="hljs-keyword">return</span> ChargingProfile(
      id: <span class="hljs-string">&#x27;fast&#x27;</span>,
      name: <span class="hljs-string">&#x27;快速充电&#x27;</span>,
      targetPercentage: <span class="hljs-number">100</span>,
      speed: ChargingSpeed.fast,
    );
  }
}
</code></pre>
<h3 id="4-数字钥匙管理-car_digital_key_renewal-app_ingeek_mdk">4. 数字钥匙管理 (<code>car_digital_key_renewal/</code>, <code>app_ingeek_mdk/</code>)</h3>
<h4 id="数字钥匙服务">数字钥匙服务</h4>
<pre><code class="language-dart"><span class="hljs-comment">// 数字钥匙管理服务</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DigitalKeyService</span> </span>{
  <span class="hljs-comment">// 数字钥匙续期</span>
  Future&lt;Result&lt;<span class="hljs-keyword">void</span>&gt;&gt; renewDigitalKey() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> _ingeekMdk.renewKey();
      <span class="hljs-keyword">if</span> (result.isSuccess) {
        <span class="hljs-keyword">await</span> _updateLocalKeyInfo(result.keyInfo);
        <span class="hljs-keyword">return</span> Right(unit);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> Left(DigitalKeyFailure.renewalFailed(result.error));
      }
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-keyword">return</span> Left(DigitalKeyFailure.networkError(e.toString()));
    }
  }
  
  <span class="hljs-comment">// 检查钥匙状态</span>
  Future&lt;Result&lt;DigitalKeyStatus&gt;&gt; checkKeyStatus() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">final</span> keyInfo = <span class="hljs-keyword">await</span> _ingeekMdk.getKeyInfo();
      <span class="hljs-keyword">return</span> Right(DigitalKeyStatus.fromKeyInfo(keyInfo));
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-keyword">return</span> Left(DigitalKeyFailure.statusCheckFailed(e.toString()));
    }
  }
  
  <span class="hljs-comment">// 激活数字钥匙</span>
  Future&lt;Result&lt;<span class="hljs-keyword">void</span>&gt;&gt; activateDigitalKey(<span class="hljs-built_in">String</span> activationCode) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _ingeekMdk.activateKey(activationCode);
  }
}
</code></pre>
<h3 id="5-车辆查找功能-car_finder_card">5. 车辆查找功能 (<code>car_finder_card/</code>)</h3>
<h4 id="车辆定位服务">车辆定位服务</h4>
<pre><code class="language-dart"><span class="hljs-comment">// 车辆查找服务</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CarFinderService</span> </span>{
  <span class="hljs-comment">// 获取车辆位置</span>
  Future&lt;Result&lt;VehicleLocation&gt;&gt; getVehicleLocation() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _vehicleConnector.getVehicleLocation();
  }
  
  <span class="hljs-comment">// 闪灯鸣笛</span>
  Future&lt;Result&lt;<span class="hljs-keyword">void</span>&gt;&gt; flashAndHonk() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _vehicleConnector.sendCommand(
      VehicleCommand.flashAndHonk(),
    );
  }
  
  <span class="hljs-comment">// 计算到车辆的距离</span>
  Future&lt;Result&lt;Distance&gt;&gt; calculateDistanceToVehicle(
    UserLocation userLocation,
  ) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> vehicleLocationResult = <span class="hljs-keyword">await</span> getVehicleLocation();
    <span class="hljs-keyword">return</span> vehicleLocationResult.map((vehicleLocation) {
      <span class="hljs-keyword">return</span> Distance.calculate(userLocation, vehicleLocation.coordinates);
    });
  }
}
</code></pre>
<h2 id="状态管理架构-bloc">状态管理架构 (<code>bloc/</code>)</h2>
<h3 id="bloc-模式实现">BLoC 模式实现</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 车辆状态 BLoC</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleStatusBloc</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Bloc</span>&lt;<span class="hljs-title">VehicleStatusEvent</span>, <span class="hljs-title">VehicleStatusState</span>&gt; </span>{
  <span class="hljs-keyword">final</span> VehicleStatusRepository _repository;
  
  VehicleStatusBloc(<span class="hljs-keyword">this</span>._repository) : <span class="hljs-keyword">super</span>(VehicleStatusInitial()) {
    <span class="hljs-keyword">on</span>&lt;LoadVehicleStatus&gt;(_onLoadVehicleStatus);
    <span class="hljs-keyword">on</span>&lt;RefreshVehicleStatus&gt;(_onRefreshVehicleStatus);
    <span class="hljs-keyword">on</span>&lt;VehicleStatusUpdated&gt;(_onVehicleStatusUpdated);
  }
  
  Future&lt;<span class="hljs-keyword">void</span>&gt; _onLoadVehicleStatus(
    LoadVehicleStatus event,
    Emitter&lt;VehicleStatusState&gt; emit,
  ) <span class="hljs-keyword">async</span> {
    emit(VehicleStatusLoading());
    
    <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> _repository.getVehicleStatus();
    result.fold(
      (failure) =&gt; emit(VehicleStatusError(failure.message)),
      (status) =&gt; emit(VehicleStatusLoaded(status)),
    );
  }
}

<span class="hljs-comment">// 车辆控制 BLoC</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleControlBloc</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Bloc</span>&lt;<span class="hljs-title">VehicleControlEvent</span>, <span class="hljs-title">VehicleControlState</span>&gt; </span>{
  <span class="hljs-keyword">final</span> VehicleControlRepository _repository;
  
  VehicleControlBloc(<span class="hljs-keyword">this</span>._repository) : <span class="hljs-keyword">super</span>(VehicleControlInitial()) {
    <span class="hljs-keyword">on</span>&lt;LockVehicle&gt;(_onLockVehicle);
    <span class="hljs-keyword">on</span>&lt;UnlockVehicle&gt;(_onUnlockVehicle);
    <span class="hljs-keyword">on</span>&lt;StartClimatisation&gt;(_onStartClimatisation);
    <span class="hljs-keyword">on</span>&lt;StopClimatisation&gt;(_onStopClimatisation);
  }
  
  Future&lt;<span class="hljs-keyword">void</span>&gt; _onLockVehicle(
    LockVehicle event,
    Emitter&lt;VehicleControlState&gt; emit,
  ) <span class="hljs-keyword">async</span> {
    emit(VehicleControlLoading());
    
    <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> _repository.lockVehicle();
    result.fold(
      (failure) =&gt; emit(VehicleControlError(failure.message)),
      (_) =&gt; emit(VehicleControlSuccess(<span class="hljs-string">&#x27;车辆已上锁&#x27;</span>)),
    );
  }
}
</code></pre>
<h2 id="数据模型-models">数据模型 (<code>models/</code>)</h2>
<h3 id="车辆状态模型">车辆状态模型</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 车辆状态模型</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleStatus</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> vehicleId;
  <span class="hljs-keyword">final</span> LockStatus lockStatus;
  <span class="hljs-keyword">final</span> BatteryStatus batteryStatus;
  <span class="hljs-keyword">final</span> ClimatisationStatus climatisationStatus;
  <span class="hljs-keyword">final</span> ChargingStatus chargingStatus;
  <span class="hljs-keyword">final</span> VehicleLocation? location;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">DateTime</span> lastUpdated;
  
  <span class="hljs-keyword">const</span> VehicleStatus({
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.vehicleId,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.lockStatus,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.batteryStatus,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.climatisationStatus,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.chargingStatus,
    <span class="hljs-keyword">this</span>.location,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.lastUpdated,
  });
  
  <span class="hljs-keyword">factory</span> VehicleStatus.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) {
    <span class="hljs-keyword">return</span> VehicleStatus(
      vehicleId: json[<span class="hljs-string">&#x27;vehicle_id&#x27;</span>],
      lockStatus: LockStatus.fromString(json[<span class="hljs-string">&#x27;lock_status&#x27;</span>]),
      batteryStatus: BatteryStatus.fromJson(json[<span class="hljs-string">&#x27;battery_status&#x27;</span>]),
      climatisationStatus: ClimatisationStatus.fromJson(json[<span class="hljs-string">&#x27;climatisation_status&#x27;</span>]),
      chargingStatus: ChargingStatus.fromJson(json[<span class="hljs-string">&#x27;charging_status&#x27;</span>]),
      location: json[<span class="hljs-string">&#x27;location&#x27;</span>] != <span class="hljs-keyword">null</span> 
          ? VehicleLocation.fromJson(json[<span class="hljs-string">&#x27;location&#x27;</span>]) 
          : <span class="hljs-keyword">null</span>,
      lastUpdated: <span class="hljs-built_in">DateTime</span>.parse(json[<span class="hljs-string">&#x27;last_updated&#x27;</span>]),
    );
  }
}
</code></pre>
<h3 id="车辆控制命令模型">车辆控制命令模型</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 车辆控制命令</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleCommand</span> </span>{
  <span class="hljs-keyword">const</span> VehicleCommand();
  
  <span class="hljs-comment">// 车门锁命令</span>
  <span class="hljs-keyword">factory</span> VehicleCommand.lock() = LockCommand;
  <span class="hljs-keyword">factory</span> VehicleCommand.unlock() = UnlockCommand;
  
  <span class="hljs-comment">// 空调命令</span>
  <span class="hljs-keyword">factory</span> VehicleCommand.startClimatisation({
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">double</span> temperature,
    AirConditioningMode mode,
  }) = StartClimatisationCommand;
  
  <span class="hljs-keyword">factory</span> VehicleCommand.stopClimatisation() = StopClimatisationCommand;
  
  <span class="hljs-comment">// 充电命令</span>
  <span class="hljs-keyword">factory</span> VehicleCommand.startCharging({
    ChargingProfile? profile,
  }) = StartChargingCommand;
  
  <span class="hljs-keyword">factory</span> VehicleCommand.stopCharging() = StopChargingCommand;
  
  <span class="hljs-comment">// 车辆查找命令</span>
  <span class="hljs-keyword">factory</span> VehicleCommand.flashAndHonk() = FlashAndHonkCommand;
}
</code></pre>
<h2 id="枚举定义-car_enum">枚举定义 (<code>car_enum/</code>)</h2>
<h3 id="车辆状态枚举">车辆状态枚举</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 车门锁状态</span>
<span class="hljs-keyword">enum</span> LockStatus {
  locked,
  unlocked,
  unknown;
  
  <span class="hljs-keyword">static</span> LockStatus fromString(<span class="hljs-built_in">String</span> value) {
    <span class="hljs-keyword">switch</span> (value.toLowerCase()) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;locked&#x27;</span>:
        <span class="hljs-keyword">return</span> LockStatus.locked;
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;unlocked&#x27;</span>:
        <span class="hljs-keyword">return</span> LockStatus.unlocked;
      <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">return</span> LockStatus.unknown;
    }
  }
}

<span class="hljs-comment">// 充电状态</span>
<span class="hljs-keyword">enum</span> ChargingStatus {
  notConnected,
  connected,
  charging,
  chargingComplete,
  chargingError;
  
  <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> isCharging =&gt; <span class="hljs-keyword">this</span> == ChargingStatus.charging;
  <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> isConnected =&gt; <span class="hljs-keyword">this</span> != ChargingStatus.notConnected;
}

<span class="hljs-comment">// 空调模式</span>
<span class="hljs-keyword">enum</span> AirConditioningMode {
  auto,
  heat,
  cool,
  ventilation,
  defrost;
  
  <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> displayName {
    <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>) {
      <span class="hljs-keyword">case</span> AirConditioningMode.auto:
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;自动&#x27;</span>;
      <span class="hljs-keyword">case</span> AirConditioningMode.heat:
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;制热&#x27;</span>;
      <span class="hljs-keyword">case</span> AirConditioningMode.cool:
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;制冷&#x27;</span>;
      <span class="hljs-keyword">case</span> AirConditioningMode.ventilation:
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;通风&#x27;</span>;
      <span class="hljs-keyword">case</span> AirConditioningMode.defrost:
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;除霜&#x27;</span>;
    }
  }
}
</code></pre>
<h2 id="ui-组件-car_common_widget">UI 组件 (<code>car_common_widget/</code>)</h2>
<h3 id="车辆状态卡片">车辆状态卡片</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 车辆状态卡片组件</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleStatusCard</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> VehicleStatus status;
  <span class="hljs-keyword">final</span> VoidCallback? onRefresh;
  
  <span class="hljs-keyword">const</span> VehicleStatusCard({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.status,
    <span class="hljs-keyword">this</span>.onRefresh,
  }) : <span class="hljs-keyword">super</span>(key: key);
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Card(
      child: Padding(
        padding: EdgeInsets.all(<span class="hljs-number">16</span>),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            _buildHeader(),
            SizedBox(height: <span class="hljs-number">16</span>),
            _buildStatusGrid(),
            SizedBox(height: <span class="hljs-number">16</span>),
            _buildActionButtons(),
          ],
        ),
      ),
    );
  }
  
  Widget _buildStatusGrid() {
    <span class="hljs-keyword">return</span> GridView.count(
      shrinkWrap: <span class="hljs-keyword">true</span>,
      physics: NeverScrollableScrollPhysics(),
      crossAxisCount: <span class="hljs-number">2</span>,
      children: [
        _buildStatusItem(<span class="hljs-string">&#x27;车门&#x27;</span>, status.lockStatus.displayName),
        _buildStatusItem(<span class="hljs-string">&#x27;电量&#x27;</span>, <span class="hljs-string">&#x27;<span class="hljs-subst">${status.batteryStatus.percentage}</span>%&#x27;</span>),
        _buildStatusItem(<span class="hljs-string">&#x27;空调&#x27;</span>, status.climatisationStatus.displayName),
        _buildStatusItem(<span class="hljs-string">&#x27;充电&#x27;</span>, status.chargingStatus.displayName),
      ],
    );
  }
}
</code></pre>
<h3 id="车辆控制面板">车辆控制面板</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 车辆控制面板</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleControlPanel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> VehicleStatus status;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Function</span>(VehicleCommand) onCommand;
  
  <span class="hljs-keyword">const</span> VehicleControlPanel({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.status,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onCommand,
  }) : <span class="hljs-keyword">super</span>(key: key);
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Column(
      children: [
        _buildLockControls(),
        SizedBox(height: <span class="hljs-number">16</span>),
        _buildClimatisationControls(),
        SizedBox(height: <span class="hljs-number">16</span>),
        _buildChargingControls(),
        SizedBox(height: <span class="hljs-number">16</span>),
        _buildFinderControls(),
      ],
    );
  }
  
  Widget _buildLockControls() {
    <span class="hljs-keyword">return</span> Row(
      children: [
        Expanded(
          child: ElevatedButton.icon(
            onPressed: status.lockStatus == LockStatus.unlocked
                ? () =&gt; onCommand(VehicleCommand.lock())
                : <span class="hljs-keyword">null</span>,
            icon: Icon(Icons.lock),
            label: Text(<span class="hljs-string">&#x27;上锁&#x27;</span>),
          ),
        ),
        SizedBox(width: <span class="hljs-number">8</span>),
        Expanded(
          child: ElevatedButton.icon(
            onPressed: status.lockStatus == LockStatus.locked
                ? () =&gt; onCommand(VehicleCommand.unlock())
                : <span class="hljs-keyword">null</span>,
            icon: Icon(Icons.lock_open),
            label: Text(<span class="hljs-string">&#x27;解锁&#x27;</span>),
          ),
        ),
      ],
    );
  }
}
</code></pre>
<h2 id="动画效果-car_animation">动画效果 (<code>car_animation/</code>)</h2>
<h3 id="车辆控制动画">车辆控制动画</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 车辆控制动画控制器</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleAnimationController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ChangeNotifier</span> </span>{
  <span class="hljs-keyword">late</span> AnimationController _lockAnimationController;
  <span class="hljs-keyword">late</span> AnimationController _chargingAnimationController;
  
  Animation&lt;<span class="hljs-built_in">double</span>&gt; <span class="hljs-keyword">get</span> lockAnimation =&gt; _lockAnimationController;
  Animation&lt;<span class="hljs-built_in">double</span>&gt; <span class="hljs-keyword">get</span> chargingAnimation =&gt; _chargingAnimationController;
  
  <span class="hljs-keyword">void</span> initialize(TickerProvider vsync) {
    _lockAnimationController = AnimationController(
      duration: <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">500</span>),
      vsync: vsync,
    );
    
    _chargingAnimationController = AnimationController(
      duration: <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">1500</span>),
      vsync: vsync,
    )..repeat();
  }
  
  <span class="hljs-keyword">void</span> playLockAnimation() {
    _lockAnimationController.forward().then((_) {
      _lockAnimationController.reverse();
    });
  }
  
  <span class="hljs-keyword">void</span> startChargingAnimation() {
    _chargingAnimationController.repeat();
  }
  
  <span class="hljs-keyword">void</span> stopChargingAnimation() {
    _chargingAnimationController.stop();
  }
}
</code></pre>
<h2 id="ai-聊天集成-ai_chat">AI 聊天集成 (<code>ai_chat/</code>)</h2>
<h3 id="ai-聊天车辆控制">AI 聊天车辆控制</h3>
<pre><code class="language-dart"><span class="hljs-comment">// AI 聊天车辆控制集成</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AIChatVehicleIntegration</span> </span>{
  <span class="hljs-keyword">final</span> VehicleControlRepository _vehicleRepository;
  <span class="hljs-keyword">final</span> AIChatAssistant _aiAssistant;
  
  AIChatVehicleIntegration(<span class="hljs-keyword">this</span>._vehicleRepository, <span class="hljs-keyword">this</span>._aiAssistant);
  
  <span class="hljs-comment">// 处理车辆控制语音命令</span>
  Future&lt;AIChatResponse&gt; handleVehicleCommand(<span class="hljs-built_in">String</span> command) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> intent = <span class="hljs-keyword">await</span> _aiAssistant.parseIntent(command);
    
    <span class="hljs-keyword">switch</span> (intent.type) {
      <span class="hljs-keyword">case</span> VehicleIntentType.lock:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _handleLockCommand();
      <span class="hljs-keyword">case</span> VehicleIntentType.unlock:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _handleUnlockCommand();
      <span class="hljs-keyword">case</span> VehicleIntentType.startAC:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _handleStartACCommand(intent.parameters);
      <span class="hljs-keyword">case</span> VehicleIntentType.stopAC:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _handleStopACCommand();
      <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">return</span> AIChatResponse.error(<span class="hljs-string">&#x27;未识别的车辆控制命令&#x27;</span>);
    }
  }
  
  Future&lt;AIChatResponse&gt; _handleLockCommand() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> _vehicleRepository.lockVehicle();
    <span class="hljs-keyword">return</span> result.fold(
      (failure) =&gt; AIChatResponse.error(<span class="hljs-string">&#x27;车辆上锁失败：<span class="hljs-subst">${failure.message}</span>&#x27;</span>),
      (_) =&gt; AIChatResponse.success(<span class="hljs-string">&#x27;车辆已成功上锁&#x27;</span>),
    );
  }
}
</code></pre>
<h2 id="依赖管理">依赖管理</h2>
<h3 id="核心依赖">核心依赖</h3>
<ul>
<li><strong>car_connector</strong>: 车联网连接服务</li>
<li><strong>car_vehicle</strong>: 车辆基础服务</li>
<li><strong>car_vur</strong>: 车辆更新记录</li>
<li><strong>flutter_ingeek_carkey</strong>: 数字钥匙 SDK</li>
</ul>
<h3 id="框架依赖">框架依赖</h3>
<ul>
<li><strong>basic_modular</strong>: 模块化框架</li>
<li><strong>basic_modular_route</strong>: 路由管理</li>
<li><strong>basic_intl</strong>: 国际化支持</li>
<li><strong>basic_storage</strong>: 本地存储</li>
</ul>
<h3 id="业务依赖">业务依赖</h3>
<ul>
<li><strong>ai_chat_assistant</strong>: AI 聊天助手集成</li>
<li><strong>clr_mno</strong>: MNO 服务</li>
<li><strong>dartz</strong>: 函数式编程支持</li>
</ul>
<h2 id="路由配置-route_dpdart-route_exportdart">路由配置 (<code>route_dp.dart</code>, <code>route_export.dart</code>)</h2>
<h3 id="路由定义">路由定义</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 车辆模块路由配置</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CarRoutes</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> vehicleStatus = <span class="hljs-string">&#x27;/car/status&#x27;</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> vehicleControl = <span class="hljs-string">&#x27;/car/control&#x27;</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> chargingCenter = <span class="hljs-string">&#x27;/car/charging&#x27;</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> digitalKey = <span class="hljs-string">&#x27;/car/digital-key&#x27;</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> carFinder = <span class="hljs-string">&#x27;/car/finder&#x27;</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> climatisation = <span class="hljs-string">&#x27;/car/climatisation&#x27;</span>;
  
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">List</span>&lt;ModularRoute&gt; <span class="hljs-keyword">get</span> routes =&gt; [
    ChildRoute(
      vehicleStatus,
      child: (context, args) =&gt; VehicleStatusPage(),
    ),
    ChildRoute(
      vehicleControl,
      child: (context, args) =&gt; VehicleControlPage(),
    ),
    ChildRoute(
      chargingCenter,
      child: (context, args) =&gt; ChargingCenterPage(),
    ),
    ChildRoute(
      digitalKey,
      child: (context, args) =&gt; DigitalKeyPage(),
    ),
    ChildRoute(
      carFinder,
      child: (context, args) =&gt; CarFinderPage(),
    ),
    ChildRoute(
      climatisation,
      child: (context, args) =&gt; ClimatisationPage(),
    ),
  ];
}
</code></pre>
<h2 id="常量定义-constants">常量定义 (<code>constants/</code>)</h2>
<h3 id="车辆常量">车辆常量</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 车辆控制常量</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CarConstants</span> </span>{
  <span class="hljs-comment">// 温度范围</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> minTemperature = <span class="hljs-number">16.0</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> maxTemperature = <span class="hljs-number">32.0</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> defaultTemperature = <span class="hljs-number">22.0</span>;
  
  <span class="hljs-comment">// 充电相关</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> minChargingTarget = <span class="hljs-number">20</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> maxChargingTarget = <span class="hljs-number">100</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> defaultChargingTarget = <span class="hljs-number">80</span>;
  
  <span class="hljs-comment">// 动画时长</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span> lockAnimationDuration = <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">500</span>);
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span> statusUpdateInterval = <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">30</span>);
  
  <span class="hljs-comment">// 错误重试</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> maxRetryCount = <span class="hljs-number">3</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span> retryDelay = <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>);
}
</code></pre>
<h2 id="错误处理">错误处理</h2>
<h3 id="车辆特定异常">车辆特定异常</h3>
<pre><code class="language-dart"><span class="hljs-comment">// 车辆操作异常</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleFailure</span> </span>{
  <span class="hljs-keyword">const</span> VehicleFailure();
  
  <span class="hljs-keyword">factory</span> VehicleFailure.networkError(<span class="hljs-built_in">String</span> message) = NetworkFailure;
  <span class="hljs-keyword">factory</span> VehicleFailure.authenticationError() = AuthenticationFailure;
  <span class="hljs-keyword">factory</span> VehicleFailure.vehicleNotFound() = VehicleNotFoundFailure;
  <span class="hljs-keyword">factory</span> VehicleFailure.commandTimeout() = CommandTimeoutFailure;
  <span class="hljs-keyword">factory</span> VehicleFailure.vehicleOffline() = VehicleOfflineFailure;
  <span class="hljs-keyword">factory</span> VehicleFailure.insufficientBattery() = InsufficientBatteryFailure;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NetworkFailure</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">VehicleFailure</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> message;
  <span class="hljs-keyword">const</span> NetworkFailure(<span class="hljs-keyword">this</span>.message);
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleOfflineFailure</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">VehicleFailure</span> </span>{
  <span class="hljs-keyword">const</span> VehicleOfflineFailure();
}
</code></pre>
<h2 id="性能优化">性能优化</h2>
<h3 id="状态缓存策略">状态缓存策略</h3>
<ul>
<li>车辆状态本地缓存</li>
<li>智能刷新机制</li>
<li>后台状态同步</li>
</ul>
<h3 id="网络优化">网络优化</h3>
<ul>
<li>命令队列管理</li>
<li>批量请求处理</li>
<li>离线命令缓存</li>
</ul>
<h3 id="ui-优化">UI 优化</h3>
<ul>
<li>状态变更动画</li>
<li>加载状态指示</li>
<li>错误状态处理</li>
</ul>
<h2 id="测试策略">测试策略</h2>
<h3 id="单元测试">单元测试</h3>
<ul>
<li>BLoC 状态管理测试</li>
<li>服务类功能测试</li>
<li>模型序列化测试</li>
</ul>
<h3 id="集成测试">集成测试</h3>
<ul>
<li>车联网通信测试</li>
<li>状态同步测试</li>
<li>命令执行测试</li>
</ul>
<h3 id="ui-测试">UI 测试</h3>
<ul>
<li>控制面板交互测试</li>
<li>状态显示测试</li>
<li>错误场景测试</li>
</ul>
<h2 id="总结">总结</h2>
<p><code>app_car</code> 模块是 OneApp 车辆功能的核心，提供了完整的车辆控制和状态管理功能。模块采用 BLoC 模式进行状态管理，具有清晰的分层架构和良好的可扩展性。通过集成 AI 聊天助手和数字钥匙技术，为用户提供了智能化和便捷的车辆操作体验。</p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>