<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>JVerify &#x6781;&#x9a8c;&#x9a8c;&#x8bc1;&#x63d2;&#x4ef6;&#x6587;&#x6863;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="jverify-极验验证插件文档">JVerify 极验验证插件文档</h1>
<h2 id="插件概述">插件概述</h2>
<p><code>jverify</code> 是 OneApp 集成的极验验证 Flutter 插件，提供一键登录、短信验证等安全认证功能。该插件封装了极验验证的 Android 和 iOS SDK，为 Flutter 应用提供统一的验证接口。</p>
<h3 id="基本信息">基本信息</h3>
<ul>
<li><strong>插件名称</strong>: jverify</li>
<li><strong>类型</strong>: Flutter Plugin</li>
<li><strong>平台支持</strong>: Android, iOS</li>
<li><strong>功能</strong>: 一键登录、短信验证、SDK 初始化</li>
</ul>
<h2 id="目录结构">目录结构</h2>
<pre><code>jverify/
├── lib/
│   └── jverify.dart              # Flutter 接口层
├── android/                      # Android 原生实现
│   ├── src/main/
│   │   ├── AndroidManifest.xml  # Android 清单文件
│   │   ├── java/                 # Java/Kotlin 源码
│   │   └── libs/                 # 第三方库文件
│   └── build.gradle             # Android 构建配置
├── ios/                          # iOS 原生实现
│   ├── Classes/                  # Objective-C/Swift 源码
│   ├── Assets/                   # iOS 资源文件
│   └── jverify.podspec          # CocoaPods 配置
├── documents/                    # 文档目录
├── pubspec.yaml                  # Flutter 插件配置
└── README.md                     # 项目说明
</code></pre>
<h2 id="flutter-接口层-libjverifydart">Flutter 接口层 (lib/jverify.dart)</h2>
<h3 id="核心回调类型定义">核心回调类型定义</h3>
<h4 id="1-事件监听器定义">1. 事件监听器定义</h4>
<pre><code class="language-dart"><span class="hljs-comment">// 自定义控件点击事件监听器</span>
<span class="hljs-keyword">typedef</span> JVClickWidgetEventListener = <span class="hljs-keyword">void</span> <span class="hljs-built_in">Function</span>(<span class="hljs-built_in">String</span> widgetId);

<span class="hljs-comment">// 授权页事件回调监听器</span>
<span class="hljs-keyword">typedef</span> JVAuthPageEventListener = <span class="hljs-keyword">void</span> <span class="hljs-built_in">Function</span>(JVAuthPageEvent event);

<span class="hljs-comment">// 一键登录回调监听器</span>
<span class="hljs-keyword">typedef</span> JVLoginAuthCallBackListener = <span class="hljs-keyword">void</span> <span class="hljs-built_in">Function</span>(JVListenerEvent event);

<span class="hljs-comment">// 短信登录回调监听器</span>
<span class="hljs-keyword">typedef</span> JVSMSListener = <span class="hljs-keyword">void</span> <span class="hljs-built_in">Function</span>(JVSMSEvent event);

<span class="hljs-comment">// SDK 初始化回调监听器</span>
<span class="hljs-keyword">typedef</span> JVSDKSetupCallBackListener = <span class="hljs-keyword">void</span> <span class="hljs-built_in">Function</span>(JVSDKSetupEvent event);
</code></pre>
<h4 id="2-事件数据模型">2. 事件数据模型</h4>
<pre><code class="language-dart"><span class="hljs-comment">// 一键登录事件</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JVListenerEvent</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> code;        <span class="hljs-comment">// 返回码：6000成功，6001失败</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> message;  <span class="hljs-comment">// 返回信息或loginToken</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> <span class="hljs-keyword">operator</span>; <span class="hljs-comment">// 运营商：CM移动，CU联通，CT电信</span>
}

<span class="hljs-comment">// 短信验证事件</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JVSMSEvent</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> code;        <span class="hljs-comment">// 返回码</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> message;  <span class="hljs-comment">// 返回信息</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> phone;    <span class="hljs-comment">// 手机号</span>
}

<span class="hljs-comment">// SDK 初始化事件</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JVSDKSetupEvent</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> code;        <span class="hljs-comment">// 返回码：8000成功</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> message;  <span class="hljs-comment">// 返回信息</span>
}

<span class="hljs-comment">// 授权页事件</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JVAuthPageEvent</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> eventType; <span class="hljs-comment">// 事件类型</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; data; <span class="hljs-comment">// 事件数据</span>
}
</code></pre>
<h3 id="主要接口方法">主要接口方法</h3>
<h4 id="1-sdk-初始化">1. SDK 初始化</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Jverify</span> </span>{
  <span class="hljs-comment">// 初始化 SDK</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; setup({
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> appKey,
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> channel,
    <span class="hljs-built_in">bool</span> isProduction = <span class="hljs-keyword">true</span>,
    JVSDKSetupCallBackListener? setupListener,
  });
  
  <span class="hljs-comment">// 检查初始化状态</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-built_in">bool</span>&gt; isSetup();
}
</code></pre>
<h4 id="2-一键登录">2. 一键登录</h4>
<pre><code class="language-dart"><span class="hljs-comment">// 预初始化</span>
<span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; preLogin({
  <span class="hljs-built_in">int</span> timeOut = <span class="hljs-number">5000</span>,
  JVLoginAuthCallBackListener? preLoginListener,
});

<span class="hljs-comment">// 判断网络环境是否支持</span>
<span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; checkVerifyEnable({
  JVLoginAuthCallBackListener? checkListener,
});

<span class="hljs-comment">// 获取登录 Token</span>
<span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; loginAuth({
  <span class="hljs-built_in">bool</span> autoDismiss = <span class="hljs-keyword">true</span>,
  <span class="hljs-built_in">int</span> timeOut = <span class="hljs-number">5000</span>,
  JVLoginAuthCallBackListener? loginListener,
});

<span class="hljs-comment">// 自定义授权页面</span>
<span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; setCustomAuthorizationView({
  <span class="hljs-keyword">required</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; config,
  JVClickWidgetEventListener? clickListener,
  JVAuthPageEventListener? authPageEventListener,
});
</code></pre>
<h4 id="3-短信验证">3. 短信验证</h4>
<pre><code class="language-dart"><span class="hljs-comment">// 获取短信验证码</span>
<span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; getSMSCode({
  <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> phoneNumber,
  <span class="hljs-built_in">String?</span> signID,
  <span class="hljs-built_in">String?</span> tempID,
  JVSMSListener? smsListener,
});

<span class="hljs-comment">// 短信验证登录</span>
<span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; smsAuth({
  <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> phoneNumber,
  <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> smsCode,
  JVSMSListener? smsListener,
});
</code></pre>
<h4 id="4-页面控制">4. 页面控制</h4>
<pre><code class="language-dart"><span class="hljs-comment">// 关闭授权页面</span>
<span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; dismissLoginAuth();

<span class="hljs-comment">// 清除预取号缓存</span>
<span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; clearPreLoginCache();

<span class="hljs-comment">// 设置调试模式</span>
<span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; setDebugMode(<span class="hljs-built_in">bool</span> enable);
</code></pre>
<h2 id="android-原生实现">Android 原生实现</h2>
<h3 id="项目结构">项目结构</h3>
<pre><code>android/
├── src/main/
│   ├── AndroidManifest.xml      # 权限和组件配置
│   ├── java/com/jverify/        # Java 实现代码
│   │   ├── JverifyPlugin.java   # 插件主类
│   │   ├── JVerifyHelper.java   # 辅助工具类
│   │   └── utils/               # 工具类
│   └── libs/                    # 极验 SDK 库文件
│       ├── jverify-android-*.jar
│       └── jcore-android-*.jar
└── build.gradle                 # 构建配置
</code></pre>
<h3 id="关键实现文件">关键实现文件</h3>
<h4 id="1-jverifypluginjava---插件主类">1. JverifyPlugin.java - 插件主类</h4>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JverifyPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FlutterPlugin</span>, MethodCallHandler {
    
    <span class="hljs-comment">// 方法通道</span>
    <span class="hljs-keyword">private</span> MethodChannel channel;
    
    <span class="hljs-comment">// 极验 SDK API 接口</span>
    <span class="hljs-keyword">private</span> JVerifyInterface jVerifyInterface;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAttachedToEngine</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> FlutterPluginBinding binding)</span> {
        channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodChannel</span>(binding.getBinaryMessenger(), <span class="hljs-string">&quot;jverify&quot;</span>);
        channel.setMethodCallHandler(<span class="hljs-built_in">this</span>);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMethodCall</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MethodCall call, <span class="hljs-meta">@NonNull</span> Result result)</span> {
        <span class="hljs-keyword">switch</span> (call.method) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;setup&quot;</span>:
                initSDK(call, result);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;checkVerifyEnable&quot;</span>:
                checkVerifyEnable(call, result);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;preLogin&quot;</span>:
                preLogin(call, result);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;loginAuth&quot;</span>:
                loginAuth(call, result);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;getSMSCode&quot;</span>:
                getSMSCode(call, result);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;smsAuth&quot;</span>:
                smsAuth(call, result);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;dismissLoginAuth&quot;</span>:
                dismissLoginAuth(result);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                result.notImplemented();
        }
    }
}
</code></pre>
<h4 id="2-核心功能实现">2. 核心功能实现</h4>
<pre><code class="language-java"><span class="hljs-comment">// SDK 初始化</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initSDK</span><span class="hljs-params">(MethodCall call, Result result)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">appKey</span> <span class="hljs-operator">=</span> call.argument(<span class="hljs-string">&quot;appKey&quot;</span>);
    <span class="hljs-type">String</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> call.argument(<span class="hljs-string">&quot;channel&quot;</span>);
    <span class="hljs-type">boolean</span> <span class="hljs-variable">isProduction</span> <span class="hljs-operator">=</span> call.argument(<span class="hljs-string">&quot;isProduction&quot;</span>);
    
    JVerifyInterface.init(getApplicationContext(), appKey, channel, isProduction);
    JVerifyInterface.setDebugMode(<span class="hljs-literal">true</span>);
    
    <span class="hljs-comment">// 设置初始化回调</span>
    JVerifyInterface.setInitListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InitListener</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResult</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String message)</span> {
            <span class="hljs-comment">// 回调到 Flutter</span>
            Map&lt;String, Object&gt; args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            args.put(<span class="hljs-string">&quot;code&quot;</span>, code);
            args.put(<span class="hljs-string">&quot;message&quot;</span>, message);
            channel.invokeMethod(<span class="hljs-string">&quot;onSDKSetup&quot;</span>, args);
        }
    });
}

<span class="hljs-comment">// 一键登录</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loginAuth</span><span class="hljs-params">(MethodCall call, Result result)</span> {
    <span class="hljs-type">boolean</span> <span class="hljs-variable">autoDismiss</span> <span class="hljs-operator">=</span> call.argument(<span class="hljs-string">&quot;autoDismiss&quot;</span>);
    <span class="hljs-type">int</span> <span class="hljs-variable">timeOut</span> <span class="hljs-operator">=</span> call.argument(<span class="hljs-string">&quot;timeOut&quot;</span>);
    
    JVerifyInterface.loginAuth(getCurrentActivity(), autoDismiss, timeOut, 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginAuthListener</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResult</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String content, String operator)</span> {
                Map&lt;String, Object&gt; args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
                args.put(<span class="hljs-string">&quot;code&quot;</span>, code);
                args.put(<span class="hljs-string">&quot;message&quot;</span>, content);
                args.put(<span class="hljs-string">&quot;operator&quot;</span>, operator);
                channel.invokeMethod(<span class="hljs-string">&quot;onLoginAuth&quot;</span>, args);
            }
        });
}
</code></pre>
<h3 id="android-配置">Android 配置</h3>
<h4 id="androidmanifestxml-权限配置">AndroidManifest.xml 权限配置</h4>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 网络权限 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.ACCESS_WIFI_STATE&quot;</span> /&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 电话权限 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.READ_PHONE_STATE&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.SEND_SMS&quot;</span> /&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 其他权限 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span> /&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">application</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 极验服务配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span>
            <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;JVERIFY_CHANNEL&quot;</span>
            <span class="hljs-attr">android:value</span>=<span class="hljs-string">&quot;${JVERIFY_CHANNEL}&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span>
            <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;JVERIFY_APPKEY&quot;</span>
            <span class="hljs-attr">android:value</span>=<span class="hljs-string">&quot;${JVERIFY_APPKEY}&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<h4 id="buildgradle-配置">build.gradle 配置</h4>
<pre><code class="language-gradle">android {
    compileSdkVersion <span class="hljs-number">33</span>
    
    defaultConfig {
        minSdkVersion <span class="hljs-number">19</span>
        targetSdkVersion <span class="hljs-number">33</span>
    }
    
    buildTypes {
        release {
            manifestPlaceholders = [
                JVERIFY_APPKEY: <span class="hljs-keyword">project</span>.hasProperty(<span class="hljs-string">&#x27;JVERIFY_APPKEY&#x27;</span>) ? JVERIFY_APPKEY : <span class="hljs-string">&#x27;&#x27;</span>,
                JVERIFY_CHANNEL: <span class="hljs-keyword">project</span>.hasProperty(<span class="hljs-string">&#x27;JVERIFY_CHANNEL&#x27;</span>) ? JVERIFY_CHANNEL : <span class="hljs-string">&#x27;developer-default&#x27;</span>
            ]
        }
    }
}

<span class="hljs-keyword">dependencies</span> {
    implementation <span class="hljs-string">&#x27;androidx.appcompat:appcompat:1.4.0&#x27;</span>
    implementation <span class="hljs-keyword">fileTree</span>(dir: <span class="hljs-string">&#x27;libs&#x27;</span>, <span class="hljs-keyword">include</span>: [<span class="hljs-string">&#x27;*.jar&#x27;</span>])
}
</code></pre>
<h2 id="ios-原生实现">iOS 原生实现</h2>
<h3 id="项目结构-1">项目结构</h3>
<pre><code>ios/
├── Classes/
│   ├── JverifyPlugin.h          # 插件头文件
│   ├── JverifyPlugin.m          # 插件实现文件
│   └── JVerifyHelper.h/m        # 辅助工具类
├── Assets/                      # 资源文件
├── Frameworks/                  # 极验 SDK 框架
│   └── JVERIFYService.framework
└── jverify.podspec             # CocoaPods 配置
</code></pre>
<h3 id="关键实现文件-1">关键实现文件</h3>
<h4 id="1-jverifypluginh---插件头文件">1. JverifyPlugin.h - 插件头文件</h4>
<pre><code class="language-objc"><span class="hljs-meta">#import <span class="hljs-string">&lt;Flutter/Flutter.h&gt;</span></span>
<span class="hljs-meta">#import <span class="hljs-string">&lt;JVERIFYService/JVERIFYService.h&gt;</span></span>

<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">JverifyPlugin</span> : <span class="hljs-title">NSObject</span>&lt;<span class="hljs-title">FlutterPlugin</span>&gt;</span>

<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) FlutterMethodChannel *channel;

<span class="hljs-keyword">@end</span>
</code></pre>
<h4 id="2-jverifypluginm---插件实现">2. JverifyPlugin.m - 插件实现</h4>
<pre><code class="language-objc"><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">JverifyPlugin</span></span>

+ (<span class="hljs-type">void</span>)registerWithRegistrar:(<span class="hljs-built_in">NSObject</span>&lt;FlutterPluginRegistrar&gt;*)registrar {
    FlutterMethodChannel* channel = [FlutterMethodChannel
        methodChannelWithName:<span class="hljs-string">@&quot;jverify&quot;</span>
        binaryMessenger:[registrar messenger]];
    
    JverifyPlugin* instance = [[JverifyPlugin alloc] init];
    instance.channel = channel;
    [registrar addMethodCallDelegate:instance channel:channel];
}

- (<span class="hljs-type">void</span>)handleMethodCall:(FlutterMethodCall*)call result:(FlutterResult)result {
    <span class="hljs-keyword">if</span> ([<span class="hljs-string">@&quot;setup&quot;</span> isEqualToString:call.method]) {
        [<span class="hljs-keyword">self</span> initSDK:call result:result];
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([<span class="hljs-string">@&quot;checkVerifyEnable&quot;</span> isEqualToString:call.method]) {
        [<span class="hljs-keyword">self</span> checkVerifyEnable:call result:result];
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([<span class="hljs-string">@&quot;preLogin&quot;</span> isEqualToString:call.method]) {
        [<span class="hljs-keyword">self</span> preLogin:call result:result];
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([<span class="hljs-string">@&quot;loginAuth&quot;</span> isEqualToString:call.method]) {
        [<span class="hljs-keyword">self</span> loginAuth:call result:result];
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([<span class="hljs-string">@&quot;getSMSCode&quot;</span> isEqualToString:call.method]) {
        [<span class="hljs-keyword">self</span> getSMSCode:call result:result];
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([<span class="hljs-string">@&quot;smsAuth&quot;</span> isEqualToString:call.method]) {
        [<span class="hljs-keyword">self</span> smsAuth:call result:result];
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([<span class="hljs-string">@&quot;dismissLoginAuth&quot;</span> isEqualToString:call.method]) {
        [<span class="hljs-keyword">self</span> dismissLoginAuth:result];
    } <span class="hljs-keyword">else</span> {
        result(FlutterMethodNotImplemented);
    }
}

<span class="hljs-comment">// SDK 初始化</span>
- (<span class="hljs-type">void</span>)initSDK:(FlutterMethodCall*)call result:(FlutterResult)result {
    <span class="hljs-built_in">NSString</span> *appKey = call.arguments[<span class="hljs-string">@&quot;appKey&quot;</span>];
    <span class="hljs-built_in">NSString</span> *channel = call.arguments[<span class="hljs-string">@&quot;channel&quot;</span>];
    <span class="hljs-type">BOOL</span> isProduction = [call.arguments[<span class="hljs-string">@&quot;isProduction&quot;</span>] boolValue];
    
    [JVERIFYService setupWithAppkey:appKey channel:channel apsForProduction:isProduction];
    
    <span class="hljs-comment">// 设置初始化回调</span>
    [JVERIFYService setInitHandler:^(JVInitResultModel *result) {
        <span class="hljs-built_in">NSDictionary</span> *args = @{
            <span class="hljs-string">@&quot;code&quot;</span>: @(result.code),
            <span class="hljs-string">@&quot;message&quot;</span>: result.message ?: <span class="hljs-string">@&quot;&quot;</span>
        };
        [<span class="hljs-keyword">self</span>.channel invokeMethod:<span class="hljs-string">@&quot;onSDKSetup&quot;</span> arguments:args];
    }];
    
    result(@(<span class="hljs-literal">YES</span>));
}

<span class="hljs-comment">// 一键登录</span>
- (<span class="hljs-type">void</span>)loginAuth:(FlutterMethodCall*)call result:(FlutterResult)result {
    <span class="hljs-type">BOOL</span> autoDismiss = [call.arguments[<span class="hljs-string">@&quot;autoDismiss&quot;</span>] boolValue];
    <span class="hljs-built_in">NSTimeInterval</span> timeOut = [call.arguments[<span class="hljs-string">@&quot;timeOut&quot;</span>] doubleValue] / <span class="hljs-number">1000.0</span>;
    
    [JVERIFYService getAuthorizationWithController:[<span class="hljs-keyword">self</span> getCurrentViewController]
                                          completion:^(JVAuthorizationResultModel *result) {
        <span class="hljs-built_in">NSDictionary</span> *args = @{
            <span class="hljs-string">@&quot;code&quot;</span>: @(result.code),
            <span class="hljs-string">@&quot;message&quot;</span>: result.content ?: <span class="hljs-string">@&quot;&quot;</span>,
            <span class="hljs-string">@&quot;operator&quot;</span>: result.operator ?: <span class="hljs-string">@&quot;&quot;</span>
        };
        [<span class="hljs-keyword">self</span>.channel invokeMethod:<span class="hljs-string">@&quot;onLoginAuth&quot;</span> arguments:args];
    }];
    
    result(@(<span class="hljs-literal">YES</span>));
}

<span class="hljs-keyword">@end</span>
</code></pre>
<h3 id="ios-配置">iOS 配置</h3>
<h4 id="jverifypodspec">jverify.podspec</h4>
<pre><code class="language-ruby"><span class="hljs-title class_">Pod::Spec</span>.new <span class="hljs-keyword">do</span> |<span class="hljs-params">s</span>|
  s.name             = <span class="hljs-string">&#x27;jverify&#x27;</span>
  s.version          = <span class="hljs-string">&#x27;1.0.0&#x27;</span>
  s.summary          = <span class="hljs-string">&#x27;JVerify Flutter Plugin&#x27;</span>
  s.description      = <span class="hljs-string">&#x27;A Flutter plugin for JVerify SDK&#x27;</span>
  s.homepage         = <span class="hljs-string">&#x27;https://www.jiguang.cn&#x27;</span>
  s.license          = { <span class="hljs-symbol">:file</span> =&gt; <span class="hljs-string">&#x27;../LICENSE&#x27;</span> }
  s.author           = { <span class="hljs-string">&#x27;JiGuang&#x27;</span> =&gt; <span class="hljs-string">&#x27;support@jiguang.cn&#x27;</span> }
  
  s.source           = { <span class="hljs-symbol">:path</span> =&gt; <span class="hljs-string">&#x27;.&#x27;</span> }
  s.source_files     = <span class="hljs-string">&#x27;Classes/**/*&#x27;</span>
  s.public_header_files = <span class="hljs-string">&#x27;Classes/**/*.h&#x27;</span>
  
  s.dependency <span class="hljs-string">&#x27;Flutter&#x27;</span>
  s.dependency <span class="hljs-string">&#x27;JVerify&#x27;</span>, <span class="hljs-string">&#x27;~&gt; 2.8.0&#x27;</span>
  
  s.platform = <span class="hljs-symbol">:ios</span>, <span class="hljs-string">&#x27;9.0&#x27;</span>
  s.ios.deployment_target = <span class="hljs-string">&#x27;9.0&#x27;</span>
  
  s.pod_target_xcconfig = { <span class="hljs-string">&#x27;DEFINES_MODULE&#x27;</span> =&gt; <span class="hljs-string">&#x27;YES&#x27;</span> }
  s.swift_version = <span class="hljs-string">&#x27;5.0&#x27;</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h4 id="infoplist-配置">Info.plist 配置</h4>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 应用传输安全设置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSAppTransportSecurity<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSAllowsArbitraryLoads<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 网络使用说明 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSPhotoLibraryUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>此应用需要访问相册来选择头像<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 电话权限说明 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSContactsUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>此应用需要访问通讯录进行一键登录<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
</code></pre>
<h2 id="使用示例">使用示例</h2>
<h3 id="基本集成">基本集成</h3>
<pre><code class="language-dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:jverify/jverify.dart&#x27;</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _LoginPageState createState() =&gt; _LoginPageState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_LoginPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">LoginPage</span>&gt; </span>{
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    _initJVerify();
  }
  
  <span class="hljs-comment">// 初始化 JVerify SDK</span>
  <span class="hljs-keyword">void</span> _initJVerify() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> Jverify.setup(
      appKey: <span class="hljs-string">&quot;your_app_key&quot;</span>,
      channel: <span class="hljs-string">&quot;developer-default&quot;</span>,
      isProduction: <span class="hljs-keyword">false</span>,
      setupListener: (JVSDKSetupEvent event) {
        <span class="hljs-keyword">if</span> (event.code == <span class="hljs-number">8000</span>) {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;SDK 初始化成功&quot;</span>);
          _preLogin();
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;SDK 初始化失败: <span class="hljs-subst">${event.message}</span>&quot;</span>);
        }
      },
    );
  }
  
  <span class="hljs-comment">// 预登录</span>
  <span class="hljs-keyword">void</span> _preLogin() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> Jverify.preLogin(
      preLoginListener: (JVListenerEvent event) {
        <span class="hljs-keyword">if</span> (event.code == <span class="hljs-number">6000</span>) {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;预登录成功&quot;</span>);
        }
      },
    );
  }
  
  <span class="hljs-comment">// 一键登录</span>
  <span class="hljs-keyword">void</span> _oneClickLogin() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> Jverify.loginAuth(
      loginListener: (JVListenerEvent event) {
        <span class="hljs-keyword">if</span> (event.code == <span class="hljs-number">6000</span>) {
          <span class="hljs-built_in">String</span> loginToken = event.message;
          <span class="hljs-comment">// 使用 loginToken 进行后续验证</span>
          _verifyTokenWithServer(loginToken);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;一键登录失败: <span class="hljs-subst">${event.message}</span>&quot;</span>);
        }
      },
    );
  }
  
  <span class="hljs-comment">// 短信登录</span>
  <span class="hljs-keyword">void</span> _smsLogin(<span class="hljs-built_in">String</span> phoneNumber, <span class="hljs-built_in">String</span> smsCode) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> Jverify.smsAuth(
      phoneNumber: phoneNumber,
      smsCode: smsCode,
      smsListener: (JVSMSEvent event) {
        <span class="hljs-keyword">if</span> (event.code == <span class="hljs-number">6000</span>) {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;短信登录成功&quot;</span>);
        }
      },
    );
  }
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      body: Column(
        children: [
          ElevatedButton(
            onPressed: _oneClickLogin,
            child: Text(<span class="hljs-string">&quot;一键登录&quot;</span>),
          ),
          ElevatedButton(
            onPressed: () =&gt; _getSMSCode(<span class="hljs-string">&quot;13800138000&quot;</span>),
            child: Text(<span class="hljs-string">&quot;获取验证码&quot;</span>),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<h2 id="错误码说明">错误码说明</h2>
<h3 id="通用错误码">通用错误码</h3>
<ul>
<li><strong>8000</strong>: SDK 初始化成功</li>
<li><strong>8001</strong>: SDK 初始化失败</li>
<li><strong>6000</strong>: 登录获取 loginToken 成功</li>
<li><strong>6001</strong>: 登录获取 loginToken 失败</li>
<li><strong>6002</strong>: 网络连接失败</li>
<li><strong>6003</strong>: 请求超时</li>
<li><strong>6004</strong>: 运营商网络未知</li>
</ul>
<h3 id="一键登录错误码">一键登录错误码</h3>
<ul>
<li><strong>6005</strong>: 手机号不支持此运营商</li>
<li><strong>6006</strong>: 用户取消登录</li>
<li><strong>6007</strong>: 登录环境异常</li>
<li><strong>6008</strong>: 登录失败，未知异常</li>
</ul>
<h3 id="短信验证错误码">短信验证错误码</h3>
<ul>
<li><strong>3000</strong>: 短信验证码发送成功</li>
<li><strong>3001</strong>: 短信验证码发送失败</li>
<li><strong>3002</strong>: 短信验证码验证成功</li>
<li><strong>3003</strong>: 短信验证码验证失败</li>
</ul>
<h2 id="性能优化">性能优化</h2>
<h3 id="网络优化">网络优化</h3>
<ul>
<li>预登录机制减少用户等待时间</li>
<li>智能重试机制提高成功率</li>
<li>网络状态检测优化用户体验</li>
</ul>
<h3 id="内存优化">内存优化</h3>
<ul>
<li>及时释放不用的资源</li>
<li>避免内存泄漏</li>
<li>合理管理生命周期</li>
</ul>
<h3 id="用户体验优化">用户体验优化</h3>
<ul>
<li>自定义授权页面样式</li>
<li>加载状态指示</li>
<li>错误提示优化</li>
</ul>
<h2 id="安全特性">安全特性</h2>
<h3 id="数据安全">数据安全</h3>
<ul>
<li>通信数据加密传输</li>
<li>敏感信息本地加密存储</li>
<li>防止中间人攻击</li>
</ul>
<h3 id="业务安全">业务安全</h3>
<ul>
<li>防刷机制</li>
<li>设备指纹验证</li>
<li>异常行为检测</li>
</ul>
<h2 id="测试指南">测试指南</h2>
<h3 id="单元测试">单元测试</h3>
<ul>
<li>SDK 接口调用测试</li>
<li>错误处理测试</li>
<li>边界条件测试</li>
</ul>
<h3 id="集成测试">集成测试</h3>
<ul>
<li>端到端登录流程测试</li>
<li>多平台兼容性测试</li>
<li>网络异常处理测试</li>
</ul>
<h3 id="性能测试">性能测试</h3>
<ul>
<li>初始化耗时测试</li>
<li>内存使用测试</li>
<li>并发请求测试</li>
</ul>
<h2 id="故障排除">故障排除</h2>
<h3 id="常见问题">常见问题</h3>
<ol>
<li><strong>初始化失败</strong>: 检查 AppKey 和渠道配置</li>
<li><strong>网络错误</strong>: 检查网络权限和网络连接</li>
<li><strong>登录失败</strong>: 检查运营商网络环境</li>
<li><strong>权限不足</strong>: 检查必要权限的授权状态</li>
</ol>
<h3 id="调试技巧">调试技巧</h3>
<ul>
<li>开启调试模式查看详细日志</li>
<li>使用网络抓包工具分析请求</li>
<li>检查设备网络环境和运营商</li>
</ul>
<h2 id="版本更新">版本更新</h2>
<h3 id="当前版本特性">当前版本特性</h3>
<ul>
<li>支持三大运营商一键登录</li>
<li>支持短信验证码登录</li>
<li>支持自定义授权页面</li>
<li>完善的错误处理机制</li>
</ul>
<h3 id="后续规划">后续规划</h3>
<ul>
<li>支持更多认证方式</li>
<li>优化用户体验</li>
<li>增强安全防护</li>
</ul>
<h2 id="总结">总结</h2>
<p><code>jverify</code> 插件为 OneApp 提供了完整的极验验证解决方案，通过封装原生 SDK，为 Flutter 应用提供了统一、便捷的验证接口。插件具有良好的跨平台兼容性和完善的错误处理机制，能够满足移动应用的各种验证场景需求。</p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>