<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>Basic UIs &#x901a;&#x7528;UI&#x7ec4;&#x4ef6;&#x96c6;&#x5408;&#x6a21;&#x5757;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="basic-uis-通用ui组件集合模块">Basic UIs 通用UI组件集合模块</h1>
<h2 id="模块概述">模块概述</h2>
<p><code>basic_uis</code> 是 OneApp 基础UI模块群中的通用UI组件集合模块，负责整合和统一管理所有的UI组件库。该模块提供了一站式的UI组件解决方案，包含了动画效果、权限管理、分享功能、地图集成等丰富的UI功能组件。</p>
<h3 id="基本信息">基本信息</h3>
<ul>
<li><strong>模块名称</strong>: basic_uis</li>
<li><strong>版本</strong>: 0.0.7</li>
<li><strong>描述</strong>: 通用UI组件集合包</li>
<li><strong>Flutter 版本</strong>: &gt;=1.17.0</li>
<li><strong>Dart 版本</strong>: &gt;=3.0.0 &lt;4.0.0</li>
</ul>
<h2 id="功能特性">功能特性</h2>
<h3 id="核心功能">核心功能</h3>
<ol>
<li>
<p><strong>UI组件整合</strong></p>
<ul>
<li>统一的UI组件导出</li>
<li>组件库版本管理</li>
<li>跨模块组件协调</li>
<li>全局UI配置管理</li>
</ul>
</li>
<li>
<p><strong>高级UI组件</strong></p>
<ul>
<li>下拉刷新组件集成</li>
<li>Lottie动画支持</li>
<li>WebView组件封装</li>
<li>地图视图集成</li>
</ul>
</li>
<li>
<p><strong>用户交互组件</strong></p>
<ul>
<li>权限管理UI组件</li>
<li>分享功能UI集成</li>
<li>图片保存组件</li>
<li>设置页面组件</li>
</ul>
</li>
<li>
<p><strong>系统集成组件</strong></p>
<ul>
<li>位置服务UI</li>
<li>应用设置界面</li>
<li>用户同意组件</li>
<li>Toast消息提示</li>
</ul>
</li>
</ol>
<h2 id="技术架构">技术架构</h2>
<h3 id="目录结构">目录结构</h3>
<pre><code>lib/
├── basic_uis.dart             # 模块入口文件
├── src/                       # 源代码目录
│   ├── components/            # 通用组件
│   ├── animations/            # 动画组件
│   ├── permissions/           # 权限组件
│   ├── sharing/               # 分享组件
│   ├── webview/               # WebView组件
│   ├── location/              # 位置组件
│   ├── settings/              # 设置组件
│   └── utils/                 # 工具类
├── widgets/                   # Widget导出
└── themes/                    # 主题配置
</code></pre>
<h3 id="依赖关系">依赖关系</h3>
<h4 id="ui框架依赖">UI框架依赖</h4>
<ul>
<li><code>easy_refresh: ^3.0.5</code> - 下拉刷新组件</li>
<li><code>lottie: ^3.1.0</code> - Lottie动画</li>
<li><code>fluttertoast: ^8.2.2</code> - Toast提示</li>
<li><code>helpers: ^1.2.3+1</code> - 辅助工具</li>
</ul>
<h4 id="功能组件依赖">功能组件依赖</h4>
<ul>
<li><code>basic_webview: ^0.2.4+4</code> - WebView组件</li>
<li><code>permission_handler: ^10.4.5</code> - 权限管理</li>
<li><code>image_gallery_saver: any</code> - 图片保存</li>
<li><code>share_plus: 7.2.1</code> - 分享功能</li>
<li><code>flutter_inappwebview: ^6.0.0</code> - 应用内WebView</li>
</ul>
<h4 id="业务组件依赖">业务组件依赖</h4>
<ul>
<li><code>app_consent: ^0.2.19</code> - 用户同意组件</li>
<li><code>ui_mapview: ^0.2.18</code> - 地图视图组件</li>
<li><code>app_settings: ^4.3.1</code> - 应用设置</li>
<li><code>location: ^6.0.1</code> - 位置服务</li>
</ul>
<h4 id="内部依赖">内部依赖</h4>
<ul>
<li><code>basic_utils</code> - 基础工具（本地路径）</li>
</ul>
<h2 id="核心组件分析">核心组件分析</h2>
<h3 id="1-模块入口-basic_uisdart">1. 模块入口 (<code>basic_uis.dart</code>)</h3>
<p><strong>功能职责</strong>:</p>
<ul>
<li>统一导出所有UI组件</li>
<li>初始化全局UI配置</li>
<li>管理组件生命周期</li>
</ul>
<pre><code class="language-dart"><span class="hljs-keyword">library</span> basic_uis;

<span class="hljs-comment">// 基础组件导出</span>
<span class="hljs-keyword">export</span> <span class="hljs-string">&#x27;src/components/enhanced_refresh_indicator.dart&#x27;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-string">&#x27;src/components/lottie_animation_widget.dart&#x27;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-string">&#x27;src/components/permission_request_dialog.dart&#x27;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-string">&#x27;src/components/share_action_sheet.dart&#x27;</span>;

<span class="hljs-comment">// WebView组件导出</span>
<span class="hljs-keyword">export</span> <span class="hljs-string">&#x27;src/webview/enhanced_webview.dart&#x27;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-string">&#x27;src/webview/webview_controller.dart&#x27;</span>;

<span class="hljs-comment">// 位置组件导出</span>
<span class="hljs-keyword">export</span> <span class="hljs-string">&#x27;src/location/location_picker_widget.dart&#x27;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-string">&#x27;src/location/map_integration_widget.dart&#x27;</span>;

<span class="hljs-comment">// 设置组件导出</span>
<span class="hljs-keyword">export</span> <span class="hljs-string">&#x27;src/settings/app_settings_page.dart&#x27;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-string">&#x27;src/settings/permission_settings_widget.dart&#x27;</span>;

<span class="hljs-comment">// 工具类导出</span>
<span class="hljs-keyword">export</span> <span class="hljs-string">&#x27;src/utils/ui_helpers.dart&#x27;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-string">&#x27;src/utils/toast_utils.dart&#x27;</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasicUIs</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> _isInitialized = <span class="hljs-keyword">false</span>;
  
  <span class="hljs-comment">/// <span class="language-markdown">初始化Basic UIs模块</span></span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; initialize() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">if</span> (_isInitialized) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-comment">// 初始化Toast配置</span>
    <span class="hljs-keyword">await</span> _initializeToast();
    
    <span class="hljs-comment">// 初始化权限处理器</span>
    <span class="hljs-keyword">await</span> _initializePermissions();
    
    <span class="hljs-comment">// 初始化分享服务</span>
    <span class="hljs-keyword">await</span> _initializeShare();
    
    <span class="hljs-comment">// 初始化WebView配置</span>
    <span class="hljs-keyword">await</span> _initializeWebView();
    
    _isInitialized = <span class="hljs-keyword">true</span>;
  }
}
</code></pre>
<h3 id="2-增强下拉刷新组件-srccomponentsenhanced_refresh_indicatordart">2. 增强下拉刷新组件 (<code>src/components/enhanced_refresh_indicator.dart</code>)</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EnhancedRefreshIndicator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">final</span> Widget child;
  <span class="hljs-keyword">final</span> Future&lt;<span class="hljs-keyword">void</span>&gt; <span class="hljs-built_in">Function</span>() onRefresh;
  <span class="hljs-keyword">final</span> Future&lt;<span class="hljs-keyword">void</span>&gt; <span class="hljs-built_in">Function</span>()? onLoadMore;
  <span class="hljs-keyword">final</span> RefreshIndicatorConfig? config;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> enablePullUp;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> enablePullDown;

  <span class="hljs-keyword">const</span> EnhancedRefreshIndicator({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.child,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onRefresh,
    <span class="hljs-keyword">this</span>.onLoadMore,
    <span class="hljs-keyword">this</span>.config,
    <span class="hljs-keyword">this</span>.enablePullUp = <span class="hljs-keyword">true</span>,
    <span class="hljs-keyword">this</span>.enablePullDown = <span class="hljs-keyword">true</span>,
  }) : <span class="hljs-keyword">super</span>(key: key);

  <span class="hljs-meta">@override</span>
  State&lt;EnhancedRefreshIndicator&gt; createState() =&gt; _EnhancedRefreshIndicatorState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_EnhancedRefreshIndicatorState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">EnhancedRefreshIndicator</span>&gt; </span>{
  <span class="hljs-keyword">late</span> EasyRefreshController _controller;

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> EasyRefresh(
      controller: _controller,
      onRefresh: widget.enablePullDown ? _onRefresh : <span class="hljs-keyword">null</span>,
      onLoad: widget.enablePullUp &amp;&amp; widget.onLoadMore != <span class="hljs-keyword">null</span> ? _onLoad : <span class="hljs-keyword">null</span>,
      header: _buildRefreshHeader(),
      footer: _buildLoadFooter(),
      child: widget.child,
    );
  }

  Widget _buildRefreshHeader() {
    <span class="hljs-keyword">return</span> ClassicHeader(
      dragText: <span class="hljs-string">&#x27;下拉刷新&#x27;</span>,
      armedText: <span class="hljs-string">&#x27;释放刷新&#x27;</span>,
      readyText: <span class="hljs-string">&#x27;正在刷新...&#x27;</span>,
      processingText: <span class="hljs-string">&#x27;正在刷新...&#x27;</span>,
      processedText: <span class="hljs-string">&#x27;刷新完成&#x27;</span>,
      noMoreText: <span class="hljs-string">&#x27;没有更多数据&#x27;</span>,
      failedText: <span class="hljs-string">&#x27;刷新失败&#x27;</span>,
      messageText: <span class="hljs-string">&#x27;最后更新于 %T&#x27;</span>,
    );
  }

  Widget _buildLoadFooter() {
    <span class="hljs-keyword">return</span> ClassicFooter(
      dragText: <span class="hljs-string">&#x27;上拉加载&#x27;</span>,
      armedText: <span class="hljs-string">&#x27;释放加载&#x27;</span>,
      readyText: <span class="hljs-string">&#x27;正在加载...&#x27;</span>,
      processingText: <span class="hljs-string">&#x27;正在加载...&#x27;</span>,
      processedText: <span class="hljs-string">&#x27;加载完成&#x27;</span>,
      noMoreText: <span class="hljs-string">&#x27;没有更多数据&#x27;</span>,
      failedText: <span class="hljs-string">&#x27;加载失败&#x27;</span>,
    );
  }
}
</code></pre>
<h3 id="3-lottie动画组件-srcanimationslottie_animation_widgetdart">3. Lottie动画组件 (<code>src/animations/lottie_animation_widget.dart</code>)</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LottieAnimationWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> assetPath;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double?</span> width;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double?</span> height;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> repeat;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> autoPlay;
  <span class="hljs-keyword">final</span> AnimationController? controller;
  <span class="hljs-keyword">final</span> VoidCallback? onComplete;

  <span class="hljs-keyword">const</span> LottieAnimationWidget({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.assetPath,
    <span class="hljs-keyword">this</span>.width,
    <span class="hljs-keyword">this</span>.height,
    <span class="hljs-keyword">this</span>.repeat = <span class="hljs-keyword">true</span>,
    <span class="hljs-keyword">this</span>.autoPlay = <span class="hljs-keyword">true</span>,
    <span class="hljs-keyword">this</span>.controller,
    <span class="hljs-keyword">this</span>.onComplete,
  }) : <span class="hljs-keyword">super</span>(key: key);

  <span class="hljs-meta">@override</span>
  State&lt;LottieAnimationWidget&gt; createState() =&gt; _LottieAnimationWidgetState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_LottieAnimationWidgetState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">LottieAnimationWidget</span>&gt; 
    <span class="hljs-title">with</span> <span class="hljs-title">TickerProviderStateMixin</span> </span>{
  <span class="hljs-keyword">late</span> AnimationController _animationController;

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    
    _animationController = widget.controller ?? 
        AnimationController(vsync: <span class="hljs-keyword">this</span>);
        
    <span class="hljs-keyword">if</span> (widget.autoPlay) {
      _animationController.forward();
    }
    
    _animationController.addStatusListener((status) {
      <span class="hljs-keyword">if</span> (status == AnimationStatus.completed) {
        widget.onComplete?.call();
        <span class="hljs-keyword">if</span> (widget.repeat) {
          _animationController.repeat();
        }
      }
    });
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Lottie.asset(
      widget.assetPath,
      width: widget.width,
      height: widget.height,
      controller: _animationController,
      onLoaded: (composition) {
        _animationController.duration = composition.duration;
        <span class="hljs-keyword">if</span> (widget.autoPlay) {
          _animationController.forward();
        }
      },
    );
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    <span class="hljs-keyword">if</span> (widget.controller == <span class="hljs-keyword">null</span>) {
      _animationController.dispose();
    }
    <span class="hljs-keyword">super</span>.dispose();
  }
}
</code></pre>
<h3 id="4-权限请求对话框-srcpermissionspermission_request_dialogdart">4. 权限请求对话框 (<code>src/permissions/permission_request_dialog.dart</code>)</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PermissionRequestDialog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> Permission permission;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> title;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> description;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> rationale;
  <span class="hljs-keyword">final</span> VoidCallback? onGranted;
  <span class="hljs-keyword">final</span> VoidCallback? onDenied;

  <span class="hljs-keyword">const</span> PermissionRequestDialog({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.permission,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.title,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.description,
    <span class="hljs-keyword">this</span>.rationale,
    <span class="hljs-keyword">this</span>.onGranted,
    <span class="hljs-keyword">this</span>.onDenied,
  }) : <span class="hljs-keyword">super</span>(key: key);

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> AlertDialog(
      title: Row(
        children: [
          Icon(_getPermissionIcon(), color: Theme.of(context).primaryColor),
          <span class="hljs-keyword">const</span> SizedBox(width: <span class="hljs-number">12</span>),
          Expanded(child: Text(title)),
        ],
      ),
      content: Column(
        mainAxisSize: MainAxisSize.min,
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Text(description),
          <span class="hljs-keyword">if</span> (rationale != <span class="hljs-keyword">null</span>) ...[
            <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">16</span>),
            Container(
              padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">12</span>),
              decoration: BoxDecoration(
                color: Colors.blue.withOpacity(<span class="hljs-number">0.1</span>),
                borderRadius: BorderRadius.circular(<span class="hljs-number">8</span>),
              ),
              child: Row(
                children: [
                  Icon(Icons.info_outline, 
                       color: Colors.blue, size: <span class="hljs-number">20</span>),
                  <span class="hljs-keyword">const</span> SizedBox(width: <span class="hljs-number">8</span>),
                  Expanded(
                    child: Text(
                      rationale!,
                      style: TextStyle(
                        color: Colors.blue[<span class="hljs-number">700</span>],
                        fontSize: <span class="hljs-number">14</span>,
                      ),
                    ),
                  ),
                ],
              ),
            ),
          ],
        ],
      ),
      actions: [
        TextButton(
          onPressed: () {
            Navigator.of(context).pop();
            onDenied?.call();
          },
          child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;拒绝&#x27;</span>),
        ),
        ElevatedButton(
          onPressed: () <span class="hljs-keyword">async</span> {
            Navigator.of(context).pop();
            <span class="hljs-keyword">final</span> status = <span class="hljs-keyword">await</span> permission.request();
            <span class="hljs-keyword">if</span> (status.isGranted) {
              onGranted?.call();
            } <span class="hljs-keyword">else</span> {
              onDenied?.call();
              <span class="hljs-keyword">if</span> (status.isPermanentlyDenied) {
                _showSettingsDialog(context);
              }
            }
          },
          child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;允许&#x27;</span>),
        ),
      ],
    );
  }

  IconData _getPermissionIcon() {
    <span class="hljs-keyword">switch</span> (permission) {
      <span class="hljs-keyword">case</span> Permission.camera:
        <span class="hljs-keyword">return</span> Icons.camera_alt;
      <span class="hljs-keyword">case</span> Permission.microphone:
        <span class="hljs-keyword">return</span> Icons.mic;
      <span class="hljs-keyword">case</span> Permission.location:
        <span class="hljs-keyword">return</span> Icons.location_on;
      <span class="hljs-keyword">case</span> Permission.storage:
        <span class="hljs-keyword">return</span> Icons.storage;
      <span class="hljs-keyword">case</span> Permission.photos:
        <span class="hljs-keyword">return</span> Icons.photo_library;
      <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">return</span> Icons.security;
    }
  }

  <span class="hljs-keyword">void</span> _showSettingsDialog(BuildContext context) {
    showDialog(
      context: context,
      builder: (context) =&gt; AlertDialog(
        title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;权限设置&#x27;</span>),
        content: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;请在设置中手动开启所需权限&#x27;</span>),
        actions: [
          TextButton(
            onPressed: () =&gt; Navigator.of(context).pop(),
            child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;取消&#x27;</span>),
          ),
          ElevatedButton(
            onPressed: () {
              Navigator.of(context).pop();
              openAppSettings();
            },
            child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;去设置&#x27;</span>),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<h3 id="5-分享操作表-srcsharingshare_action_sheetdart">5. 分享操作表 (<code>src/sharing/share_action_sheet.dart</code>)</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShareActionSheet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> ShareContent content;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;SharePlatform&gt; platforms;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Function</span>(SharePlatform)? onPlatformSelected;

  <span class="hljs-keyword">const</span> ShareActionSheet({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.content,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.platforms,
    <span class="hljs-keyword">this</span>.onPlatformSelected,
  }) : <span class="hljs-keyword">super</span>(key: key);

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Container(
      padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">20</span>),
      decoration: <span class="hljs-keyword">const</span> BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.vertical(top: Radius.circular(<span class="hljs-number">20</span>)),
      ),
      child: Column(
        mainAxisSize: MainAxisSize.min,
        children: [
          _buildHandle(),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">20</span>),
          Text(
            <span class="hljs-string">&#x27;分享到&#x27;</span>,
            style: Theme.of(context).textTheme.titleMedium,
          ),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">20</span>),
          _buildPlatformGrid(context),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">20</span>),
          _buildMoreActions(context),
        ],
      ),
    );
  }

  Widget _buildPlatformGrid(BuildContext context) {
    <span class="hljs-keyword">return</span> GridView.builder(
      shrinkWrap: <span class="hljs-keyword">true</span>,
      physics: <span class="hljs-keyword">const</span> NeverScrollableScrollPhysics(),
      gridDelegate: <span class="hljs-keyword">const</span> SliverGridDelegateWithFixedCrossAxisCount(
        crossAxisCount: <span class="hljs-number">4</span>,
        childAspectRatio: <span class="hljs-number">1</span>,
        crossAxisSpacing: <span class="hljs-number">20</span>,
        mainAxisSpacing: <span class="hljs-number">20</span>,
      ),
      itemCount: platforms.length,
      itemBuilder: (context, index) {
        <span class="hljs-keyword">final</span> platform = platforms[index];
        <span class="hljs-keyword">return</span> _buildPlatformItem(context, platform);
      },
    );
  }

  Widget _buildPlatformItem(BuildContext context, SharePlatform platform) {
    <span class="hljs-keyword">return</span> GestureDetector(
      onTap: () {
        Navigator.of(context).pop();
        onPlatformSelected?.call(platform);
        _shareToplatform(platform);
      },
      child: Column(
        children: [
          Container(
            width: <span class="hljs-number">60</span>,
            height: <span class="hljs-number">60</span>,
            decoration: BoxDecoration(
              color: platform.color.withOpacity(<span class="hljs-number">0.1</span>),
              borderRadius: BorderRadius.circular(<span class="hljs-number">12</span>),
            ),
            child: Icon(
              platform.icon,
              color: platform.color,
              size: <span class="hljs-number">30</span>,
            ),
          ),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">8</span>),
          Text(
            platform.name,
            style: Theme.of(context).textTheme.bodySmall,
            textAlign: TextAlign.center,
          ),
        ],
      ),
    );
  }

  Future&lt;<span class="hljs-keyword">void</span>&gt; _shareToplatform(SharePlatform platform) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">switch</span> (platform.type) {
        <span class="hljs-keyword">case</span> SharePlatformType.system:
          <span class="hljs-keyword">await</span> Share.share(content.text, subject: content.title);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> SharePlatformType.wechat:
          <span class="hljs-comment">// 微信分享逻辑</span>
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> SharePlatformType.weibo:
          <span class="hljs-comment">// 微博分享逻辑</span>
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> SharePlatformType.qq:
          <span class="hljs-comment">// QQ分享逻辑</span>
          <span class="hljs-keyword">break</span>;
      }
    } <span class="hljs-keyword">catch</span> (e) {
      ToastUtils.showError(<span class="hljs-string">&#x27;分享失败: <span class="hljs-subst">$e</span>&#x27;</span>);
    }
  }
}
</code></pre>
<h2 id="工具类">工具类</h2>
<h3 id="toast工具类-srcutilstoast_utilsdart">Toast工具类 (<code>src/utils/toast_utils.dart</code>)</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ToastUtils</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> showSuccess(<span class="hljs-built_in">String</span> message) {
    Fluttertoast.showToast(
      msg: message,
      toastLength: Toast.LENGTH_SHORT,
      gravity: ToastGravity.CENTER,
      backgroundColor: Colors.green,
      textColor: Colors.white,
      fontSize: <span class="hljs-number">16.0</span>,
    );
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> showError(<span class="hljs-built_in">String</span> message) {
    Fluttertoast.showToast(
      msg: message,
      toastLength: Toast.LENGTH_SHORT,
      gravity: ToastGravity.CENTER,
      backgroundColor: Colors.red,
      textColor: Colors.white,
      fontSize: <span class="hljs-number">16.0</span>,
    );
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> showInfo(<span class="hljs-built_in">String</span> message) {
    Fluttertoast.showToast(
      msg: message,
      toastLength: Toast.LENGTH_SHORT,
      gravity: ToastGravity.CENTER,
      backgroundColor: Colors.blue,
      textColor: Colors.white,
      fontSize: <span class="hljs-number">16.0</span>,
    );
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> showWarning(<span class="hljs-built_in">String</span> message) {
    Fluttertoast.showToast(
      msg: message,
      toastLength: Toast.LENGTH_SHORT,
      gravity: ToastGravity.CENTER,
      backgroundColor: Colors.orange,
      textColor: Colors.white,
      fontSize: <span class="hljs-number">16.0</span>,
    );
  }
}
</code></pre>
<h2 id="使用示例">使用示例</h2>
<h3 id="基础使用">基础使用</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasicUIsExample</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _BasicUIsExampleState createState() =&gt; _BasicUIsExampleState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_BasicUIsExampleState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">BasicUIsExample</span>&gt; </span>{
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    _initializeBasicUIs();
  }

  Future&lt;<span class="hljs-keyword">void</span>&gt; _initializeBasicUIs() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> BasicUIs.initialize();
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(title: Text(<span class="hljs-string">&#x27;Basic UIs Example&#x27;</span>)),
      body: EnhancedRefreshIndicator(
        onRefresh: _handleRefresh,
        onLoadMore: _handleLoadMore,
        child: ListView(
          children: [
            <span class="hljs-comment">// Lottie动画示例</span>
            LottieAnimationWidget(
              assetPath: <span class="hljs-string">&#x27;assets/animations/loading.json&#x27;</span>,
              width: <span class="hljs-number">100</span>,
              height: <span class="hljs-number">100</span>,
            ),
            
            <span class="hljs-comment">// 权限请求示例</span>
            ListTile(
              title: Text(<span class="hljs-string">&#x27;请求相机权限&#x27;</span>),
              onTap: () =&gt; _requestCameraPermission(),
            ),
            
            <span class="hljs-comment">// 分享功能示例</span>
            ListTile(
              title: Text(<span class="hljs-string">&#x27;分享内容&#x27;</span>),
              onTap: () =&gt; _showShareSheet(),
            ),
            
            <span class="hljs-comment">// Toast示例</span>
            ListTile(
              title: Text(<span class="hljs-string">&#x27;显示Toast&#x27;</span>),
              onTap: () =&gt; ToastUtils.showSuccess(<span class="hljs-string">&#x27;操作成功&#x27;</span>),
            ),
          ],
        ),
      ),
    );
  }

  Future&lt;<span class="hljs-keyword">void</span>&gt; _handleRefresh() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>));
    ToastUtils.showSuccess(<span class="hljs-string">&#x27;刷新完成&#x27;</span>);
  }

  Future&lt;<span class="hljs-keyword">void</span>&gt; _handleLoadMore() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>));
  }

  <span class="hljs-keyword">void</span> _requestCameraPermission() {
    showDialog(
      context: context,
      builder: (context) =&gt; PermissionRequestDialog(
        permission: Permission.camera,
        title: <span class="hljs-string">&#x27;相机权限&#x27;</span>,
        description: <span class="hljs-string">&#x27;需要相机权限来拍照和录制视频&#x27;</span>,
        rationale: <span class="hljs-string">&#x27;此权限用于扫描二维码和拍照功能&#x27;</span>,
        onGranted: () =&gt; ToastUtils.showSuccess(<span class="hljs-string">&#x27;权限已授予&#x27;</span>),
        onDenied: () =&gt; ToastUtils.showError(<span class="hljs-string">&#x27;权限被拒绝&#x27;</span>),
      ),
    );
  }

  <span class="hljs-keyword">void</span> _showShareSheet() {
    showModalBottomSheet(
      context: context,
      builder: (context) =&gt; ShareActionSheet(
        content: ShareContent(
          title: <span class="hljs-string">&#x27;OneApp&#x27;</span>,
          text: <span class="hljs-string">&#x27;快来体验OneApp的强大功能！&#x27;</span>,
          url: <span class="hljs-string">&#x27;https://oneapp.com&#x27;</span>,
        ),
        platforms: [
          SharePlatform.system(),
          SharePlatform.wechat(),
          SharePlatform.weibo(),
          SharePlatform.qq(),
        ],
        onPlatformSelected: (platform) {
          ToastUtils.showInfo(<span class="hljs-string">&#x27;分享到<span class="hljs-subst">${platform.name}</span>&#x27;</span>);
        },
      ),
    );
  }
}
</code></pre>
<h2 id="性能优化">性能优化</h2>
<h3 id="组件优化">组件优化</h3>
<ul>
<li><strong>懒加载</strong>: 按需加载重型组件</li>
<li><strong>Widget缓存</strong>: 缓存不变的Widget实例</li>
<li><strong>动画优化</strong>: 合理使用动画避免过度渲染</li>
<li><strong>内存管理</strong>: 及时释放资源和控制器</li>
</ul>
<h3 id="集成优化">集成优化</h3>
<ul>
<li><strong>依赖管理</strong>: 避免重复依赖和版本冲突</li>
<li><strong>包大小</strong>: 优化资源文件减少包大小</li>
<li><strong>初始化</strong>: 异步初始化避免阻塞启动</li>
<li><strong>缓存策略</strong>: 合理使用缓存提升性能</li>
</ul>
<h2 id="测试策略">测试策略</h2>
<h3 id="widget测试">Widget测试</h3>
<ul>
<li><strong>组件渲染测试</strong>: 验证组件正确渲染</li>
<li><strong>交互测试</strong>: 测试用户交互响应</li>
<li><strong>动画测试</strong>: 测试动画效果</li>
<li><strong>权限测试</strong>: 测试权限请求流程</li>
</ul>
<h3 id="集成测试">集成测试</h3>
<ul>
<li><strong>模块集成测试</strong>: 测试模块间协作</li>
<li><strong>第三方服务测试</strong>: 测试外部服务集成</li>
<li><strong>性能测试</strong>: 测试组件性能表现</li>
<li><strong>兼容性测试</strong>: 测试平台兼容性</li>
</ul>
<h2 id="最佳实践">最佳实践</h2>
<h3 id="组件使用">组件使用</h3>
<ol>
<li><strong>统一入口</strong>: 通过BasicUIs统一初始化</li>
<li><strong>配置管理</strong>: 集中管理组件配置</li>
<li><strong>错误处理</strong>: 完善的错误处理机制</li>
<li><strong>用户体验</strong>: 注重用户交互体验</li>
</ol>
<h3 id="开发规范">开发规范</h3>
<ol>
<li><strong>代码规范</strong>: 遵循统一的代码规范</li>
<li><strong>文档完善</strong>: 提供详细的使用文档</li>
<li><strong>版本管理</strong>: 合理的版本发布策略</li>
<li><strong>测试覆盖</strong>: 保证充分的测试覆盖</li>
</ol>
<h2 id="总结">总结</h2>
<p><code>basic_uis</code> 模块作为 OneApp 的通用UI组件集合，整合了丰富的UI功能组件和第三方服务，为应用开发提供了一站式的UI解决方案。通过统一的管理和标准化的接口，大大提升了开发效率和用户体验的一致性。模块具有良好的扩展性和可维护性，能够适应不断变化的UI需求。</p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>