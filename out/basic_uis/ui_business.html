<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>UI Business &#x4e1a;&#x52a1;UI&#x7ec4;&#x4ef6;&#x6a21;&#x5757;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="ui-business-业务ui组件模块">UI Business 业务UI组件模块</h1>
<h2 id="模块概述">模块概述</h2>
<p><code>ui_business</code> 是 OneApp 基础UI模块群中的业务组件库，专门提供与业务逻辑相关的UI组件和交互元素。该模块基于基础UI组件进行封装，提供了车联网、消息中心、地理位置等业务场景的专用组件。</p>
<h3 id="基本信息">基本信息</h3>
<ul>
<li><strong>模块名称</strong>: ui_business</li>
<li><strong>版本</strong>: 0.2.28+3</li>
<li><strong>描述</strong>: 业务UI组件库</li>
<li><strong>Flutter 版本</strong>: &gt;=2.10.5</li>
<li><strong>Dart 版本</strong>: &gt;=2.16.2 &lt;4.0.0</li>
</ul>
<h2 id="功能特性">功能特性</h2>
<h3 id="核心功能">核心功能</h3>
<ol>
<li>
<p><strong>业务组件库</strong></p>
<ul>
<li>车辆状态展示组件</li>
<li>消息中心组件</li>
<li>地理位置组件</li>
<li>用户同意组件</li>
</ul>
</li>
<li>
<p><strong>业务交互组件</strong></p>
<ul>
<li>业务表单组件</li>
<li>数据展示组件</li>
<li>状态指示组件</li>
<li>操作反馈组件</li>
</ul>
</li>
<li>
<p><strong>专业界面元素</strong></p>
<ul>
<li>车辆控制面板</li>
<li>地图相关组件</li>
<li>消息列表组件</li>
<li>权限申请组件</li>
</ul>
</li>
<li>
<p><strong>业务流程组件</strong></p>
<ul>
<li>引导流程组件</li>
<li>步骤指示器</li>
<li>进度展示组件</li>
<li>结果页面组件</li>
</ul>
</li>
</ol>
<h2 id="技术架构">技术架构</h2>
<h3 id="目录结构">目录结构</h3>
<pre><code>lib/
├── ui_business.dart            # 模块入口文件
├── src/                        # 源代码目录
│   ├── vehicle/                # 车辆相关组件
│   ├── message/                # 消息中心组件
│   ├── location/               # 地理位置组件
│   ├── consent/                # 用户同意组件
│   ├── forms/                  # 业务表单组件
│   ├── displays/               # 数据展示组件
│   └── workflows/              # 业务流程组件
├── widgets/                    # 组件导出
└── themes/                     # 业务主题
</code></pre>
<h3 id="依赖关系">依赖关系</h3>
<h4 id="基础框架依赖">基础框架依赖</h4>
<ul>
<li><code>basic_modular: ^0.2.3</code> - 模块化框架</li>
<li><code>basic_modular_route: ^0.2.1</code> - 路由管理</li>
<li><code>basic_intl: ^0.2.0</code> - 国际化基础</li>
<li><code>basic_intl_flutter: ^0.2.2+1</code> - 国际化Flutter支持</li>
</ul>
<h4 id="业务服务依赖">业务服务依赖</h4>
<ul>
<li><code>clr_message: ^0.2.5+3</code> - 消息中心服务</li>
<li><code>clr_geo: ^0.2.16+1</code> - 地理位置服务</li>
<li><code>basic_consent: ^0.2.17</code> - 用户同意框架</li>
<li><code>basic_error: ^0.2.3+1</code> - 错误处理框架</li>
<li><code>basic_track: ^0.1.3</code> - 数据埋点</li>
</ul>
<h4 id="工具依赖">工具依赖</h4>
<ul>
<li><code>dartz: ^0.10.1</code> - 函数式编程</li>
<li><code>freezed_annotation: ^2.0.3</code> - 数据类注解</li>
<li><code>url_launcher: ^6.1.11</code> - URL启动</li>
</ul>
<h2 id="核心组件分析">核心组件分析</h2>
<h3 id="1-车辆相关组件-srcvehicle">1. 车辆相关组件 (<code>src/vehicle/</code>)</h3>
<h4 id="车辆状态卡片">车辆状态卡片</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleStatusCard</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> VehicleStatus status;
  <span class="hljs-keyword">final</span> VoidCallback? onTap;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> showDetails;

  <span class="hljs-keyword">const</span> VehicleStatusCard({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.status,
    <span class="hljs-keyword">this</span>.onTap,
    <span class="hljs-keyword">this</span>.showDetails = <span class="hljs-keyword">true</span>,
  }) : <span class="hljs-keyword">super</span>(key: key);

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Card(
      margin: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">16</span>),
      child: InkWell(
        onTap: onTap,
        borderRadius: BorderRadius.circular(<span class="hljs-number">12</span>),
        child: Padding(
          padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">20</span>),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              _buildHeader(context),
              <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">16</span>),
              _buildStatusIndicators(context),
              <span class="hljs-keyword">if</span> (showDetails) ...[
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">16</span>),
                _buildDetailInfo(context),
              ],
            ],
          ),
        ),
      ),
    );
  }

  Widget _buildHeader(BuildContext context) {
    <span class="hljs-keyword">return</span> Row(
      children: [
        CircleAvatar(
          backgroundColor: _getStatusColor().withOpacity(<span class="hljs-number">0.1</span>),
          child: Icon(
            _getStatusIcon(),
            color: _getStatusColor(),
          ),
        ),
        <span class="hljs-keyword">const</span> SizedBox(width: <span class="hljs-number">12</span>),
        Expanded(
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Text(
                status.vehicleName,
                style: Theme.of(context).textTheme.titleMedium?.copyWith(
                  fontWeight: FontWeight.bold,
                ),
              ),
              Text(
                _getStatusText(),
                style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  color: _getStatusColor(),
                ),
              ),
            ],
          ),
        ),
        Icon(
          Icons.arrow_forward_ios,
          size: <span class="hljs-number">16</span>,
          color: Colors.grey[<span class="hljs-number">400</span>],
        ),
      ],
    );
  }

  Widget _buildStatusIndicators(BuildContext context) {
    <span class="hljs-keyword">return</span> Row(
      children: [
        _buildIndicator(
          context,
          Icons.battery_charging_full,
          <span class="hljs-string">&#x27;<span class="hljs-subst">${status.batteryLevel}</span>%&#x27;</span>,
          status.batteryLevel &gt; <span class="hljs-number">20</span> ? Colors.green : Colors.orange,
        ),
        <span class="hljs-keyword">const</span> SizedBox(width: <span class="hljs-number">24</span>),
        _buildIndicator(
          context,
          Icons.speed,
          <span class="hljs-string">&#x27;<span class="hljs-subst">${status.mileage}</span> km&#x27;</span>,
          Colors.blue,
        ),
        <span class="hljs-keyword">const</span> SizedBox(width: <span class="hljs-number">24</span>),
        _buildIndicator(
          context,
          Icons.lock,
          status.isLocked ? <span class="hljs-string">&#x27;已锁定&#x27;</span> : <span class="hljs-string">&#x27;未锁定&#x27;</span>,
          status.isLocked ? Colors.red : Colors.green,
        ),
      ],
    );
  }

  Widget _buildIndicator(
    BuildContext context,
    IconData icon,
    <span class="hljs-built_in">String</span> value,
    Color color,
  ) {
    <span class="hljs-keyword">return</span> Row(
      children: [
        Icon(icon, size: <span class="hljs-number">16</span>, color: color),
        <span class="hljs-keyword">const</span> SizedBox(width: <span class="hljs-number">4</span>),
        Text(
          value,
          style: Theme.of(context).textTheme.bodySmall?.copyWith(
            color: color,
            fontWeight: FontWeight.w500,
          ),
        ),
      ],
    );
  }
}
</code></pre>
<h4 id="车辆控制面板">车辆控制面板</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleControlPanel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> VehicleStatus status;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Function</span>(VehicleAction) onAction;

  <span class="hljs-keyword">const</span> VehicleControlPanel({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.status,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onAction,
  }) : <span class="hljs-keyword">super</span>(key: key);

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Container(
      padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">20</span>),
      decoration: BoxDecoration(
        color: Theme.of(context).cardColor,
        borderRadius: <span class="hljs-keyword">const</span> BorderRadius.vertical(
          top: Radius.circular(<span class="hljs-number">20</span>),
        ),
        boxShadow: [
          BoxShadow(
            color: Colors.black.withOpacity(<span class="hljs-number">0.1</span>),
            blurRadius: <span class="hljs-number">10</span>,
            offset: <span class="hljs-keyword">const</span> Offset(<span class="hljs-number">0</span>, <span class="hljs-number">-2</span>),
          ),
        ],
      ),
      child: Column(
        mainAxisSize: MainAxisSize.min,
        children: [
          _buildHandle(),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">20</span>),
          _buildQuickActions(context),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">16</span>),
          _buildDetailActions(context),
        ],
      ),
    );
  }

  Widget _buildQuickActions(BuildContext context) {
    <span class="hljs-keyword">return</span> Row(
      mainAxisAlignment: MainAxisAlignment.spaceEvenly,
      children: [
        _buildActionButton(
          context,
          icon: status.isLocked ? Icons.lock_open : Icons.lock,
          label: status.isLocked ? <span class="hljs-string">&#x27;解锁&#x27;</span> : <span class="hljs-string">&#x27;锁定&#x27;</span>,
          color: status.isLocked ? Colors.green : Colors.red,
          onTap: () =&gt; onAction(
            status.isLocked ? VehicleAction.unlock : VehicleAction.lock,
          ),
        ),
        _buildActionButton(
          context,
          icon: Icons.ac_unit,
          label: <span class="hljs-string">&#x27;空调&#x27;</span>,
          color: Colors.blue,
          onTap: () =&gt; onAction(VehicleAction.airConditioner),
        ),
        _buildActionButton(
          context,
          icon: Icons.electric_bolt,
          label: <span class="hljs-string">&#x27;充电&#x27;</span>,
          color: Colors.orange,
          onTap: () =&gt; onAction(VehicleAction.charge),
        ),
        _buildActionButton(
          context,
          icon: Icons.location_on,
          label: <span class="hljs-string">&#x27;定位&#x27;</span>,
          color: Colors.purple,
          onTap: () =&gt; onAction(VehicleAction.locate),
        ),
      ],
    );
  }
}
</code></pre>
<h3 id="2-消息中心组件-srcmessage">2. 消息中心组件 (<code>src/message/</code>)</h3>
<h4 id="消息列表组件">消息列表组件</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MessageListView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">final</span> Future&lt;<span class="hljs-built_in">List</span>&lt;Message&gt;&gt; <span class="hljs-built_in">Function</span>() onRefresh;
  <span class="hljs-keyword">final</span> Future&lt;<span class="hljs-built_in">List</span>&lt;Message&gt;&gt; <span class="hljs-built_in">Function</span>()? onLoadMore;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Function</span>(Message)? onMessageTap;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Function</span>(Message)? onMessageDelete;

  <span class="hljs-keyword">const</span> MessageListView({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onRefresh,
    <span class="hljs-keyword">this</span>.onLoadMore,
    <span class="hljs-keyword">this</span>.onMessageTap,
    <span class="hljs-keyword">this</span>.onMessageDelete,
  }) : <span class="hljs-keyword">super</span>(key: key);

  <span class="hljs-meta">@override</span>
  State&lt;MessageListView&gt; createState() =&gt; _MessageListViewState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MessageListViewState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MessageListView</span>&gt; </span>{
  <span class="hljs-built_in">List</span>&lt;Message&gt; _messages = [];
  <span class="hljs-built_in">bool</span> _isLoading = <span class="hljs-keyword">false</span>;

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> RefreshIndicator(
      onRefresh: _handleRefresh,
      child: ListView.separated(
        itemCount: _messages.length,
        separatorBuilder: (context, index) =&gt; <span class="hljs-keyword">const</span> Divider(height: <span class="hljs-number">1</span>),
        itemBuilder: (context, index) {
          <span class="hljs-keyword">final</span> message = _messages[index];
          <span class="hljs-keyword">return</span> MessageTile(
            message: message,
            onTap: () =&gt; widget.onMessageTap?.call(message),
            onDelete: () =&gt; widget.onMessageDelete?.call(message),
          );
        },
      ),
    );
  }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MessageTile</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> Message message;
  <span class="hljs-keyword">final</span> VoidCallback? onTap;
  <span class="hljs-keyword">final</span> VoidCallback? onDelete;

  <span class="hljs-keyword">const</span> MessageTile({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.message,
    <span class="hljs-keyword">this</span>.onTap,
    <span class="hljs-keyword">this</span>.onDelete,
  }) : <span class="hljs-keyword">super</span>(key: key);

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Dismissible(
      key: Key(message.id),
      direction: DismissDirection.endToStart,
      background: Container(
        alignment: Alignment.centerRight,
        padding: <span class="hljs-keyword">const</span> EdgeInsets.only(right: <span class="hljs-number">20</span>),
        color: Colors.red,
        child: <span class="hljs-keyword">const</span> Icon(Icons.delete, color: Colors.white),
      ),
      onDismissed: (_) =&gt; onDelete?.call(),
      child: ListTile(
        leading: _buildMessageIcon(),
        title: Text(
          message.title,
          style: TextStyle(
            fontWeight: message.isRead ? FontWeight.normal : FontWeight.bold,
          ),
        ),
        subtitle: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Text(
              message.content,
              maxLines: <span class="hljs-number">2</span>,
              overflow: TextOverflow.ellipsis,
            ),
            <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">4</span>),
            Text(
              _formatTime(message.timestamp),
              style: Theme.of(context).textTheme.bodySmall,
            ),
          ],
        ),
        trailing: !message.isRead
            ? Container(
                width: <span class="hljs-number">8</span>,
                height: <span class="hljs-number">8</span>,
                decoration: <span class="hljs-keyword">const</span> BoxDecoration(
                  color: Colors.red,
                  shape: BoxShape.circle,
                ),
              )
            : <span class="hljs-keyword">null</span>,
        onTap: onTap,
      ),
    );
  }
}
</code></pre>
<h3 id="3-地理位置组件-srclocation">3. 地理位置组件 (<code>src/location/</code>)</h3>
<h4 id="位置选择器">位置选择器</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LocationPicker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">final</span> LatLng? initialLocation;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Function</span>(LocationResult) onLocationSelected;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> title;

  <span class="hljs-keyword">const</span> LocationPicker({
    Key? key,
    <span class="hljs-keyword">this</span>.initialLocation,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onLocationSelected,
    <span class="hljs-keyword">this</span>.title,
  }) : <span class="hljs-keyword">super</span>(key: key);

  <span class="hljs-meta">@override</span>
  State&lt;LocationPicker&gt; createState() =&gt; _LocationPickerState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_LocationPickerState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">LocationPicker</span>&gt; </span>{
  <span class="hljs-keyword">late</span> TextEditingController _searchController;
  <span class="hljs-built_in">List</span>&lt;POI&gt; _searchResults = [];
  <span class="hljs-built_in">bool</span> _isSearching = <span class="hljs-keyword">false</span>;

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(
        title: Text(widget.title ?? <span class="hljs-string">&#x27;选择位置&#x27;</span>),
        bottom: PreferredSize(
          preferredSize: <span class="hljs-keyword">const</span> Size.fromHeight(<span class="hljs-number">60</span>),
          child: _buildSearchBar(),
        ),
      ),
      body: Column(
        children: [
          <span class="hljs-keyword">if</span> (_isSearching) _buildSearchResults(),
          Expanded(child: _buildMap()),
        ],
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _getCurrentLocation,
        child: <span class="hljs-keyword">const</span> Icon(Icons.my_location),
      ),
    );
  }

  Widget _buildSearchBar() {
    <span class="hljs-keyword">return</span> Container(
      padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">16</span>),
      child: TextField(
        controller: _searchController,
        decoration: InputDecoration(
          hintText: <span class="hljs-string">&#x27;搜索地点&#x27;</span>,
          prefixIcon: <span class="hljs-keyword">const</span> Icon(Icons.search),
          suffixIcon: _searchController.text.isNotEmpty
              ? IconButton(
                  icon: <span class="hljs-keyword">const</span> Icon(Icons.clear),
                  onPressed: () {
                    _searchController.clear();
                    _clearSearch();
                  },
                )
              : <span class="hljs-keyword">null</span>,
          border: OutlineInputBorder(
            borderRadius: BorderRadius.circular(<span class="hljs-number">25</span>),
          ),
          contentPadding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="hljs-number">20</span>),
        ),
        onChanged: _onSearchChanged,
      ),
    );
  }
}
</code></pre>
<h3 id="4-用户同意组件-srcconsent">4. 用户同意组件 (<code>src/consent/</code>)</h3>
<h4 id="同意确认对话框">同意确认对话框</h4>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConsentDialog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">final</span> ConsentConfig config;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Function</span>(<span class="hljs-built_in">bool</span>) onResult;

  <span class="hljs-keyword">const</span> ConsentDialog({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.config,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onResult,
  }) : <span class="hljs-keyword">super</span>(key: key);

  <span class="hljs-meta">@override</span>
  State&lt;ConsentDialog&gt; createState() =&gt; _ConsentDialogState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_ConsentDialogState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">ConsentDialog</span>&gt; </span>{
  <span class="hljs-built_in">bool</span> _hasReadTerms = <span class="hljs-keyword">false</span>;
  <span class="hljs-built_in">bool</span> _acceptedTerms = <span class="hljs-keyword">false</span>;

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> AlertDialog(
      title: Text(widget.config.title),
      content: Column(
        mainAxisSize: MainAxisSize.min,
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Text(widget.config.description),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">16</span>),
          _buildTermsSection(),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">16</span>),
          _buildConsentCheckbox(),
        ],
      ),
      actions: [
        TextButton(
          onPressed: () =&gt; widget.onResult(<span class="hljs-keyword">false</span>),
          child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;拒绝&#x27;</span>),
        ),
        ElevatedButton(
          onPressed: _acceptedTerms ? () =&gt; widget.onResult(<span class="hljs-keyword">true</span>) : <span class="hljs-keyword">null</span>,
          child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;同意&#x27;</span>),
        ),
      ],
    );
  }

  Widget _buildTermsSection() {
    <span class="hljs-keyword">return</span> Container(
      height: <span class="hljs-number">120</span>,
      padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">12</span>),
      decoration: BoxDecoration(
        border: Border.all(color: Colors.grey[<span class="hljs-number">300</span>]!),
        borderRadius: BorderRadius.circular(<span class="hljs-number">8</span>),
      ),
      child: SingleChildScrollView(
        child: Text(
          widget.config.termsContent,
          style: Theme.of(context).textTheme.bodySmall,
        ),
      ),
    );
  }

  Widget _buildConsentCheckbox() {
    <span class="hljs-keyword">return</span> CheckboxListTile(
      value: _acceptedTerms,
      onChanged: _hasReadTerms ? (value) {
        setState(() {
          _acceptedTerms = value ?? <span class="hljs-keyword">false</span>;
        });
      } : <span class="hljs-keyword">null</span>,
      title: Text(
        <span class="hljs-string">&#x27;我已阅读并同意上述条款&#x27;</span>,
        style: Theme.of(context).textTheme.bodyMedium,
      ),
      controlAffinity: ListTileControlAffinity.leading,
      contentPadding: EdgeInsets.zero,
    );
  }
}
</code></pre>
<h2 id="使用示例">使用示例</h2>
<h3 id="车辆状态展示">车辆状态展示</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleStatusExample</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">final</span> vehicleStatus = VehicleStatus(
      vehicleName: <span class="hljs-string">&#x27;ID.4 CROZZ&#x27;</span>,
      batteryLevel: <span class="hljs-number">85</span>,
      mileage: <span class="hljs-number">15234</span>,
      isLocked: <span class="hljs-keyword">true</span>,
      location: <span class="hljs-string">&#x27;北京市朝阳区&#x27;</span>,
    );

    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(title: Text(<span class="hljs-string">&#x27;我的车辆&#x27;</span>)),
      body: Column(
        children: [
          VehicleStatusCard(
            status: vehicleStatus,
            onTap: () {
              <span class="hljs-comment">// 跳转到车辆详情页</span>
            },
          ),
          Expanded(
            child: VehicleControlPanel(
              status: vehicleStatus,
              onAction: (action) {
                <span class="hljs-comment">// 处理车辆操作</span>
                _handleVehicleAction(action);
              },
            ),
          ),
        ],
      ),
    );
  }

  <span class="hljs-keyword">void</span> _handleVehicleAction(VehicleAction action) {
    <span class="hljs-keyword">switch</span> (action) {
      <span class="hljs-keyword">case</span> VehicleAction.lock:
        <span class="hljs-comment">// 锁车操作</span>
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> VehicleAction.unlock:
        <span class="hljs-comment">// 解锁操作</span>
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> VehicleAction.airConditioner:
        <span class="hljs-comment">// 空调操作</span>
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> VehicleAction.charge:
        <span class="hljs-comment">// 充电操作</span>
        <span class="hljs-keyword">break</span>;
    }
  }
}
</code></pre>
<h3 id="消息中心展示">消息中心展示</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MessageCenterExample</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(title: Text(<span class="hljs-string">&#x27;消息中心&#x27;</span>)),
      body: MessageListView(
        onRefresh: () <span class="hljs-keyword">async</span> {
          <span class="hljs-comment">// 刷新消息列表</span>
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> MessageService.getMessages();
        },
        onLoadMore: () <span class="hljs-keyword">async</span> {
          <span class="hljs-comment">// 加载更多消息</span>
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> MessageService.getMoreMessages();
        },
        onMessageTap: (message) {
          <span class="hljs-comment">// 处理消息点击</span>
          Navigator.push(
            context,
            MaterialPageRoute(
              builder: (context) =&gt; MessageDetailPage(message: message),
            ),
          );
        },
        onMessageDelete: (message) {
          <span class="hljs-comment">// 删除消息</span>
          MessageService.deleteMessage(message.id);
        },
      ),
    );
  }
}
</code></pre>
<h2 id="主题定制">主题定制</h2>
<h3 id="业务主题配置">业务主题配置</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BusinessTheme</span> </span>{
  <span class="hljs-keyword">static</span> ThemeData <span class="hljs-keyword">get</span> vehicleTheme {
    <span class="hljs-keyword">return</span> ThemeData(
      primarySwatch: Colors.blue,
      cardTheme: CardTheme(
        elevation: <span class="hljs-number">4</span>,
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(<span class="hljs-number">16</span>),
        ),
      ),
      <span class="hljs-comment">// 车辆相关主题配置</span>
    );
  }

  <span class="hljs-keyword">static</span> ThemeData <span class="hljs-keyword">get</span> messageTheme {
    <span class="hljs-keyword">return</span> ThemeData(
      primarySwatch: Colors.green,
      <span class="hljs-comment">// 消息中心主题配置</span>
    );
  }
}
</code></pre>
<h2 id="性能优化">性能优化</h2>
<h3 id="业务组件优化">业务组件优化</h3>
<ul>
<li><strong>数据缓存</strong>: 缓存业务数据减少网络请求</li>
<li><strong>图片优化</strong>: 使用缓存和压缩优化图片加载</li>
<li><strong>列表优化</strong>: 使用懒加载和虚拟滚动</li>
<li><strong>状态管理</strong>: 合理使用状态管理减少重建</li>
</ul>
<h3 id="用户体验优化">用户体验优化</h3>
<ul>
<li><strong>加载状态</strong>: 提供友好的加载提示</li>
<li><strong>错误处理</strong>: 优雅的错误页面和重试机制</li>
<li><strong>离线支持</strong>: 基本的离线功能支持</li>
<li><strong>响应式设计</strong>: 适配不同屏幕尺寸</li>
</ul>
<h2 id="测试策略">测试策略</h2>
<h3 id="业务组件测试">业务组件测试</h3>
<ul>
<li><strong>业务逻辑测试</strong>: 测试业务相关逻辑</li>
<li><strong>UI组件测试</strong>: 测试组件渲染和交互</li>
<li><strong>集成测试</strong>: 测试与服务的集成</li>
<li><strong>用户体验测试</strong>: 测试用户操作流程</li>
</ul>
<h2 id="最佳实践">最佳实践</h2>
<h3 id="组件使用建议">组件使用建议</h3>
<ol>
<li><strong>业务封装</strong>: 将业务逻辑封装在组件内部</li>
<li><strong>数据驱动</strong>: 使用数据模型驱动UI更新</li>
<li><strong>错误边界</strong>: 添加适当的错误处理边界</li>
<li><strong>无障碍访问</strong>: 考虑无障碍功能支持</li>
</ol>
<h3 id="开发规范">开发规范</h3>
<ol>
<li><strong>命名规范</strong>: 使用清晰的业务相关命名</li>
<li><strong>文档完善</strong>: 提供详细的组件使用文档</li>
<li><strong>版本兼容</strong>: 保持向后兼容性</li>
<li><strong>代码复用</strong>: 提取通用的业务逻辑</li>
</ol>
<h2 id="总结">总结</h2>
<p><code>ui_business</code> 模块作为 OneApp 的业务UI组件库，专门针对车联网、消息中心、地理位置等业务场景提供了专业的UI组件。通过业务逻辑的封装和标准化的交互模式，大大提升了业务功能的开发效率和用户体验一致性。模块具有良好的扩展性和可维护性，能够快速适应业务需求的变化。</p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>