<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>Basic Push &#x63a8;&#x9001;&#x670d;&#x52a1;&#x6a21;&#x5757;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="basic-push-推送服务模块">Basic Push 推送服务模块</h1>
<h2 id="模块概述">模块概述</h2>
<p><code>basic_push</code> 是 OneApp 基础工具模块群中的推送服务模块，负责统一管理应用的消息推送功能。该模块集成了多种推送服务提供商，提供统一的推送接口和消息处理能力，支持本地通知、远程推送、定时推送等功能。</p>
<h3 id="基本信息">基本信息</h3>
<ul>
<li><strong>模块名称</strong>: basic_push</li>
<li><strong>版本</strong>: 0.2.5+8</li>
<li><strong>描述</strong>: 移动应用推送服务框架</li>
<li><strong>Flutter 版本</strong>: &gt;=1.17.0</li>
<li><strong>Dart 版本</strong>: &gt;=2.17.0 &lt;4.0.0</li>
</ul>
<h2 id="功能特性">功能特性</h2>
<h3 id="核心功能">核心功能</h3>
<ol>
<li>
<p><strong>多渠道推送支持</strong></p>
<ul>
<li>美团云推送集成</li>
<li>FCM (Firebase Cloud Messaging)</li>
<li>APNs (Apple Push Notification)</li>
<li>华为推送服务</li>
</ul>
</li>
<li>
<p><strong>消息类型管理</strong></p>
<ul>
<li>文本消息推送</li>
<li>富媒体消息</li>
<li>自定义数据推送</li>
<li>静默推送</li>
</ul>
</li>
<li>
<p><strong>推送策略控制</strong></p>
<ul>
<li>定时推送</li>
<li>地理位置推送</li>
<li>用户分组推送</li>
<li>A/B测试推送</li>
</ul>
</li>
<li>
<p><strong>本地通知系统</strong></p>
<ul>
<li>即时本地通知</li>
<li>定时本地通知</li>
<li>重复通知设置</li>
<li>通知分类管理</li>
</ul>
</li>
</ol>
<h2 id="技术架构">技术架构</h2>
<h3 id="目录结构">目录结构</h3>
<pre><code>lib/
├── basic_push.dart             # 模块入口文件
├── src/                        # 源代码目录
│   ├── push_manager/           # 推送管理器
│   ├── providers/              # 推送服务提供商
│   ├── notifications/          # 通知管理
│   ├── models/                 # 数据模型
│   ├── handlers/               # 消息处理器
│   └── utils/                  # 工具类
├── android/                    # Android特定实现
├── ios/                        # iOS特定实现
└── test/                       # 测试文件
</code></pre>
<h3 id="依赖关系">依赖关系</h3>
<h4 id="基础框架依赖">基础框架依赖</h4>
<ul>
<li><code>basic_network: ^0.2.1</code> - 网络通信框架</li>
<li><code>basic_logger: ^0.2.0</code> - 日志系统</li>
<li><code>basic_storage: ^0.2.0</code> - 本地存储</li>
<li><code>basic_modular: ^0.2.0</code> - 模块化框架</li>
<li><code>basic_platform: ^0.2.2</code> - 平台适配</li>
</ul>
<h4 id="推送服务依赖">推送服务依赖</h4>
<ul>
<li><code>flutter_plugin_mtpush_private</code> - 美团云推送插件（本地依赖）</li>
</ul>
<h4 id="工具依赖">工具依赖</h4>
<ul>
<li><code>rxdart: ^0.27.7</code> - 响应式编程</li>
<li><code>dartz: ^0.10.1</code> - 函数式编程</li>
<li><code>dartx: ^1.1.0</code> - Dart扩展</li>
<li><code>kt_dart: ^1.1.0</code> - Kotlin风格扩展</li>
<li><code>freezed_annotation: ^2.2.0</code> - 数据类注解</li>
<li><code>json_annotation: ^4.8.1</code> - JSON序列化</li>
</ul>
<h2 id="核心模块分析">核心模块分析</h2>
<h3 id="1-模块入口-basic_pushdart">1. 模块入口 (<code>basic_push.dart</code>)</h3>
<p><strong>功能职责</strong>:</p>
<ul>
<li>推送服务统一初始化</li>
<li>对外接口导出</li>
<li>服务生命周期管理</li>
</ul>
<h3 id="2-推送管理器-srcpush_manager">2. 推送管理器 (<code>src/push_manager/</code>)</h3>
<p><strong>功能职责</strong>:</p>
<ul>
<li>推送服务统一管理</li>
<li>多渠道推送协调</li>
<li>消息路由分发</li>
<li>推送状态监控</li>
</ul>
<p><strong>主要组件</strong>:</p>
<ul>
<li><code>PushManager</code> - 推送管理器主类</li>
<li><code>ChannelManager</code> - 推送渠道管理</li>
<li><code>MessageRouter</code> - 消息路由器</li>
<li><code>StatusMonitor</code> - 状态监控器</li>
</ul>
<h3 id="3-推送服务提供商-srcproviders">3. 推送服务提供商 (<code>src/providers/</code>)</h3>
<p><strong>功能职责</strong>:</p>
<ul>
<li>不同推送服务的具体实现</li>
<li>推送渠道适配</li>
<li>服务配置管理</li>
<li>错误处理和重试</li>
</ul>
<p><strong>主要提供商</strong>:</p>
<ul>
<li><code>MTPushProvider</code> - 美团云推送服务</li>
<li><code>FCMProvider</code> - Firebase云消息服务</li>
<li><code>APNsProvider</code> - Apple推送通知服务</li>
<li><code>HuaweiPushProvider</code> - 华为推送服务</li>
</ul>
<h3 id="4-通知管理-srcnotifications">4. 通知管理 (<code>src/notifications/</code>)</h3>
<p><strong>功能职责</strong>:</p>
<ul>
<li>本地通知创建和管理</li>
<li>通知样式定制</li>
<li>通知行为处理</li>
<li>通知权限管理</li>
</ul>
<p><strong>主要组件</strong>:</p>
<ul>
<li><code>LocalNotificationManager</code> - 本地通知管理器</li>
<li><code>NotificationBuilder</code> - 通知构建器</li>
<li><code>NotificationScheduler</code> - 通知调度器</li>
<li><code>NotificationPermissionHandler</code> - 权限处理器</li>
</ul>
<h3 id="5-数据模型-srcmodels">5. 数据模型 (<code>src/models/</code>)</h3>
<p><strong>功能职责</strong>:</p>
<ul>
<li>推送消息数据模型</li>
<li>通知配置模型</li>
<li>推送统计模型</li>
<li>错误信息模型</li>
</ul>
<p><strong>主要模型</strong>:</p>
<ul>
<li><code>PushMessage</code> - 推送消息模型</li>
<li><code>NotificationConfig</code> - 通知配置模型</li>
<li><code>PushStats</code> - 推送统计模型</li>
<li><code>PushError</code> - 推送错误模型</li>
</ul>
<h3 id="6-消息处理器-srchandlers">6. 消息处理器 (<code>src/handlers/</code>)</h3>
<p><strong>功能职责</strong>:</p>
<ul>
<li>消息接收处理</li>
<li>消息点击响应</li>
<li>自定义动作处理</li>
<li>消息生命周期管理</li>
</ul>
<p><strong>主要处理器</strong>:</p>
<ul>
<li><code>MessageReceiveHandler</code> - 消息接收处理器</li>
<li><code>MessageClickHandler</code> - 消息点击处理器</li>
<li><code>CustomActionHandler</code> - 自定义动作处理器</li>
<li><code>LifecycleHandler</code> - 生命周期处理器</li>
</ul>
<h3 id="7-工具类-srcutils">7. 工具类 (<code>src/utils/</code>)</h3>
<p><strong>功能职责</strong>:</p>
<ul>
<li>推送工具方法</li>
<li>消息格式化工具</li>
<li>时间处理工具</li>
<li>加密解密工具</li>
</ul>
<p><strong>主要工具</strong>:</p>
<ul>
<li><code>PushUtils</code> - 推送工具类</li>
<li><code>MessageFormatter</code> - 消息格式化器</li>
<li><code>TimeUtils</code> - 时间工具类</li>
<li><code>CryptoUtils</code> - 加密工具类</li>
</ul>
<h2 id="推送服务架构">推送服务架构</h2>
<h3 id="推送流程设计">推送流程设计</h3>
<pre><code class="language-mermaid">graph TD
    A[应用服务器] --&gt; B[推送服务商]
    B --&gt; C[设备推送服务]
    C --&gt; D[OneApp推送模块]
    D --&gt; E[消息处理器]
    E --&gt; F[业务模块]
    
    G[本地推送] --&gt; D
    H[定时推送] --&gt; D
    
    D --&gt; I[通知展示]
    D --&gt; J[数据处理]
    D --&gt; K[统计上报]
</code></pre>
<h3 id="多渠道推送策略">多渠道推送策略</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PushChannelStrategy</span> </span>{
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; sendMessage(PushMessage message) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">if</span> (Platform.isAndroid) {
      <span class="hljs-comment">// Android优先使用厂商推送</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> _isHuaweiDevice()) {
        <span class="hljs-keyword">await</span> HuaweiPushProvider.send(message);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> _isXiaomiDevice()) {
        <span class="hljs-keyword">await</span> MiPushProvider.send(message);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// fallback to FCM or 美团云推送</span>
        <span class="hljs-keyword">await</span> _sendWithFallback(message);
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Platform.isIOS) {
      <span class="hljs-comment">// iOS使用APNs</span>
      <span class="hljs-keyword">await</span> APNsProvider.send(message);
    }
  }
  
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; _sendWithFallback(PushMessage message) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> FCMProvider.send(message);
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-keyword">await</span> MTPushProvider.send(message);
    }
  }
}
</code></pre>
<h2 id="业务流程">业务流程</h2>
<h3 id="推送初始化流程">推送初始化流程</h3>
<pre><code class="language-mermaid">graph TD
    A[应用启动] --&gt; B[初始化推送模块]
    B --&gt; C[检查推送权限]
    C --&gt; D{权限是否已授予}
    D --&gt;|否| E[请求推送权限]
    D --&gt;|是| F[注册推送服务]
    E --&gt; G{用户是否同意}
    G --&gt;|是| F
    G --&gt;|否| H[记录权限拒绝]
    F --&gt; I[获取设备Token]
    I --&gt; J[上报Token到服务器]
    J --&gt; K[设置消息监听器]
    K --&gt; L[推送服务就绪]
    H --&gt; M[功能降级处理]
</code></pre>
<h3 id="消息处理流程">消息处理流程</h3>
<pre><code class="language-mermaid">graph TD
    A[接收推送消息] --&gt; B[解析消息内容]
    B --&gt; C[验证消息有效性]
    C --&gt; D{消息是否有效}
    D --&gt;|否| E[丢弃消息]
    D --&gt;|是| F[判断应用状态]
    F --&gt; G{应用是否在前台}
    G --&gt;|是| H[直接处理消息]
    G --&gt;|否| I[显示系统通知]
    H --&gt; J[触发业务逻辑]
    I --&gt; K[用户点击通知]
    K --&gt; L[启动应用]
    L --&gt; J
    J --&gt; M[记录推送统计]
    E --&gt; N[记录错误日志]
</code></pre>
<h2 id="推送消息模型">推送消息模型</h2>
<h3 id="消息结构定义">消息结构定义</h3>
<pre><code class="language-dart"><span class="hljs-meta">@freezed</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PushMessage</span> <span class="hljs-title">with</span> <span class="hljs-title">_</span>$<span class="hljs-title">PushMessage</span> </span>{
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">factory</span> PushMessage({
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> messageId,
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> title,
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> body,
    <span class="hljs-built_in">String?</span> imageUrl,
    <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;? customData,
    <span class="hljs-meta">@Default</span>(MessageType.notification) MessageType type,
    <span class="hljs-meta">@Default</span>(MessagePriority.normal) MessagePriority priority,
    <span class="hljs-built_in">DateTime?</span> scheduleTime,
    <span class="hljs-meta">@Default</span>([]) <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; tags,
    PushChannel? channel,
  }) = _PushMessage;

  <span class="hljs-keyword">factory</span> PushMessage.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) =&gt;
      _$PushMessageFromJson(json);
}

<span class="hljs-keyword">enum</span> MessageType {
  notification,  <span class="hljs-comment">// 通知消息</span>
  data,         <span class="hljs-comment">// 数据消息</span>
  silent,       <span class="hljs-comment">// 静默消息</span>
}

<span class="hljs-keyword">enum</span> MessagePriority {
  low,
  normal,
  high,
  urgent,
}
</code></pre>
<h3 id="通知配置模型">通知配置模型</h3>
<pre><code class="language-dart"><span class="hljs-meta">@freezed</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NotificationConfig</span> <span class="hljs-title">with</span> <span class="hljs-title">_</span>$<span class="hljs-title">NotificationConfig</span> </span>{
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">factory</span> NotificationConfig({
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> channelId,
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> channelName,
    <span class="hljs-built_in">String?</span> channelDescription,
    <span class="hljs-meta">@Default</span>(NotificationImportance.normal) NotificationImportance importance,
    <span class="hljs-meta">@Default</span>(<span class="hljs-keyword">true</span>) <span class="hljs-built_in">bool</span> enableSound,
    <span class="hljs-meta">@Default</span>(<span class="hljs-keyword">true</span>) <span class="hljs-built_in">bool</span> enableVibration,
    <span class="hljs-meta">@Default</span>(<span class="hljs-keyword">true</span>) <span class="hljs-built_in">bool</span> enableLights,
    <span class="hljs-built_in">String?</span> soundPath,
    Color? lightColor,
    <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">int</span>&gt;? vibrationPattern,
  }) = _NotificationConfig;

  <span class="hljs-keyword">factory</span> NotificationConfig.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) =&gt;
      _$NotificationConfigFromJson(json);
}
</code></pre>
<h2 id="推送服务提供商实现">推送服务提供商实现</h2>
<h3 id="美团云推送集成">美团云推送集成</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MTPushProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PushProvider</span> </span>{
  <span class="hljs-meta">@override</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; initialize() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> MTFlutterPush.initialize(
      appKey: _appKey,
      appSecret: _appSecret,
    );
    
    <span class="hljs-comment">// 设置消息监听器</span>
    MTFlutterPush.addReceiveNotificationListener(_onReceiveNotification);
    MTFlutterPush.addReceiveMessageListener(_onReceiveMessage);
  }
  
  <span class="hljs-meta">@override</span>
  Future&lt;<span class="hljs-built_in">String?</span>&gt; getDeviceToken() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> MTFlutterPush.getRegistrationId();
  }
  
  <span class="hljs-meta">@override</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; sendMessage(PushMessage message) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> notification = MTNotification(
      title: message.title,
      content: message.body,
      extras: message.customData,
    );
    
    <span class="hljs-keyword">await</span> MTFlutterPush.sendLocalNotification(notification);
  }
  
  <span class="hljs-keyword">void</span> _onReceiveNotification(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; notification) {
    <span class="hljs-keyword">final</span> message = PushMessage.fromJson(notification);
    messageController.add(message);
  }
}
</code></pre>
<h3 id="fcm集成">FCM集成</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FCMProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PushProvider</span> </span>{
  <span class="hljs-keyword">late</span> FirebaseMessaging _messaging;
  
  <span class="hljs-meta">@override</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; initialize() <span class="hljs-keyword">async</span> {
    _messaging = FirebaseMessaging.instance;
    
    <span class="hljs-comment">// 请求权限</span>
    <span class="hljs-keyword">await</span> _messaging.requestPermission();
    
    <span class="hljs-comment">// 设置消息监听器</span>
    FirebaseMessaging.onMessage.listen(_onForegroundMessage);
    FirebaseMessaging.onBackgroundMessage(_onBackgroundMessage);
    FirebaseMessaging.onMessageOpenedApp.listen(_onMessageOpenedApp);
  }
  
  <span class="hljs-meta">@override</span>
  Future&lt;<span class="hljs-built_in">String?</span>&gt; getDeviceToken() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _messaging.getToken();
  }
  
  <span class="hljs-keyword">void</span> _onForegroundMessage(RemoteMessage message) {
    <span class="hljs-keyword">final</span> pushMessage = _convertMessage(message);
    messageController.add(pushMessage);
  }
}
</code></pre>
<h2 id="本地通知系统">本地通知系统</h2>
<h3 id="本地通知管理器">本地通知管理器</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LocalNotificationManager</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> _channelId = <span class="hljs-string">&#x27;oneapp_notifications&#x27;</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> _channelName = <span class="hljs-string">&#x27;OneApp Notifications&#x27;</span>;
  
  <span class="hljs-keyword">late</span> FlutterLocalNotificationsPlugin _plugin;
  
  Future&lt;<span class="hljs-keyword">void</span>&gt; initialize() <span class="hljs-keyword">async</span> {
    _plugin = FlutterLocalNotificationsPlugin();
    
    <span class="hljs-keyword">const</span> androidSettings = AndroidInitializationSettings(<span class="hljs-string">&#x27;@mipmap/ic_launcher&#x27;</span>);
    <span class="hljs-keyword">const</span> iosSettings = DarwinInitializationSettings();
    
    <span class="hljs-keyword">const</span> initSettings = InitializationSettings(
      android: androidSettings,
      iOS: iosSettings,
    );
    
    <span class="hljs-keyword">await</span> _plugin.initialize(
      initSettings,
      onDidReceiveNotificationResponse: _onNotificationTapped,
    );
    
    <span class="hljs-keyword">await</span> _createNotificationChannel();
  }
  
  Future&lt;<span class="hljs-keyword">void</span>&gt; showNotification(LocalNotification notification) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> androidDetails = AndroidNotificationDetails(
      _channelId,
      _channelName,
      channelDescription: <span class="hljs-string">&#x27;OneApp local notifications&#x27;</span>,
      importance: Importance.max,
      priority: Priority.high,
    );
    
    <span class="hljs-keyword">const</span> iosDetails = DarwinNotificationDetails();
    
    <span class="hljs-keyword">const</span> details = NotificationDetails(
      android: androidDetails,
      iOS: iosDetails,
    );
    
    <span class="hljs-keyword">await</span> _plugin.<span class="hljs-keyword">show</span>(
      notification.id,
      notification.title,
      notification.body,
      details,
      payload: notification.payload,
    );
  }
  
  Future&lt;<span class="hljs-keyword">void</span>&gt; scheduleNotification(ScheduledNotification notification) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> _plugin.zonedSchedule(
      notification.id,
      notification.title,
      notification.body,
      notification.scheduledDate,
      <span class="hljs-keyword">const</span> NotificationDetails(
        android: AndroidNotificationDetails(
          _channelId,
          _channelName,
        ),
      ),
      androidAllowWhileIdle: <span class="hljs-keyword">true</span>,
      uiLocalNotificationDateInterpretation: 
          UILocalNotificationDateInterpretation.absoluteTime,
    );
  }
}
</code></pre>
<h2 id="推送统计和分析">推送统计和分析</h2>
<h3 id="统计数据收集">统计数据收集</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PushAnalytics</span> </span>{
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; trackMessageReceived(PushMessage message) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> event = PushEvent(
      type: PushEventType.received,
      messageId: message.messageId,
      timestamp: <span class="hljs-built_in">DateTime</span>.now(),
      platform: Platform.operatingSystem,
    );
    
    <span class="hljs-keyword">await</span> _uploadEvent(event);
  }
  
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; trackMessageClicked(PushMessage message) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> event = PushEvent(
      type: PushEventType.clicked,
      messageId: message.messageId,
      timestamp: <span class="hljs-built_in">DateTime</span>.now(),
      platform: Platform.operatingSystem,
    );
    
    <span class="hljs-keyword">await</span> _uploadEvent(event);
  }
  
  <span class="hljs-keyword">static</span> Future&lt;PushStats&gt; getStats() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _fetchStatsFromServer();
  }
}
</code></pre>
<h2 id="安全和隐私">安全和隐私</h2>
<h3 id="数据保护">数据保护</h3>
<ul>
<li><strong>消息加密</strong>: 敏感推送内容加密传输</li>
<li><strong>Token安全</strong>: 设备Token安全存储和传输</li>
<li><strong>权限控制</strong>: 严格的推送权限管理</li>
<li><strong>数据脱敏</strong>: 统计数据脱敏处理</li>
</ul>
<h3 id="隐私合规">隐私合规</h3>
<ul>
<li><strong>用户同意</strong>: 明确的推送权限申请</li>
<li><strong>数据最小化</strong>: 仅收集必要的推送数据</li>
<li><strong>透明度</strong>: 清晰的隐私政策说明</li>
<li><strong>用户控制</strong>: 用户可控制推送设置</li>
</ul>
<h2 id="性能优化">性能优化</h2>
<h3 id="推送性能">推送性能</h3>
<ul>
<li><strong>批量处理</strong>: 批量处理推送消息</li>
<li><strong>缓存机制</strong>: 推送Token和配置缓存</li>
<li><strong>重试策略</strong>: 智能重试失败的推送</li>
<li><strong>负载均衡</strong>: 推送服务负载均衡</li>
</ul>
<h3 id="资源管理">资源管理</h3>
<ul>
<li><strong>内存优化</strong>: 及时释放推送相关资源</li>
<li><strong>电池优化</strong>: 减少后台推送服务耗电</li>
<li><strong>网络优化</strong>: 优化推送网络请求</li>
<li><strong>存储优化</strong>: 合理管理推送数据存储</li>
</ul>
<h2 id="测试策略">测试策略</h2>
<h3 id="单元测试">单元测试</h3>
<ul>
<li><strong>推送管理器测试</strong>: 核心推送逻辑</li>
<li><strong>消息处理测试</strong>: 消息解析和处理</li>
<li><strong>本地通知测试</strong>: 本地通知功能</li>
<li><strong>工具类测试</strong>: 推送工具方法</li>
</ul>
<h3 id="集成测试">集成测试</h3>
<ul>
<li><strong>推送服务集成</strong>: 各推送服务集成</li>
<li><strong>平台兼容性</strong>: 不同平台推送功能</li>
<li><strong>权限流程测试</strong>: 推送权限申请流程</li>
<li><strong>消息端到端测试</strong>: 完整推送流程</li>
</ul>
<h3 id="性能测试">性能测试</h3>
<ul>
<li><strong>大量消息处理</strong>: 高频推送消息处理</li>
<li><strong>内存泄漏测试</strong>: 长时间运行内存检测</li>
<li><strong>电池消耗测试</strong>: 推送服务电池影响</li>
<li><strong>网络性能测试</strong>: 推送网络性能</li>
</ul>
<h2 id="配置和部署">配置和部署</h2>
<h3 id="推送配置">推送配置</h3>
<pre><code class="language-dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PushConfig</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; mtpushConfig = {
    <span class="hljs-string">&#x27;appKey&#x27;</span>: <span class="hljs-string">&#x27;your_mtpush_app_key&#x27;</span>,
    <span class="hljs-string">&#x27;appSecret&#x27;</span>: <span class="hljs-string">&#x27;your_mtpush_app_secret&#x27;</span>,
    <span class="hljs-string">&#x27;channel&#x27;</span>: <span class="hljs-string">&#x27;default&#x27;</span>,
  };
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; fcmConfig = {
    <span class="hljs-string">&#x27;senderId&#x27;</span>: <span class="hljs-string">&#x27;your_fcm_sender_id&#x27;</span>,
    <span class="hljs-string">&#x27;projectId&#x27;</span>: <span class="hljs-string">&#x27;your_firebase_project_id&#x27;</span>,
  };
}
</code></pre>
<h3 id="环境管理">环境管理</h3>
<ul>
<li><strong>开发环境</strong>: 使用测试推送服务</li>
<li><strong>测试环境</strong>: 模拟生产推送场景</li>
<li><strong>生产环境</strong>: 正式推送服务配置</li>
<li><strong>灰度发布</strong>: 逐步推送新功能</li>
</ul>
<h2 id="最佳实践">最佳实践</h2>
<h3 id="开发建议">开发建议</h3>
<ol>
<li><strong>合理频率</strong>: 控制推送消息频率</li>
<li><strong>内容优化</strong>: 推送内容简洁明了</li>
<li><strong>时机选择</strong>: 选择合适的推送时机</li>
<li><strong>个性化</strong>: 基于用户行为个性化推送</li>
</ol>
<h3 id="用户体验">用户体验</h3>
<ol>
<li><strong>权限引导</strong>: 友好的权限申请引导</li>
<li><strong>设置透明</strong>: 清晰的推送设置选项</li>
<li><strong>内容相关</strong>: 推送内容与用户相关</li>
<li><strong>反馈机制</strong>: 提供推送反馈渠道</li>
</ol>
<h2 id="总结">总结</h2>
<p><code>basic_push</code> 模块作为 OneApp 的推送服务基础模块，提供了完整的跨平台推送解决方案。通过多渠道推送支持、统一的消息处理和完善的本地通知系统，为应用提供了可靠的消息推送能力。模块具有良好的扩展性和兼容性，能够适应不同的推送场景和业务需求。</p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>